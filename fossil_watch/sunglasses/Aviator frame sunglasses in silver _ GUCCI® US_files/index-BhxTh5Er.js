const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_static/drawer-Dl006pCD.css"])))=>i.map(i=>d[i]);
var $n=Object.defineProperty;var Wn=(t,e,r)=>e in t?$n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var me=(t,e,r)=>Wn(t,typeof e!="symbol"?e+"":e,r);import{jsx as C,Fragment as Ii,jsxs as Ve}from"https://www.gucci.com/deps/_static/react@19.1.0/jsx-runtime";import yi,{createContext as fr,useContext as dr,useReducer as Jn,useCallback as Qn,useState as Zn,useRef as Tt,useMemo as ea,useEffect as Ze,Component as ta,createElement as Sr,lazy as ra,Suspense as ia}from"https://www.gucci.com/deps/_static/react@19.1.0";import na from"https://www.gucci.com/deps/_static/react-dom@19.1.0/client";const aa=function(){const e=typeof document<"u"&&document.createElement("link").relList;return e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}(),oa=function(t){return"/p-pers-view/"+t},Dr={},sa=function(e,r,i){let n=Promise.resolve();if(r&&r.length>0){let o=function(f){return Promise.all(f.map(d=>Promise.resolve(d).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));n=o(r.map(f=>{if(f=oa(f),f in Dr)return;Dr[f]=!0;const d=f.endsWith(".css"),E=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${E}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":aa,d||(u.as="script"),u.crossOrigin="",u.href=f,l&&u.setAttribute("nonce",l),document.head.appendChild(u),d)return new Promise((c,p)=>{u.addEventListener("load",c),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return n.then(o=>{for(const s of o||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})},ua="_wrapper_awrxh_1",la={wrapper:ua};function Ri(t){var e,r,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=Ri(t[e]))&&(i&&(i+=" "),i+=r)}else for(r in t)t[r]&&(i&&(i+=" "),i+=r);return i}function at(){for(var t,e,r=0,i="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=Ri(t))&&(i&&(i+=" "),i+=e);return i}const Oi=fr(null),ca=t=>({dotNoDot:t.includePeriod,fontStyle:"Copperplate",fontSize:"5"}),Ni=fr(null);function fa(t,e){var r;switch(e.type){case"monogram-fetch-success":return{...t,monogram:{type:e.type,monogramConfig:e.monogramConfig,isModalOpen:!1,embossingSelection:null,openModalCount:0}};case"monogram-fetch-error":return{...t,monogram:{...e,isModalOpen:!1,embossingSelection:null}};case"embossing-selection-updated":return t.monogram.type!=="monogram-fetch-success"?t:{...t,monogram:{...t.monogram,embossingSelection:(r=e.values)!=null&&r.text?{...ca(t.monogram.monogramConfig),...e.values}:null,isModalOpen:e.isModalOpen??t.monogram.isModalOpen}};case"toggle-modal":{if(t.monogram.type!=="monogram-fetch-success")return t;const i=typeof e.force=="boolean"?e.force:!t.monogram.isModalOpen;return{...t,monogram:{...t.monogram,isModalOpen:i,openModalCount:t.monogram.openModalCount+Number(i)}}}}throw new TypeError(`unkwnown action ${e.type}`)}function da({data:t,params:e,children:r}){const[i,n]=Jn(fa,{data:t,params:e,monogram:{type:"monogram-loading",isModalOpen:!1,embossingSelection:null}});return C(Ni.Provider,{value:n,children:C(Oi.Provider,{value:i,children:r})})}function gr(){const t=dr(Oi);if(!t)throw new Error("expected EmbossingSelectionProvider to be an anchestor");return t}function Ti(){const t=dr(Ni);if(!t)throw new Error("expected EmbossingSelectionProvider to be an anchestor");return t}const ga="_root_1svbw_1",pa="_interactiveArea_1svbw_9",Ea="_plusIcon_1svbw_9",ha="_button_1svbw_13",va="_hasSelection_1svbw_27",_a="_leftCol_1svbw_36",ma="_center_1svbw_42",Ia="_btnText_1svbw_53",ya="_btn_1svbw_53",de={root:ga,interactiveArea:pa,plusIcon:Ea,button:ha,hasSelection:va,leftCol:_a,center:ma,btnText:Ia,btn:ya};function Ra(t,...e){const[r,i]=e;return r!==void 0?wr(t,r,i):function(a,o){return wr(t,a,o)}}function wr(t,e,r){let i=t[`${e}.${t["@minuet/country"]}`]||t[e]||e;return r&&Object.keys(r).forEach(n=>{const a=new RegExp(`{{${n}}}`,"g");i=i.replace(a,r[n].toString())}),i}const Ai=yi.createContext(void 0);function Oa({children:t,microcopy:e}){return C(Ai.Provider,{value:e,children:t})}function Na(){const t=dr(Ai);if(t===void 0)throw new Error("useMinuet must be used within a MinuetProvider");return Qn((e,r)=>Ra(t,e,r),[t])}const Ta=({variant:t="16",className:e="",inversed:r=!1})=>{const i=`${r?"is-inversed":""} ${e}`;switch(t){case"24":return C("svg",{className:i,"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:C("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.4951 11.5557L5.02539 17.0254L6.08605 18.086L11.5557 12.6164L17.0254 18.0861L18.086 17.0254L12.6164 11.5557L18.086 6.08605L17.0254 5.02539L11.5557 10.4951L6.08605 5.0254L5.02539 6.08606L10.4951 11.5557Z",fill:"var(--_g-icon-stroke-color)"})});case"16":return C("svg",{className:i,"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:C("path",{d:"M12 5.06L10.94 4L8 6.94L5.06 4L4 5.06L6.94 8L4 10.94L5.06 12L8 9.06L10.94 12L12 10.94L9.06 8L12 5.06Z",fill:"var(--_g-icon-stroke-color)"})})}},Aa=({variant:t="16",className:e="",inversed:r=!1})=>{const i=`${r?"is-inversed":""} ${e}`;switch(t){case"24":return C("svg",{className:i,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:C("path",{d:"M18 11.25H12.75V6H11.25V11.25H6V12.75H11.25V18H12.75V12.75H18V11.25Z",fill:"var(--_g-icon-fill-color)"})});case"16":return C("svg",{className:i,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:C("path",{d:"M12 8.75H8.75V12H7.25V8.75H4V7.25H7.25V4H8.75V7.25H12V8.75Z",fill:"var(--_g-icon-fill-color)"})})}},ba=({variant:t="16",inversed:e=!1,className:r=""})=>{const i=`${e?"is-inversed":""} is-rtl-enabled ${r}`;switch(t){case"24":return C("svg",{className:i,"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:C("path",{d:"M19.1304 4.51C18.7101 4.17 18.1998 4 17.6894 4C17.029 4 16.3485 4.27 15.8582 4.77L9.78406 10.85L4.74063 15.9L4.03015 18.72C3.86003 19.39 4.38039 20 5.02082 20C5.10088 20 5.19094 19.99 5.27099 19.97L8.09291 19.26L13.1363 14.21L19.3005 8.04C20.2912 7.05 20.2212 5.41 19.1204 4.51H19.1304ZM17.6894 5.5C17.8796 5.5 18.0497 5.56 18.1798 5.67C18.45 5.89 18.5 6.17 18.51 6.31C18.51 6.46 18.49 6.74 18.2498 6.98L17.6494 7.58L16.4086 6.34L16.9189 5.83C17.119 5.63 17.4092 5.5 17.6894 5.5ZM5.68127 18.32L6.09155 16.66L6.34172 16.41L7.58257 17.65L7.32239 17.91L5.67127 18.32H5.68127ZM12.0856 13.15L8.65329 16.59L7.41245 15.35L10.8548 11.91L15.3579 7.4L16.5987 8.64L12.0956 13.15H12.0856Z",fill:"var(--_g-icon-fill-color)"})});case"16":return C("svg",{className:i,"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:C("path",{d:"M13.1629 2.4999C12.2519 1.7599 10.8703 1.8599 9.99933 2.7199L2.55085 10.1699L2.04027 12.2299C1.92013 12.7199 2.06029 13.2299 2.41069 13.5799C2.681 13.8499 3.04141 13.9999 3.41183 13.9999C3.53197 13.9999 3.64209 13.9899 3.76223 13.9599L5.81457 13.4499L13.3231 5.9399C13.7836 5.4799 14.0339 4.8399 13.9939 4.1899C13.9638 3.5399 13.6535 2.9299 13.1429 2.5099L13.1629 2.4999ZM9.84916 4.9999L11.0005 6.1499L6.15495 10.9999L5.00364 9.8499L9.84916 4.9999ZM3.53197 12.4799L3.9124 10.9499L3.94243 10.9199L5.09375 12.0699L5.06371 12.0999L3.53197 12.4799ZM12.2719 4.8799L12.0617 5.0899L10.9104 3.9399L11.0605 3.7899C11.3909 3.4599 11.8915 3.4099 12.2018 3.6699C12.382 3.8199 12.4922 4.0299 12.5022 4.2599C12.5122 4.4899 12.4321 4.7099 12.2619 4.8799H12.2719Z",fill:"var(--_g-icon-fill-color)"})})}},Sa="_skeleton_1wdzn_1",Da="_Pulse_1wdzn_1",rt={skeleton:Sa,"skeleton-wrapper":"_skeleton-wrapper_1wdzn_2","is-inversed":"_is-inversed_1wdzn_5",Pulse:Da,"is-loading":"_is-loading_1wdzn_31"},wa=({is:t="loading",inversed:e=!1,children:r,variant:i="single"})=>{const n={"aria-busy":t==="loading"},a=t==="loading",o=C("div",{"data-testid":"skeleton-single",className:`${rt.skeleton} ${e?rt["is-inversed"]:""}`});return i==="single"?C(Ii,{children:a?o:r}):C("div",{"data-testid":"skeleton-wrapper",className:`${rt["skeleton-wrapper"]} ${e?rt["is-inversed"]:""} ${t==="loading"?rt["is-"+t]:""}  `,...n,"aria-live":"polite",children:r})},La=(t,e)=>{const[{color:r}]=e.colors.slice().sort(Si);return{text:"",color:r,...t}},Ec=(t,e)=>t.replace(/[^.a-z]/gi,"").slice(0,e).toUpperCase(),hc=(t,e,r)=>{const i=La(e,r);return t.text.length>0&&(i.text!==t.text||i.color!==t.color)},bi=(t,e)=>t(`p-pers.color.${e}`),Lr={gold:10,silver:15,blind:20,red:25,green:30,blue:35,yellow:40};function Si(t,e){const i=Lr[t.color]??99999,n=Lr[e.color]??99999;return i-n}const vc=(t,e)=>t.slice().sort(Si).map(({color:r})=>({name:bi(e,r),value:r}));function Ca(t){switch(t.toLowerCase()){case"trace":return{severityText:"TRACE",severityNumber:1};case"debug":return{severityText:"DEBUG",severityNumber:5};case"info":return{severityText:"INFO",severityNumber:9};case"warn":return{severityText:"WARN",severityNumber:13};case"error":return{severityText:"ERROR",severityNumber:17};default:return{severityText:"FATAL",severityNumber:21}}}function Ua(t){const{level:e,span_id:r,trace_id:i,trace_flags:n,resource:a,Body:o,...s}=t,l=new Date().getTime(),f={trace_id:s["dd.trace_id"],span_id:s["dd.span_id"]},d=Object.values(f).some(E=>E!==void 0);return{Timestamp:l,ObservedTimestamp:l,TraceId:i,SpanId:r,TraceFlags:n,Resource:a||void 0,InstrumentationScope:s.instrumentationScope||void 0,dd:d?f:void 0,Body:o||void 0,Attributes:{...s,"dd.trace_id":void 0,"dd.span_id":void 0}}}var Ma={timestamp:!1,messageKey:"Body",base:void 0,formatters:{level:t=>{const e=Ca(t);return{SeverityText:e.severityText,SeverityNumber:e.severityNumber}},bindings:t=>({bindings:t}),log:t=>Ua(t)}};function Di(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var it={exports:{}},Vt,Cr;function Va(){if(Cr)return Vt;Cr=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Vt=e;function e(r,i,n){var a=n&&n.stringify||t,o=1;if(typeof r=="object"&&r!==null){var s=i.length+o;if(s===1)return r;var l=new Array(s);l[0]=a(r);for(var f=1;f<s;f++)l[f]=a(i[f]);return l.join(" ")}if(typeof r!="string")return r;var d=i.length;if(d===0)return r;for(var E="",u=1-o,c=-1,p=r&&r.length||0,g=0;g<p;){if(r.charCodeAt(g)===37&&g+1<p){switch(c=c>-1?c:0,r.charCodeAt(g+1)){case 100:case 102:if(u>=d||i[u]==null)break;c<g&&(E+=r.slice(c,g)),E+=Number(i[u]),c=g+2,g++;break;case 105:if(u>=d||i[u]==null)break;c<g&&(E+=r.slice(c,g)),E+=Math.floor(Number(i[u])),c=g+2,g++;break;case 79:case 111:case 106:if(u>=d||i[u]===void 0)break;c<g&&(E+=r.slice(c,g));var _=typeof i[u];if(_==="string"){E+="'"+i[u]+"'",c=g+2,g++;break}if(_==="function"){E+=i[u].name||"<anonymous>",c=g+2,g++;break}E+=a(i[u]),c=g+2,g++;break;case 115:if(u>=d)break;c<g&&(E+=r.slice(c,g)),E+=String(i[u]),c=g+2,g++;break;case 37:c<g&&(E+=r.slice(c,g)),E+="%",c=g+2,g++,u--;break}++u}++g}return c===-1?r:(c<p&&(E+=r.slice(c)),E)}return Vt}var Ur;function Pa(){if(Ur)return it.exports;Ur=1;const t=Va();it.exports=d;const e=$e().console||{},r={mapHttpRequest:ie,mapHttpResponse:ie,wrapRequestSerializer:B,wrapResponseSerializer:B,wrapErrorSerializer:B,req:ie,res:ie,err:z,errWithCause:z};function i(m,y){return m==="silent"?1/0:y.levels.values[m]}const n=Symbol("pino.logFuncs"),a=Symbol("pino.hierarchy"),o={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function s(m,y){const S={logger:y,parent:m[a]};y[a]=S}function l(m,y,S){const M={};y.forEach(U=>{M[U]=S[U]?S[U]:e[U]||e[o[U]||"log"]||j}),m[n]=M}function f(m,y){return Array.isArray(m)?m.filter(function(M){return M!=="!stdSerializers.err"}):m===!0?Object.keys(y):!1}function d(m){m=m||{},m.browser=m.browser||{};const y=m.browser.transmit;if(y&&typeof y.send!="function")throw Error("pino: transmit option must have a send function");const S=m.browser.write||e;m.browser.write&&(m.browser.asObject=!0);const M=m.serializers||{},U=f(m.browser.serialize,M);let $=m.browser.serialize;Array.isArray(m.browser.serialize)&&m.browser.serialize.indexOf("!stdSerializers.err")>-1&&($=!1);const ae=Object.keys(m.customLevels||{}),F=["error","fatal","warn","info","debug","trace"].concat(ae);typeof S=="function"&&F.forEach(function(ee){S[ee]=S}),(m.enabled===!1||m.browser.disabled)&&(m.level="silent");const Y=m.level||"info",A=Object.create(S);A.log||(A.log=j),l(A,F,S),s({},A),Object.defineProperty(A,"levelVal",{get:fe}),Object.defineProperty(A,"level",{get:Ge,set:Be});const K={transmit:y,serialize:U,asObject:m.browser.asObject,asObjectBindingsOnly:m.browser.asObjectBindingsOnly,formatters:m.browser.formatters,levels:F,timestamp:X(m),messageKey:m.messageKey||"msg",onChild:m.onChild||j};A.levels=E(m),A.level=Y,A.isLevelEnabled=function(ee){return this.levels.values[ee]?this.levels.values[ee]>=this.levels.values[this.level]:!1},A.setMaxListeners=A.getMaxListeners=A.emit=A.addListener=A.on=A.prependListener=A.once=A.prependOnceListener=A.removeListener=A.removeAllListeners=A.listeners=A.listenerCount=A.eventNames=A.write=A.flush=j,A.serializers=M,A._serialize=U,A._stdErrSerialize=$,A.child=function(...ee){return tt.call(this,K,...ee)},y&&(A._logEvent=b());function fe(){return i(this.level,this)}function Ge(){return this._level}function Be(ee){if(ee!=="silent"&&!this.levels.values[ee])throw Error("unknown level "+ee);this._level=ee,p(this,K,A,"error"),p(this,K,A,"fatal"),p(this,K,A,"warn"),p(this,K,A,"info"),p(this,K,A,"debug"),p(this,K,A,"trace"),ae.forEach(_e=>{p(this,K,A,_e)})}function tt(ee,_e,qe){if(!_e)throw new Error("missing bindings for child Pino");qe=qe||{},U&&_e.serializers&&(qe.serializers=_e.serializers);const He=qe.serializers;if(U&&He){var ze=Object.assign({},M,He),Le=m.browser.serialize===!0?Object.keys(ze):U;delete _e.serializers,k([_e],Le,ze,this._stdErrSerialize)}function gt(Ne){this._childLevel=(Ne._childLevel|0)+1,this.bindings=_e,ze&&(this.serializers=ze,this._serialize=Le),y&&(this._logEvent=b([].concat(Ne._logEvent.bindings,_e)))}gt.prototype=this;const Ce=new gt(this);return s(this,Ce),Ce.child=function(...Ne){return tt.call(this,ee,...Ne)},Ce.level=qe.level||this.level,ee.onChild(Ce),Ce}return A}function E(m){const y=m.customLevels||{},S=Object.assign({},d.levels.values,y),M=Object.assign({},d.levels.labels,u(y));return{values:S,labels:M}}function u(m){const y={};return Object.keys(m).forEach(function(S){y[m[S]]=S}),y}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},d.stdSerializers=r,d.stdTimeFunctions=Object.assign({},{nullTime:ne,epochTime:Re,unixTime:ve,isoTime:Fe});function c(m){const y=[];m.bindings&&y.push(m.bindings);let S=m[a];for(;S.parent;)S=S.parent,S.logger.bindings&&y.push(S.logger.bindings);return y.reverse()}function p(m,y,S,M){if(Object.defineProperty(m,M,{value:i(m.level,S)>i(M,S)?j:S[n][M],writable:!0,enumerable:!0,configurable:!0}),m[M]===j){if(!y.transmit)return;const $=y.transmit.level||m.level,ae=i($,S);if(i(M,S)<ae)return}m[M]=_(m,y,S,M);const U=c(m);U.length!==0&&(m[M]=g(U,m[M]))}function g(m,y){return function(){return y.apply(this,[...m,...arguments])}}function _(m,y,S,M){return function(U){return function(){const ae=y.timestamp(),F=new Array(arguments.length),Y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var A=0;A<F.length;A++)F[A]=arguments[A];var K=!1;if(y.serialize&&(k(F,this._serialize,this.serializers,this._stdErrSerialize),K=!0),y.asObject||y.formatters?U.call(Y,...N(this,M,F,ae,y)):U.apply(Y,F),y.transmit){const fe=y.transmit.level||m._level,Ge=i(fe,S),Be=i(M,S);if(Be<Ge)return;R(this,{ts:ae,methodLevel:M,methodValue:Be,transmitValue:S.levels.values[y.transmit.level||m._level],send:y.transmit.send,val:i(m._level,S)},F,K)}}}(m[n][M])}function N(m,y,S,M,U){const{level:$,log:ae=fe=>fe}=U.formatters||{},F=S.slice();let Y=F[0];const A={};let K=(m._childLevel|0)+1;if(K<1&&(K=1),M&&(A.time=M),$){const fe=$(y,m.levels.values[y]);Object.assign(A,fe)}else A.level=m.levels.values[y];if(U.asObjectBindingsOnly){if(Y!==null&&typeof Y=="object")for(;K--&&typeof F[0]=="object";)Object.assign(A,F.shift());return[ae(A),...F]}else{if(Y!==null&&typeof Y=="object"){for(;K--&&typeof F[0]=="object";)Object.assign(A,F.shift());Y=F.length?t(F.shift(),F):void 0}else typeof Y=="string"&&(Y=t(F.shift(),F));return Y!==void 0&&(A[U.messageKey]=Y),[ae(A)]}}function k(m,y,S,M){for(const U in m)if(M&&m[U]instanceof Error)m[U]=d.stdSerializers.err(m[U]);else if(typeof m[U]=="object"&&!Array.isArray(m[U])&&y)for(const $ in m[U])y.indexOf($)>-1&&$ in S&&(m[U][$]=S[$](m[U][$]))}function R(m,y,S,M=!1){const U=y.send,$=y.ts,ae=y.methodLevel,F=y.methodValue,Y=y.val,A=m._logEvent.bindings;M||k(S,m._serialize||Object.keys(m.serializers),m.serializers,m._stdErrSerialize===void 0?!0:m._stdErrSerialize),m._logEvent.ts=$,m._logEvent.messages=S.filter(function(K){return A.indexOf(K)===-1}),m._logEvent.level.label=ae,m._logEvent.level.value=F,U(ae,m._logEvent,Y),m._logEvent=b(A)}function b(m){return{ts:0,messages:[],bindings:m||[],level:{label:"",value:0}}}function z(m){const y={type:m.constructor.name,msg:m.message,stack:m.stack};for(const S in m)y[S]===void 0&&(y[S]=m[S]);return y}function X(m){return typeof m.timestamp=="function"?m.timestamp:m.timestamp===!1?ne:Re}function ie(){return{}}function B(m){return m}function j(){}function ne(){return!1}function Re(){return Date.now()}function ve(){return Math.round(Date.now()/1e3)}function Fe(){return new Date(Date.now()).toISOString()}function $e(){function m(y){return typeof y<"u"&&y}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return m(self)||m(window)||m(this)||{}}}return it.exports.default=d,it.exports.pino=d,it.exports}var Fa=Pa();const xa=Di(Fa);var Mr={};class ka{constructor(){me(this,"applicationLogger");me(this,"initFailed",!1);me(this,"appInfo",null);me(this,"globalDatadogLogger",null)}setAppInfo(e){this.appInfo=e}async write(e,r){try{if(this.initFailed)return;await this.init(),this.initFailed||this.log(e,r)}catch(i){console.warn("Failed to write log",i)}}log(e,r){this.applicationLogger[e]&&this.applicationLogger[e](r)}async getGlobalDatadogLogger(){return this.globalDatadogLogger?this.globalDatadogLogger:new Promise((e,r)=>{if(window.DD_LOGS_REPLATFORMING){window.DD_LOGS_REPLATFORMING.onReady(()=>{this.globalDatadogLogger=window.DD_LOGS_REPLATFORMING,e(window.DD_LOGS_REPLATFORMING)});return}const i=setTimeout(()=>{r("Global datalog logger not set. Logging will not work.")},15e3),n=setInterval(()=>{window.DD_LOGS_REPLATFORMING&&(window.DD_LOGS_REPLATFORMING.onReady(()=>{e(window.DD_LOGS_REPLATFORMING)}),clearTimeout(i),clearInterval(n))},50)})}async getAppInfo(){return this.appInfo?this.appInfo:new Promise((e,r)=>{const i=setTimeout(()=>{r("App info not set. Logging will not work.")},15e3),n=setInterval(()=>{this.appInfo&&(e(this.appInfo),clearTimeout(i),clearInterval(n))},50)})}async init(){try{if(this.applicationLogger)return;const[e,r]=await Promise.all([this.getGlobalDatadogLogger(),this.getAppInfo()]);if(!e||!r)throw new Error("Failed to retrieve globalLogger or appInfo");this.initGlobalInstance(e),this.applicationLogger=e.createLogger(r.service,{context:{service:r.service,env:r.env}});return}catch(e){console.warn("Could not initialize DataDog logger ",e),this.initFailed=!0}}initGlobalInstance(e){e.getInitConfiguration()||e.init({clientToken:"pub06c9294a47138de514fbc6e73bba7b13",site:"datadoghq.com",forwardErrorsToLogs:!1,sessionSampleRate:100,useCrossSiteSessionCookie:!0,trackSessionAcrossSubdomains:!0,useSecureSessionCookie:!0,silentMultipleInit:!1})}}const Ga=t=>{const e=typeof process<"u"&&Mr?Mr.LOG_LEVEL:void 0;return(t==null?void 0:t.level)||e||"info"},ot=new ka;class pr{constructor(e,r){me(this,"options");me(this,"context");me(this,"logger");me(this,"errorSerializationRecursionLimit");me(this,"generateAttributes",e=>({...this.context||{},...this.serializeErrorsRecursively(e)}));this.options=e,this.context=r,this.errorSerializationRecursionLimit=(e==null?void 0:e.errorSerializationRecursionLimit)||3,this.logger=xa({...Ma,level:Ga(e),redact:e==null?void 0:e.redact,browser:{write:{info:i=>{console.info(i),ot.write("info",i)},warn:i=>{console.warn(i),ot.write("warn",i)},error:i=>{console.error(i),ot.write("error",i)},debug:i=>{console.debug(i),ot.write("debug",i)}}}})}child(e,r){const i={...this.options||{},...r||{}},n={...this.context||{},...e};return new pr(i,n)}log(e,r){const i=r[r.length-1];if(r.length===1&&i instanceof Error){e({Body:`${i.name} ${i.message}`,...this.generateAttributes(i)});return}if(typeof i=="object"&&!Array.isArray(i)){const n=r.slice(0,-1);e({Body:this.generateBody(n),...this.generateAttributes(i)});return}e({Body:this.generateBody(r),...this.generateAttributes({})})}generateBody(e){return e.map(this.serializeErrorsRecursively.bind(this)).map(r=>typeof r=="string"?r:JSON.stringify(r)).join(" ")}serializeErrorsRecursively(e,r=0){if(r>this.errorSerializationRecursionLimit)return e;if(e instanceof Error){const i=Object.fromEntries(Object.getOwnPropertyNames(e).filter(n=>typeof e[n]!="function").map(n=>[n,e[n]]));return{name:e.name,message:e.message,stack:e.stack,...i}}return Array.isArray(e)?e.map(i=>this.serializeErrorsRecursively(i,r+1)):typeof e=="object"&&e!==null?Object.fromEntries(Object.entries(e).map(([i,n])=>[i,this.serializeErrorsRecursively(n,r+1)])):e}info(...e){this.log(this.logger.info.bind(this.logger),e)}fatal(...e){this.log(this.logger.fatal.bind(this.logger),e)}error(...e){this.log(this.logger.error.bind(this.logger),e)}warn(...e){this.log(this.logger.warn.bind(this.logger),e)}debug(...e){this.log(this.logger.debug.bind(this.logger),e)}trace(...e){this.log(this.logger.trace.bind(this.logger),e)}silent(...e){this.log(this.logger.silent.bind(this.logger),e)}}const Ba=t=>{if(typeof window>"u")return;const{service:e,env:r}=t||{};if(!e||!r){console.warn("[otel-node/logger] Service or environment not defined. Logger not set.");return}ot.setAppInfo({service:e,env:r}),console.log("Logger set with Service:",e,"and Environment:",r)},qa=t=>new pr(t);var mi;const Wt=qa({level:typeof process<"u"&&((mi=process==null?void 0:process.env)==null?void 0:mi.LOG_LEVEL)||"info"}),wi=t=>"toJSON"in t&&typeof t.toJSON=="function"?t.toJSON():{name:t.name,stack:t.stack,message:t.message,cause:t.cause},ft=(t,e,r)=>{const i=(r==null?void 0:r.logLevel)??"error",n=r==null?void 0:r.ctx;e instanceof Error?Wt[i](`[report-exception]${t}`,{ctx:n,error:wi(e)}):Wt[i](`[report-exception]${t}`,{ctx:n,error:e})},Pt={PRODUCT_PAGE:"product page",EMBOSSING_SELECTION_DRAWER:"embossing selection drawer"},Ft={DISPLAY_EMBOSSING_SELECTOR:"displayEmbossingSelector",ACTION_EMBOSSING_SELECTOR:"actionEmbossingSelector",OPEN_OVERLAY:"opened",CLOSE_OVERLAY:"closed",CHANGE_SELECTION_COLOR:"actionSelectColor",CHANGE_SELECTION_TEXT:"actionChangeInput",APPLY_SELECTION:"actionApply",CLEAR_SELECTION:"actionReset"};async function Ha(t,e){try{const r=async()=>{var i;return(i=window.analyticsSdk)==null?void 0:i.tracking.asyncSendEvent({name:t,event:e})};if(window.analyticsSdk)return r();document.addEventListener("analyticsSdkReady",r,{once:!0})}catch(r){ft(`[analytics]Problem with Analytics SDK: unable to track ${t}`,r,{ctx:{event:e}})}}const xt=t=>{Ha("generic.event",t).catch(e=>{ft(`[analytics]Failed to track generic event category=${t.category}, action=${t.action}, label=${t.label}`,e,{ctx:{event:t}})})};function za(t,e,r,i){const[n,a]=Zn(!1),o=Tt(!1),s=Tt(r);s.current=r;const l=ea(()=>({root:e==null?void 0:e.root,rootMargin:(e==null?void 0:e.rootMargin)??"0px",threshold:(e==null?void 0:e.threshold)??0}),[e==null?void 0:e.root,e==null?void 0:e.rootMargin,e==null?void 0:e.threshold]);return Ze(()=>{const f=t.current;if(!f||typeof IntersectionObserver>"u"){o.current=!1,a(!1);return}const d=u=>{const c=u[0];c&&(a(c.isIntersecting),c.isIntersecting&&!o.current&&s.current&&(s.current(),o.current=!0))},E=new IntersectionObserver(d,l);return E.observe(f),()=>{E.disconnect()}},[t,l,i]),Ze(()=>{o.current=!1},[t,i]),n}function ja(){const t=Ti(),{monogram:e,params:r}=gr(),i=Na(),n=Tt(null);if(za(n,{},()=>{xt({category:Pt.PRODUCT_PAGE,action:Ft.DISPLAY_EMBOSSING_SELECTOR,label:r.stylecode})},e.type),e.type==="monogram-fetch-error")return null;if(e.type==="monogram-loading")return C("div",{className:de.root,style:{height:54,width:"100%"},children:C(wa,{is:"loading",variant:"single",children:"placeholder"})});const o=()=>{t({type:"toggle-modal",force:!0}),xt({category:Pt.PRODUCT_PAGE,action:Ft.ACTION_EMBOSSING_SELECTOR,label:r.stylecode})},s=()=>{o()},l=()=>{o()},f=()=>{t({type:"embossing-selection-updated",values:null}),xt({category:Pt.EMBOSSING_SELECTION_DRAWER,action:Ft.CLEAR_SELECTION,label:r.stylecode})},{monogramConfig:{images:d},embossingSelection:E}=e;return Ve("div",{className:de.root,ref:n,children:[Ve("button",{type:"button","aria-haspopup":"dialog",id:"embossing-selection-trigger",className:at(de.button,{[de.hasSelection]:E}),onClick:s,children:[C("img",{width:"48",height:"48",loading:"lazy",className:de.leftCol,src:d.datasrcsmall||d.datasrcsmallretina,alt:""}),Ve("div",{className:de.center,children:[C("span",{className:at("is-text-s-book",de.btnText),children:i("p-pers.personalization.cta")}),E&&Ve("div",{className:at("is-text-s-medium",de.btnText),children:[Ve("span",{children:[i("p-pers.embossing")," "]}),C("span",{translate:"no",children:`${E.text}, ${bi(i,E.color)}`})]})]})]}),Ve("div",{className:at(de.interactiveArea,{[de.hasSelection]:E}),children:[!E&&C(Aa,{className:de.plusIcon}),E&&Ve(Ii,{children:[C("button",{id:"embossing-selection-edit-btn",title:i("p-pers.aria-label.personalization.edit"),"aria-label":i("p-pers.aria-label.personalization.edit"),"aria-haspopup":"dialog",className:de.btn,type:"button",onClick:l,children:C(ba,{})}),C("button",{id:"embossing-selection-remove-btn",title:i("p-pers.aria-label.personalization.remove"),"aria-label":i("p-pers.aria-label.personalization.remove"),className:de.btn,type:"button",onClick:f,children:C(Ta,{})})]})]})]})}const Ka=fr(null),kt={didCatch:!1,error:null};class Li extends ta{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=kt}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var r,i,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];(r=(i=this.props).onReset)===null||r===void 0||r.call(i,{args:a,reason:"imperative-api"}),this.setState(kt)}}componentDidCatch(e,r){var i,n;(i=(n=this.props).onError)===null||i===void 0||i.call(n,e,r)}componentDidUpdate(e,r){const{didCatch:i}=this.state,{resetKeys:n}=this.props;if(i&&r.error!==null&&Ya(e.resetKeys,n)){var a,o;(a=(o=this.props).onReset)===null||a===void 0||a.call(o,{next:n,prev:e.resetKeys,reason:"keys"}),this.setState(kt)}}render(){const{children:e,fallbackRender:r,FallbackComponent:i,fallback:n}=this.props,{didCatch:a,error:o}=this.state;let s=e;if(a){const l={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof r=="function")s=r(l);else if(i)s=Sr(i,l);else if(n!==void 0)s=n;else throw o}return Sr(Ka.Provider,{value:{didCatch:a,error:o,resetErrorBoundary:this.resetErrorBoundary}},s)}}function Ya(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t.length!==e.length||t.some((r,i)=>!Object.is(r,e[i]))}const Xa="embossing-selection-update",Vr="embossing-selection-request-status";function Pr(t,e){const r={styleCode:t,embossingSelection:e};window.dispatchEvent(new CustomEvent(Xa,{detail:r}))}var Me;function Ci(t){return{lang:(t==null?void 0:t.lang)??(Me==null?void 0:Me.lang),message:t==null?void 0:t.message,abortEarly:(t==null?void 0:t.abortEarly)??(Me==null?void 0:Me.abortEarly),abortPipeEarly:(t==null?void 0:t.abortPipeEarly)??(Me==null?void 0:Me.abortPipeEarly)}}var Gt;function $a(t){return Gt==null?void 0:Gt.get(t)}var Bt;function Wa(t){return Bt==null?void 0:Bt.get(t)}var qt;function Ja(t,e){var r;return(r=qt==null?void 0:qt.get(t))==null?void 0:r.get(e)}function Qa(t){var r,i;const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&((i=(r=Object.getPrototypeOf(t))==null?void 0:r.constructor)==null?void 0:i.name))??"null":e}function At(t,e,r,i,n){const a=n&&"input"in n?n.input:r.value,o=(n==null?void 0:n.expected)??t.expects??null,s=(n==null?void 0:n.received)??Qa(a),l={kind:t.kind,type:t.type,input:a,expected:o,received:s,message:`Invalid ${e}: ${o?`Expected ${o} but r`:"R"}eceived ${s}`,requirement:t.requirement,path:n==null?void 0:n.path,issues:n==null?void 0:n.issues,lang:i.lang,abortEarly:i.abortEarly,abortPipeEarly:i.abortPipeEarly},f=t.kind==="schema",d=(n==null?void 0:n.message)??t.message??Ja(t.reference,l.lang)??(f?Wa(l.lang):null)??i.message??$a(l.lang);d!==void 0&&(l.message=typeof d=="function"?d(l):d),f&&(r.typed=!1),r.issues?r.issues.push(l):r.issues=[l]}function Er(t){return{version:1,vendor:"valibot",validate(e){return t["~run"]({value:e},Ci())}}}var Za=class extends Error{constructor(t){super(t[0].message),this.name="ValiError",this.issues=t}};function Ui(t,e){return{kind:"validation",type:"min_length",reference:Ui,async:!1,expects:`>=${t}`,requirement:t,message:e,"~run"(r,i){return r.typed&&r.value.length<this.requirement&&At(this,"length",r,i,{received:`${r.value.length}`}),r}}}function eo(t,e,r){return typeof t.fallback=="function"?t.fallback(e,r):t.fallback}function to(t,e,r){return typeof t.default=="function"?t.default(e,r):t.default}function Mi(t,e){return{kind:"schema",type:"object",reference:Mi,expects:"Object",async:!1,entries:t,message:e,get"~standard"(){return Er(this)},"~run"(r,i){var a;const n=r.value;if(n&&typeof n=="object"){r.typed=!0,r.value={};for(const o in this.entries){const s=this.entries[o];if(o in n||(s.type==="exact_optional"||s.type==="optional"||s.type==="nullish")&&s.default!==void 0){const l=o in n?n[o]:to(s),f=s["~run"]({value:l},i);if(f.issues){const d={type:"object",origin:"value",input:n,key:o,value:l};for(const E of f.issues)E.path?E.path.unshift(d):E.path=[d],(a=r.issues)==null||a.push(E);if(r.issues||(r.issues=f.issues),i.abortEarly){r.typed=!1;break}}f.typed||(r.typed=!1),r.value[o]=f.value}else if(s.fallback!==void 0)r.value[o]=eo(s);else if(s.type!=="exact_optional"&&s.type!=="optional"&&s.type!=="nullish"&&(At(this,"key",r,i,{input:void 0,expected:`"${o}"`,path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),i.abortEarly))break}}else At(this,"type",r,i);return r}}}function Vi(t){return{kind:"schema",type:"string",reference:Vi,expects:"string",async:!1,message:t,get"~standard"(){return Er(this)},"~run"(e,r){return typeof e.value=="string"?e.typed=!0:At(this,"type",e,r),e}}}function ro(t,e,r){const i=t["~run"]({value:e},Ci(r));if(i.issues)throw new Za(i.issues);return i.value}function io(...t){return{...t[0],pipe:t,get"~standard"(){return Er(this)},"~run"(e,r){for(const i of t)if(i.kind!=="metadata"){if(e.issues&&(i.kind==="schema"||i.kind==="transformation")){e.typed=!1;break}(!e.issues||!r.abortEarly&&!r.abortPipeEarly)&&(e=i["~run"](e,r))}return e}}}const Ht=io(Vi(),Ui(1)),no=Mi({datasrcstandard:Ht,datasrcsmall:Ht,datasrcsmallretina:Ht});class hr extends Error{constructor(e,r,i){super(`${i} status: ${e}`),this.status=e,this.responseBody=r,this.requestUrl=i,this.cause=r,Object.setPrototypeOf(this,hr.prototype)}toJSON(){return{name:this.name,status:this.status,message:this.message,requestUrl:this.requestUrl,cause:this.cause}}}class vr extends Error{constructor(r){super(`${r.requestUrl} invalid body`);me(this,"status");me(this,"requestUrl");this.status=r.status,this.requestUrl=r.requestUrl,this.cause=r.parseError,Object.setPrototypeOf(this,vr.prototype)}toJSON(){return{name:this.name,status:this.status,message:this.message,requestUrl:this.requestUrl,cause:this.cause instanceof Error?wi(this.cause):null}}}async function _r(t,e){const r=new Headers(e==null?void 0:e.headers);r.set("accept","application/json");const i=await fetch(t,{...e,headers:r});if(!i.ok){const n=await i.text().catch(()=>"");throw new hr(i.status,n,t.toString())}try{return await i.json()}catch(n){throw new vr({status:i.status,parseError:n,requestUrl:t.toString()})}}function ao(t){return t.trim().toLowerCase()}function Pi(t){return t.replaceAll(/[^a-z0-9]/gi,"").toUpperCase()}const oo={datasrcstandard:"Default_Center_0_0_757x527",datasrcsmall:"Default_Center_0_0_456x317",datasrcsmallretina:"Default_Center_0_0_912x634"};function so(t){const{styleCode:e,colour:r,image:i,productName:n,...a}=t;return{...a,stylecode:e,colors:r,images:i}}function uo(t){return Object.fromEntries(Object.entries(oo).map(([e,r])=>{var i;return[e,(i=t.find(n=>n.format===r?n.url:void 0))==null?void 0:i.url]}))}async function lo({params:{country:t,stylecode:e,lang:r},hyProxyBaseUrl:i,signal:n}){const a=new URLSearchParams;a.set("country",t),a.set("lang",r),a.set("stylecode",e);const o=await _r(`${i||""}/p-pers-view/api/monogram/config?${a}`,{signal:n});return so(o)}async function co({params:t,persCfgBaseUrl:e,signal:r}){const i=`${e}/api/v1/embossing/images/${Pi(t.stylecode)}`,n=await _r(i,{signal:r});if(!(n!=null&&n.length))throw new Error(`no personalization images found for ${t.stylecode}`);return ro(no,uo(n),{message(a){return`[pers-images][validation] empty or invalid response: ${a.message} ${i}`}})}async function fo(t){const e=new URLSearchParams;e.set("country",ao(t.params.country));const r=`${t.persCfgBaseUrl}/api/v1/embossing/config/${Pi(t.params.stylecode)}?${e}`,[i,n]=await Promise.all([co(t),_r(r,{signal:t.signal})]);if(n.status!=="ok")throw new Error(`${n.status}: ${n.message}`,{cause:n.status});return{...n.data,images:i}}async function go(t){return t.enableLegacyHyEndpoint?lo(t):fo(t)}function po({params:{country:t,stylecode:e,lang:r},data:i},n){const{persCfgBaseUrl:a,featureFlags:{enableLegacyHyEndpoint:o}}=i.config;Ze(()=>{const s=new AbortController;return go({params:{country:t,lang:r,stylecode:e},signal:s.signal,persCfgBaseUrl:a,enableLegacyHyEndpoint:o}).then(l=>{n({type:"monogram-fetch-success",monogramConfig:l})},l=>{s.signal.aborted||(Wt.warn("monogram-fetch-error",l),n({type:"monogram-fetch-error",error:l}))}),()=>{s.abort()}},[t,n,r,e,a,o])}function Eo({params:t,monogram:{embossingSelection:e}}){const r=Tt(e);r.current=e;const i=(e==null?void 0:e.text)??null,n=(e==null?void 0:e.color)??null,a=t.stylecode;Ze(()=>{const o=r.current;Pr(a,o)},[i,n,a]),Ze(()=>{const o=()=>{Pr(a,r.current)};return window.addEventListener(Vr,o),()=>{window.removeEventListener(Vr,o)}},[a])}const ho="embossing-selection",vo=({monogram:t})=>{Ze(()=>{const e=document.getElementById(ho);e&&t.type==="monogram-fetch-error"&&e.setAttribute("data-pers-fragment-hidden","true")},[t.type])};function _o(){const t=Ti(),e=gr();return po(e,t),Eo(e),vo(e),null}const mo=ra(()=>sa(()=>import("../drawer-CBJIjm-W.js"),__vite__mapDeps([0]))),Io=()=>{const{monogram:t,params:e}=gr();return t.type!=="monogram-fetch-success"?null:C(Li,{fallback:null,resetKeys:[e.stylecode,t.openModalCount],onError:(r,i)=>ft("embossing-selection-modal",r,{ctx:{info:i}}),children:C(ia,{children:C(mo,{})})})};function yo(t){return C(Li,{fallback:null,onError:(e,r)=>ft("embossing-selection",e,{ctx:{info:r}}),children:C(Oa,{microcopy:t.data.microcopy,children:C(da,{...t,children:Ve("div",{className:at(la.wrapper),children:[C(_o,{}),C(ja,{}),C(Io,{})]})})})})}function Ro(t){const e=No(t),r=new ArrayBuffer(e.length),i=new DataView(r);for(let n=0;n<r.byteLength;n++)i.setUint8(n,e.charCodeAt(n));return r}const Oo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function No(t){t.length%4===0&&(t=t.replace(/==?$/,""));let e="",r=0,i=0;for(let n=0;n<t.length;n++)r<<=6,r|=Oo.indexOf(t[n]),i+=6,i===24&&(e+=String.fromCharCode((r&16711680)>>16),e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255),r=i=0);return i===12?(r>>=4,e+=String.fromCharCode(r)):i===18&&(r>>=2,e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255)),e}const To=-1,Ao=-2,bo=-3,So=-4,Do=-5,wo=-6;function Lo(t,e){return Co(JSON.parse(t))}function Co(t,e){if(typeof t=="number")return n(t,!0);if(!Array.isArray(t)||t.length===0)throw new Error("Invalid input");const r=t,i=Array(r.length);function n(a,o=!1){if(a===To)return;if(a===bo)return NaN;if(a===So)return 1/0;if(a===Do)return-1/0;if(a===wo)return-0;if(o||typeof a!="number")throw new Error("Invalid input");if(a in i)return i[a];const s=r[a];if(!s||typeof s!="object")i[a]=s;else if(Array.isArray(s))if(typeof s[0]=="string"){const l=s[0];switch(l){case"Date":i[a]=new Date(s[1]);break;case"Set":const f=new Set;i[a]=f;for(let u=1;u<s.length;u+=1)f.add(n(s[u]));break;case"Map":const d=new Map;i[a]=d;for(let u=1;u<s.length;u+=2)d.set(n(s[u]),n(s[u+1]));break;case"RegExp":i[a]=new RegExp(s[1],s[2]);break;case"Object":i[a]=Object(s[1]);break;case"BigInt":i[a]=BigInt(s[1]);break;case"null":const E=Object.create(null);i[a]=E;for(let u=1;u<s.length;u+=2)E[s[u]]=n(s[u+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const u=globalThis[l],c=new u(n(s[1]));i[a]=s[2]!==void 0?c.subarray(s[2],s[3]):c;break}case"ArrayBuffer":{const u=s[1],c=Ro(u);i[a]=c;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const u=l.slice(9);i[a]=Temporal[u].from(s[1]);break}case"URL":{const u=new URL(s[1]);i[a]=u;break}case"URLSearchParams":{const u=new URLSearchParams(s[1]);i[a]=u;break}default:throw new Error(`Unknown type ${l}`)}}else{const l=new Array(s.length);i[a]=l;for(let f=0;f<s.length;f+=1){const d=s[f];d!==Ao&&(l[f]=n(d))}}else{const l={};i[a]=l;for(const f in s){if(f==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const d=s[f];l[f]=n(d)}}return i[a]}return n(0)}let ht;const Uo=new Uint8Array(16);function Mo(){if(!ht&&(ht=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ht))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ht(Uo)}const te=[];for(let t=0;t<256;++t)te.push((t+256).toString(16).slice(1));function Vo(t,e=0){return te[t[e+0]]+te[t[e+1]]+te[t[e+2]]+te[t[e+3]]+"-"+te[t[e+4]]+te[t[e+5]]+"-"+te[t[e+6]]+te[t[e+7]]+"-"+te[t[e+8]]+te[t[e+9]]+"-"+te[t[e+10]]+te[t[e+11]]+te[t[e+12]]+te[t[e+13]]+te[t[e+14]]+te[t[e+15]]}const Po=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Fr={randomUUID:Po};function Fo(t,e,r){if(Fr.randomUUID&&!t)return Fr.randomUUID();t=t||{};const i=t.random||(t.rng||Mo)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Vo(i)}var Ot={exports:{}},xo=Ot.exports,xr;function ko(){return xr||(xr=1,function(t){(function(e,r){t.exports?t.exports=r():e.jsonSchema=r()})(xo,function(){var e=i;e.Integer={type:"integer"};var r={String,Boolean,Number,Object,Array,Date};e.validate=i;function i(n,a){return i(n,a,{changing:!1})}e.checkPropertyChange=function(n,a,o){return i(n,a,{changing:o||"property"})};var i=e._validate=function(n,a,o){o||(o={});var s=o.changing;function l(u){return u.type||r[u.name]==u&&u.name.toLowerCase()}var f=[];function d(u,c,p,g){var _;p+=p?typeof g=="number"?"["+g+"]":typeof g>"u"?"":"."+g:g;function N(B){f.push({property:p,message:B})}if((typeof c!="object"||c instanceof Array)&&(p||typeof c!="function")&&!(c&&l(c)))return typeof c=="function"?u instanceof c||N("is not an instance of the class/constructor "+c.name):c&&N("Invalid schema/property definition "+c),null;s&&c.readonly&&N("is a readonly field, it can not be changed"),c.extends&&d(u,c.extends,p,g);function k(B,j){if(B){if(typeof B=="string"&&B!="any"&&(B=="null"?j!==null:typeof j!=B)&&!(j instanceof Array&&B=="array")&&!(j instanceof Date&&B=="date")&&!(B=="integer"&&j%1===0))return[{property:p,message:j+" - "+typeof j+" value found, but a "+B+" is required"}];if(B instanceof Array){for(var ne=[],Re=0;Re<B.length&&(ne=k(B[Re],j)).length;Re++);if(ne.length)return ne}else if(typeof B=="object"){var ve=f;f=[],d(j,B,p);var Fe=f;return f=ve,Fe}}return[]}if(u===void 0)c.required&&N("is missing and it is required");else if(f=f.concat(k(l(c),u)),c.disallow&&!k(c.disallow,u).length&&N(" disallowed value was matched"),u!==null){if(u instanceof Array){if(c.items){var R=c.items instanceof Array,b=c.items;for(g=0,_=u.length;g<_;g+=1)R&&(b=c.items[g]),o.coerce&&(u[g]=o.coerce(u[g],b)),f.concat(d(u[g],b,p,g))}c.minItems&&u.length<c.minItems&&N("There must be a minimum of "+c.minItems+" in the array"),c.maxItems&&u.length>c.maxItems&&N("There must be a maximum of "+c.maxItems+" in the array")}else(c.properties||c.additionalProperties)&&f.concat(E(u,c.properties,p,c.additionalProperties));if(c.pattern&&typeof u=="string"&&!u.match(c.pattern)&&N("does not match the regex pattern "+c.pattern),c.maxLength&&typeof u=="string"&&u.length>c.maxLength&&N("may only be "+c.maxLength+" characters long"),c.minLength&&typeof u=="string"&&u.length<c.minLength&&N("must be at least "+c.minLength+" characters long"),typeof c.minimum<"u"&&typeof u==typeof c.minimum&&c.minimum>u&&N("must have a minimum value of "+c.minimum),typeof c.maximum<"u"&&typeof u==typeof c.maximum&&c.maximum<u&&N("must have a maximum value of "+c.maximum),c.enum){var z=c.enum;_=z.length;for(var X,ie=0;ie<_;ie++)if(z[ie]===u){X=1;break}X||N("does not have a value in the enumeration "+z.join(", "))}typeof c.maxDecimal=="number"&&u.toString().match(new RegExp("\\.[0-9]{"+(c.maxDecimal+1)+",}"))&&N("may only have "+c.maxDecimal+" digits of decimal places")}return null}function E(u,c,p,g){if(typeof c=="object"){(typeof u!="object"||u instanceof Array)&&f.push({property:p,message:"an object is required"});for(var _ in c)if(c.hasOwnProperty(_)&&_!="__proto__"&&_!="constructor"){var N=u.hasOwnProperty(_)?u[_]:void 0;if(N===void 0&&o.existingOnly)continue;var k=c[_];N===void 0&&k.default&&(N=u[_]=k.default),o.coerce&&_ in u&&(N=u[_]=o.coerce(N,k)),d(N,k,p,_)}}for(_ in u){if(u.hasOwnProperty(_)&&!(_.charAt(0)=="_"&&_.charAt(1)=="_")&&c&&!c[_]&&g===!1)if(o.filter){delete u[_];continue}else f.push({property:p,message:"The property "+_+" is not defined in the schema and the schema does not allow additional properties"});var R=c&&c[_]&&c[_].requires;R&&!(R in u)&&f.push({property:p,message:"the presence of the property "+_+" requires that "+R+" also be present"}),N=u[_],g&&(!(c&&typeof c=="object")||!(_ in c))&&(o.coerce&&(N=u[_]=o.coerce(N,g)),d(N,g,p,_)),!s&&N&&N.$schema&&(f=f.concat(d(N,N.$schema,p,_)))}return f}return a&&d(n,a,"",s||""),!s&&n&&n.$schema&&d(n,n.$schema,"",""),{valid:!f.length,errors:f}};return e.mustBeValid=function(n){if(!n.valid)throw new TypeError(n.errors.map(function(a){return"for property "+a.property+": "+a.message}).join(`, 
`))},e})}(Ot)),Ot.exports}var Go=ko(),zt={exports:{}},kr;function Bo(){return kr||(kr=1,function(t){(function(){const e=a=>new TextEncoder().encode(a);function r(a,o){typeof a=="string"&&(a=e(a));let s=a.length,l=o^s,f=0,d;for(;s>=4;)d=a[f]&255|(a[++f]&255)<<8|(a[++f]&255)<<16|(a[++f]&255)<<24,d=(d&65535)*1540483477+(((d>>>16)*1540483477&65535)<<16),d^=d>>>24,d=(d&65535)*1540483477+(((d>>>16)*1540483477&65535)<<16),l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16)^d,s-=4,++f;switch(s){case 3:l^=(a[f+2]&255)<<16;case 2:l^=(a[f+1]&255)<<8;case 1:l^=a[f]&255,l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16)}return l^=l>>>13,l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16),l^=l>>>15,l>>>0}function i(a,o){typeof a=="string"&&(a=e(a));let s,l,f,d,E,u,c,p;for(s=a.length&3,l=a.length-s,f=o,E=3432918353,u=461845907,p=0;p<l;)c=a[p]&255|(a[++p]&255)<<8|(a[++p]&255)<<16|(a[++p]&255)<<24,++p,c=(c&65535)*E+(((c>>>16)*E&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(c&65535)*u+(((c>>>16)*u&65535)<<16)&4294967295,f^=c,f=f<<13|f>>>19,d=(f&65535)*5+(((f>>>16)*5&65535)<<16)&4294967295,f=(d&65535)+27492+(((d>>>16)+58964&65535)<<16);switch(c=0,s){case 3:c^=(a[p+2]&255)<<16;case 2:c^=(a[p+1]&255)<<8;case 1:c^=a[p]&255,c=(c&65535)*E+(((c>>>16)*E&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(c&65535)*u+(((c>>>16)*u&65535)<<16)&4294967295,f^=c}return f^=a.length,f^=f>>>16,f=(f&65535)*2246822507+(((f>>>16)*2246822507&65535)<<16)&4294967295,f^=f>>>13,f=(f&65535)*3266489909+(((f>>>16)*3266489909&65535)<<16)&4294967295,f^=f>>>16,f>>>0}const n=i;n.v2=r,n.v3=i,t.exports=n})()}(zt)),zt.exports}var qo=Bo();const Ho=Di(qo);var st={exports:{}},zo=st.exports,Gr;function jo(){return Gr||(Gr=1,function(t,e){(function(r,i){var n="1.0.40",a="",o="?",s="function",l="undefined",f="object",d="string",E="major",u="model",c="name",p="type",g="vendor",_="version",N="architecture",k="console",R="mobile",b="tablet",z="smarttv",X="wearable",ie="embedded",B=500,j="Amazon",ne="Apple",Re="ASUS",ve="BlackBerry",Fe="Browser",$e="Chrome",m="Edge",y="Firefox",S="Google",M="Huawei",U="LG",$="Microsoft",ae="Motorola",F="Opera",Y="Samsung",A="Sharp",K="Sony",fe="Xiaomi",Ge="Zebra",Be="Facebook",tt="Chromium OS",ee="Mac OS",_e=" Browser",qe=function(V,x){var L={};for(var q in V)x[q]&&x[q].length%2===0?L[q]=x[q].concat(V[q]):L[q]=V[q];return L},He=function(V){for(var x={},L=0;L<V.length;L++)x[V[L].toUpperCase()]=V[L];return x},ze=function(V,x){return typeof V===d?Le(x).indexOf(Le(V))!==-1:!1},Le=function(V){return V.toLowerCase()},gt=function(V){return typeof V===d?V.replace(/[^\d\.]/g,a).split(".")[0]:i},Ce=function(V,x){if(typeof V===d)return V=V.replace(/^\s\s*/,a),typeof x===l?V:V.substring(0,B)},Ne=function(V,x){for(var L=0,q,Ue,Te,G,D,Ae;L<x.length&&!D;){var Mt=x[L],br=x[L+1];for(q=Ue=0;q<Mt.length&&!D&&Mt[q];)if(D=Mt[q++].exec(V),D)for(Te=0;Te<br.length;Te++)Ae=D[++Ue],G=br[Te],typeof G===f&&G.length>0?G.length===2?typeof G[1]==s?this[G[0]]=G[1].call(this,Ae):this[G[0]]=G[1]:G.length===3?typeof G[1]===s&&!(G[1].exec&&G[1].test)?this[G[0]]=Ae?G[1].call(this,Ae,G[2]):i:this[G[0]]=Ae?Ae.replace(G[1],G[2]):i:G.length===4&&(this[G[0]]=Ae?G[3].call(this,Ae.replace(G[1],G[2])):i):this[G]=Ae||i;L+=2}},pt=function(V,x){for(var L in x)if(typeof x[L]===f&&x[L].length>0){for(var q=0;q<x[L].length;q++)if(ze(x[L][q],V))return L===o?i:L}else if(ze(x[L],V))return L===o?i:L;return x.hasOwnProperty("*")?x["*"]:V},Xn={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Tr={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ar={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,_],[/opios[\/ ]+([\w\.]+)/i],[_,[c,F+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[_,[c,F+" GX"]],[/\bopr\/([\w\.]+)/i],[_,[c,F]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[_,[c,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[_,[c,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[c,_],[/quark(?:pc)?\/([-\w\.]+)/i],[_,[c,"Quark"]],[/\bddg\/([\w\.]+)/i],[_,[c,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_,[c,"UC"+Fe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[_,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_,[c,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[_,[c,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[_,[c,"Smart Lenovo "+Fe]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+Fe],_],[/\bfocus\/([\w\.]+)/i],[_,[c,y+" Focus"]],[/\bopt\/([\w\.]+)/i],[_,[c,F+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[_,[c,F+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[_,[c,"MIUI"+_e]],[/fxios\/([\w\.-]+)/i],[_,[c,y]],[/\bqihoobrowser\/?([\w\.]*)/i],[_,[c,"360"]],[/\b(qq)\/([\w\.]+)/i],[[c,/(.+)/,"$1Browser"],_],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1"+_e],_],[/samsungbrowser\/([\w\.]+)/i],[_,[c,Y+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[_,[c,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[c,"Sogou Mobile"],_],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[c,_],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[c],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[_,c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,Be],_],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[c,_],[/\bgsa\/([\w\.]+) .*safari\//i],[_,[c,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[_,[c,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[_,[c,$e+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,$e+" WebView"],_],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_,[c,"Android "+Fe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,_],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[_,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[_,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[_,pt,Xn]],[/(webkit|khtml)\/([\w\.]+)/i],[c,_],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],_],[/(wolvic|librewolf)\/([\w\.]+)/i],[c,_],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_,[c,y+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[c,[_,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[c,[_,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[N,"amd64"]],[/(ia32(?=;))/i],[[N,Le]],[/((?:i[346]|x)86)[;\)]/i],[[N,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[N,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[N,"armhf"]],[/windows (ce|mobile); ppc;/i],[[N,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[N,/ower/,a,Le]],[/(sun4\w)[;\)]/i],[[N,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[N,Le]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[g,Y],[p,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[u,[g,Y],[p,R]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[g,ne],[p,R]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[g,ne],[p,b]],[/(macintosh);/i],[u,[g,ne]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[g,A],[p,R]],[/(?:honor)([-\w ]+)[;\)]/i],[u,[g,"Honor"],[p,R]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[g,M],[p,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[g,M],[p,R]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[u,/_/g," "],[g,fe],[p,R]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[g,fe],[p,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[g,"OPPO"],[p,R]],[/\b(opd2\d{3}a?) bui/i],[u,[g,"OPPO"],[p,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[g,"Vivo"],[p,R]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[g,"Realme"],[p,R]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[g,ae],[p,R]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[g,ae],[p,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[g,U],[p,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[g,U],[p,R]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[g,"Lenovo"],[p,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[g,"Nokia"],[p,R]],[/(pixel c)\b/i],[u,[g,S],[p,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[g,S],[p,R]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[g,K],[p,R]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[g,K],[p,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[g,"OnePlus"],[p,R]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[g,j],[p,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[g,j],[p,R]],[/(playbook);[-\w\),; ]+(rim)/i],[u,g,[p,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[g,ve],[p,R]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[g,Re],[p,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[g,Re],[p,R]],[/(nexus 9)/i],[u,[g,"HTC"],[p,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[u,/_/g," "],[p,R]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[u,[g,"TCL"],[p,b]],[/(itel) ((\w+))/i],[[g,Le],u,[p,pt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[g,"Acer"],[p,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[g,"Meizu"],[p,R]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[g,"Ulefone"],[p,R]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[u,[g,"Energizer"],[p,R]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[u,[g,"Cat"],[p,R]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[u,[g,"Smartfren"],[p,R]],[/droid.+; (a(?:015|06[35]|142p?))/i],[u,[g,"Nothing"],[p,R]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,u,[p,R]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,u,[p,b]],[/(surface duo)/i],[u,[g,$],[p,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[g,"Fairphone"],[p,R]],[/(u304aa)/i],[u,[g,"AT&T"],[p,R]],[/\bsie-(\w*)/i],[u,[g,"Siemens"],[p,R]],[/\b(rct\w+) b/i],[u,[g,"RCA"],[p,b]],[/\b(venue[\d ]{2,7}) b/i],[u,[g,"Dell"],[p,b]],[/\b(q(?:mv|ta)\w+) b/i],[u,[g,"Verizon"],[p,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[g,"Barnes & Noble"],[p,b]],[/\b(tm\d{3}\w+) b/i],[u,[g,"NuVision"],[p,b]],[/\b(k88) b/i],[u,[g,"ZTE"],[p,b]],[/\b(nx\d{3}j) b/i],[u,[g,"ZTE"],[p,R]],[/\b(gen\d{3}) b.+49h/i],[u,[g,"Swiss"],[p,R]],[/\b(zur\d{3}) b/i],[u,[g,"Swiss"],[p,b]],[/\b((zeki)?tb.*\b) b/i],[u,[g,"Zeki"],[p,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],u,[p,b]],[/\b(ns-?\w{0,9}) b/i],[u,[g,"Insignia"],[p,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[g,"NextBook"],[p,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],u,[p,R]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],u,[p,R]],[/\b(ph-1) /i],[u,[g,"Essential"],[p,R]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[g,"Envizen"],[p,b]],[/\b(trio[-\w\. ]+) b/i],[u,[g,"MachSpeed"],[p,b]],[/\btu_(1491) b/i],[u,[g,"Rotor"],[p,b]],[/(shield[\w ]+) b/i],[u,[g,"Nvidia"],[p,b]],[/(sprint) (\w+)/i],[g,u,[p,R]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[g,$],[p,R]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[g,Ge],[p,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[g,Ge],[p,R]],[/smart-tv.+(samsung)/i],[g,[p,z]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[g,Y],[p,z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,U],[p,z]],[/(apple) ?tv/i],[g,[u,ne+" TV"],[p,z]],[/crkey/i],[[u,$e+"cast"],[g,S],[p,z]],[/droid.+aft(\w+)( bui|\))/i],[u,[g,j],[p,z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[g,A],[p,z]],[/(bravia[\w ]+)( bui|\))/i],[u,[g,K],[p,z]],[/(mitv-\w{5}) bui/i],[u,[g,fe],[p,z]],[/Hbbtv.*(technisat) (.*);/i],[g,u,[p,z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Ce],[u,Ce],[p,z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,u,[p,k]],[/droid.+; (shield) bui/i],[u,[g,"Nvidia"],[p,k]],[/(playstation [345portablevi]+)/i],[u,[g,K],[p,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[g,$],[p,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[u,[g,Y],[p,X]],[/((pebble))app/i],[g,u,[p,X]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[g,ne],[p,X]],[/droid.+; (glass) \d/i],[u,[g,S],[p,X]],[/droid.+; (wt63?0{2,3})\)/i],[u,[g,Ge],[p,X]],[/droid.+; (glass) \d/i],[u,[g,S],[p,X]],[/(pico) (4|neo3(?: link|pro)?)/i],[g,u,[p,X]],[/; (quest( \d| pro)?)/i],[u,[g,Be],[p,X]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[p,ie]],[/(aeobc)\b/i],[u,[g,j],[p,ie]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[p,R]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[p,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,R]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_,[c,m+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[c,_],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[c,_],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,_],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[c,[_,pt,Tr]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,pt,Tr],[c,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[_,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,ee],[_,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,_],[/\(bb(10);/i],[_,[c,ve]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[_,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_,[c,y+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[_,[c,$e+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,tt],_],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,_],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],_],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[c,_]]},Oe=function(V,x){if(typeof V===f&&(x=V,V=i),!(this instanceof Oe))return new Oe(V,x).getResult();var L=typeof r!==l&&r.navigator?r.navigator:i,q=V||(L&&L.userAgent?L.userAgent:a),Ue=L&&L.userAgentData?L.userAgentData:i,Te=x?qe(Ar,x):Ar,G=L&&L.userAgent==q;return this.getBrowser=function(){var D={};return D[c]=i,D[_]=i,Ne.call(D,q,Te.browser),D[E]=gt(D[_]),G&&L&&L.brave&&typeof L.brave.isBrave==s&&(D[c]="Brave"),D},this.getCPU=function(){var D={};return D[N]=i,Ne.call(D,q,Te.cpu),D},this.getDevice=function(){var D={};return D[g]=i,D[u]=i,D[p]=i,Ne.call(D,q,Te.device),G&&!D[p]&&Ue&&Ue.mobile&&(D[p]=R),G&&D[u]=="Macintosh"&&L&&typeof L.standalone!==l&&L.maxTouchPoints&&L.maxTouchPoints>2&&(D[u]="iPad",D[p]=b),D},this.getEngine=function(){var D={};return D[c]=i,D[_]=i,Ne.call(D,q,Te.engine),D},this.getOS=function(){var D={};return D[c]=i,D[_]=i,Ne.call(D,q,Te.os),G&&!D[c]&&Ue&&Ue.platform&&Ue.platform!="Unknown"&&(D[c]=Ue.platform.replace(/chrome os/i,tt).replace(/macos/i,ee)),D},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return q},this.setUA=function(D){return q=typeof D===d&&D.length>B?Ce(D,B):D,this},this.setUA(q),this};Oe.VERSION=n,Oe.BROWSER=He([c,_,E]),Oe.CPU=He([N]),Oe.DEVICE=He([u,g,p,k,R,z,b,X,ie]),Oe.ENGINE=Oe.OS=He([c,_]),t.exports&&(e=t.exports=Oe),e.UAParser=Oe;var We=typeof r!==l&&(r.jQuery||r.Zepto);if(We&&!We.ua){var Et=new Oe;We.ua=Et.getResult(),We.ua.get=function(){return Et.getUA()},We.ua.set=function(V){Et.setUA(V);var x=Et.getResult();for(var L in x)We.ua[L]=x[L]}}})(typeof window=="object"?window:zo)}(st,st.exports)),st.exports}var Ko=jo(),Jt=function(t,e){return Jt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r[n]=i[n])},Jt(t,e)};function Xe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Jt(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ee=function(){return Ee=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Ee.apply(this,arguments)};function W(t,e,r,i){function n(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(d){try{f(i.next(d))}catch(E){o(E)}}function l(d){try{f(i.throw(d))}catch(E){o(E)}}function f(d){d.done?a(d.value):n(d.value).then(s,l)}f((i=i.apply(t,[])).next())})}function J(t,e){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,n,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(f){return function(d){return l([f,d])}}function l(f){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,f[0]&&(r=0)),r;)try{if(i=1,n&&(a=f[0]&2?n.return:f[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,f[1])).done)return a;switch(n=0,a&&(f=[f[0]&2,a.value]),f[0]){case 0:case 1:a=f;break;case 4:return r.label++,{value:f[1],done:!1};case 5:r.label++,n=f[1],f=[0];continue;case 7:f=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(f[0]===6||f[0]===2)){r=0;continue}if(f[0]===3&&(!a||f[1]>a[0]&&f[1]<a[3])){r.label=f[1];break}if(f[0]===6&&r.label<a[1]){r.label=a[1],a=f;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(f);break}a[2]&&r.ops.pop(),r.trys.pop();continue}f=e.call(t,r)}catch(d){f=[6,d],n=0}finally{i=a=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function et(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,a;i<n;i++)(a||!(i in e))&&(a||(a=Array.prototype.slice.call(e,0,i)),a[i]=e[i]);return t.concat(a||Array.prototype.slice.call(e))}var Yo=function(){function t(){}return t.prototype.handleError=function(e){},t}(),Fi=new Yo;function Xo(t){Fi=t}function xi(){return Fi}var $o=Math.pow(2,53);function Ie(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!t)return{};if(typeof Object.assign=="function")return Object.assign.apply(Object,et([t],e,!1));for(var i=Object(t),n=0;n<e.length;n++){var a=e[n];if(a!=null)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(i[o]=a[o])}return i}function Wo(){return Math.round(new Date().getTime())}function Jo(t){return typeof t=="number"&&Math.abs(t)<=$o}function oe(t,e){return t?Bi(t,function(r){return r[e]}):{}}function Qo(t){return typeof t=="number"}function Ct(){return Fo()}function ki(){return new Date().getTime()}function bt(t,e){for(var r=!1,i=Object.keys(t),n=0;n<i.length;n++)if(e===t[i[n]]){r=!0;break}return r}function Zo(t,e){var r={};return t.forEach(function(i){var n=e(i);r[n]=r[n]||[],r[n].push(i)}),we(r)}function we(t){return Object.keys(t).map(function(e){return t[e]})}function Gi(t){return Object.keys(t).map(function(e){return[e,t[e]]})}function mr(t,e){for(var r,i=0,n=t;i<n.length;i++){var a=n[i];if(e(a)){r=a;break}}return r}function Bi(t,e){var r={};return t.forEach(function(i){var n=e(i);r[n]=i}),r}function P(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=0;return t.replace(/%s/g,function(){var n=e[i++],a=typeof n;return a==="function"?n():a==="string"?n:String(n)})}function qi(t,e){return t.length===e.length&&t.every(function(r,i){return r===e[i]})}var H={assign:Ie,checkArrayEquality:qi,currentTimestamp:Wo,isSafeInteger:Jo,keyBy:oe,uuid:Ct,isNumber:Qo,getTimestamp:ki,isValidEnum:bt,groupBy:Zo,objectValues:we,objectEntries:Gi,find:mr,keyByUtil:Bi,sprintf:P},O;(function(t){t[t.NOTSET=0]="NOTSET",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARNING=3]="WARNING",t[t.ERROR=4]="ERROR"})(O||(O={}));var Br={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function Ir(t){return typeof t!="string"||(t=t.toUpperCase(),t==="WARN"&&(t="WARNING"),!Br[t])?t:Br[t]}var es=function(){function t(){this.defaultLoggerFacade=new qr,this.loggers={}}return t.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new qr({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},t}(),ts=function(){function t(e){e===void 0&&(e={}),this.logLevel=O.NOTSET,e.logLevel!==void 0&&bt(O,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=e.logToConsole!==void 0?!!e.logToConsole:!0,this.prefix=e.prefix!==void 0?e.prefix:"[OPTIMIZELY]"}return t.prototype.log=function(e,r){if(!(!this.shouldLog(e)||!this.logToConsole)){var i="".concat(this.prefix," - ").concat(this.getLogLevelName(e)," ").concat(this.getTime()," ").concat(r);this.consoleLog(e,[i])}},t.prototype.setLogLevel=function(e){e=Ir(e),!bt(O,e)||e===void 0?this.logLevel=O.ERROR:this.logLevel=e},t.prototype.getTime=function(){return new Date().toISOString()},t.prototype.shouldLog=function(e){return e>=this.logLevel},t.prototype.getLogLevelName=function(e){switch(e){case O.DEBUG:return"DEBUG";case O.INFO:return"INFO ";case O.WARNING:return"WARN ";case O.ERROR:return"ERROR";default:return"NOTSET"}},t.prototype.consoleLog=function(e,r){switch(e){case O.DEBUG:console.log.apply(console,r);break;case O.INFO:console.info.apply(console,r);break;case O.WARNING:console.warn.apply(console,r);break;case O.ERROR:console.error.apply(console,r);break;default:console.log.apply(console,r)}},t}(),Qt=O.NOTSET,Zt=null,qr=function(){function t(e){e===void 0&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}return t.prototype.log=function(e,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];this.internalLog(Ir(e),{message:r,splat:i})},t.prototype.info=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(O.INFO,e,r)},t.prototype.debug=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(O.DEBUG,e,r)},t.prototype.warn=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(O.WARNING,e,r)},t.prototype.error=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];this.namedLog(O.ERROR,e,r)},t.prototype.format=function(e){return"".concat(this.messagePrefix?this.messagePrefix+": ":"").concat(P.apply(void 0,et([e.message],e.splat,!1)))},t.prototype.internalLog=function(e,r){Zt&&(e<Qt||(Zt.log(e,this.format(r)),r.error&&r.error instanceof Error&&xi().handleError(r.error)))},t.prototype.namedLog=function(e,r,i){var n;if(r instanceof Error){n=r,r=n.message,this.internalLog(e,{error:n,message:r,splat:i});return}if(i.length===0){this.internalLog(e,{message:r,splat:i});return}var a=i[i.length-1];a instanceof Error&&(n=a,i.splice(-1)),this.internalLog(e,{message:r,error:n,splat:i})},t}(),rs=new es;function Q(t){return rs.getLogger(t)}function Hi(t){Zt=t}function is(t){t=Ir(t),!bt(O,t)||t===void 0?Qt=O.ERROR:Qt=t}var Ye={setLogLevel:is,setLogHandler:Hi};function ns(t,e){var r=t.context,i=e.context;return r.accountId===i.accountId&&r.projectId===i.projectId&&r.clientName===i.clientName&&r.clientVersion===i.clientVersion&&r.revision===i.revision&&r.anonymizeIP===i.anonymizeIP&&r.botFiltering===i.botFiltering}var as=Q("EventProcessor"),os=function(){function t(e){var r=e.timeout,i=e.callback;this.timeout=Math.max(r,0),this.callback=i}return t.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},t.prototype.refresh=function(){this.stop(),this.start()},t.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},t}(),ss=function(){function t(e){var r=e.sink;this.sink=r}return t.prototype.start=function(){return Promise.resolve()},t.prototype.stop=function(){return Promise.resolve()},t.prototype.enqueue=function(e){this.sink([e])},t}(),us=function(){function t(e){var r=e.flushInterval,i=e.maxQueueSize,n=e.sink,a=e.closingSink,o=e.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(i,1),this.sink=n,this.closingSink=a,this.batchComparator=o,this.timer=new os({callback:this.flush.bind(this),timeout:r}),this.started=!1}return t.prototype.start=function(){return this.started=!0,Promise.resolve()},t.prototype.stop=function(){this.started=!1;var e=this.closingSink?this.closingSink(this.buffer):this.sink(this.buffer);return this.buffer=[],this.timer.stop(),e},t.prototype.enqueue=function(e){if(!this.started){as.warn("Queue is stopped, not accepting event");return}var r=this.buffer[0];r&&!this.batchComparator(r,e)&&this.flush(),this.buffer.length===0&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()},t.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},t}(),h={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},I={BROWSER_ODP_MANAGER_INITIALIZATION_FAILED:"%s: Error initializing Browser ODP Manager.",CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",FETCH_SEGMENTS_FAILED_NETWORK_ERROR:"%s: Audience segments fetch failed. (network error)",FETCH_SEGMENTS_FAILED_DECODE_ERROR:"%s: Audience segments fetch failed. (decode error)",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_CONFIG:"%s: Provided Optimizely config is in an invalid format.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",LOCAL_STORAGE_DOES_NOT_EXIST:"Error accessing window localStorage.",MISSING_INTEGRATION_KEY:"%s: Integration key missing from datafile. All integrations should include a key.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",ODP_CONFIG_NOT_AVAILABLE:"%s: ODP is not integrated to the project.",ODP_EVENT_FAILED:"ODP event send failed.",ODP_FETCH_QUALIFIED_SEGMENTS_SEGMENTS_MANAGER_MISSING:"%s: ODP unable to fetch qualified segments (Segments Manager not initialized).",ODP_IDENTIFY_FAILED_EVENT_MANAGER_MISSING:"%s: ODP identify event %s is not dispatched (Event Manager not instantiated).",ODP_INITIALIZATION_FAILED:"%s: ODP failed to initialize.",ODP_INVALID_DATA:"%s: ODP data is not valid",ODP_EVENT_FAILED_ODP_MANAGER_MISSING:"%s: ODP Event failed to send. (ODP Manager not initialized).",ODP_FETCH_QUALIFIED_SEGMENTS_FAILED_ODP_MANAGER_MISSING:"%s: ODP failed to Fetch Qualified Segments. (ODP Manager not initialized).",ODP_IDENTIFY_USER_FAILED_ODP_MANAGER_MISSING:"%s: ODP failed to Identify User. (ODP Manager not initialized).",ODP_IDENTIFY_USER_FAILED_USER_CONTEXT_INITIALIZATION:"%s: ODP failed to Identify User. (Failed during User Context Initialization).",ODP_MANAGER_UPDATE_SETTINGS_FAILED_EVENT_MANAGER_MISSING:"%s: ODP Manager failed to update OdpConfig settings for internal event manager. (Event Manager not initialized).",ODP_MANAGER_UPDATE_SETTINGS_FAILED_SEGMENTS_MANAGER_MISSING:"%s: ODP Manager failed to update OdpConfig settings for internal segments manager. (Segments Manager not initialized).",ODP_NOT_ENABLED:"ODP is not enabled",ODP_NOT_INTEGRATED:"%s: ODP is not integrated",ODP_SEND_EVENT_FAILED_EVENT_MANAGER_MISSING:"%s: ODP send event %s was not dispatched (Event Manager not instantiated).",ODP_SEND_EVENT_FAILED_UID_MISSING:"%s: ODP send event %s was not dispatched (No valid user identifier provided).",ODP_SEND_EVENT_FAILED_VUID_MISSING:"%s: ODP send event %s was not dispatched (Unable to fetch VUID).",ODP_VUID_INITIALIZATION_FAILED:"%s: ODP VUID initialization failed.",ODP_VUID_REGISTRATION_FAILED:"%s: ODP VUID failed to be registered.",ODP_VUID_REGISTRATION_FAILED_EVENT_MANAGER_MISSING:"%s: ODP register vuid failed. (Event Manager not instantiated).",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},v={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_DEFAULT_DECIDE_OPTIONS:"%s: Provided default decide options is not an array.",INVALID_DECIDE_OPTIONS:"%s: Provided decide options is not an array. Using default decide options.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",ODP_DISABLED:"ODP Disabled.",ODP_IDENTIFY_FAILED_ODP_DISABLED:"%s: ODP identify event for user %s is not dispatched (ODP disabled).",ODP_IDENTIFY_FAILED_ODP_NOT_INTEGRATED:"%s: ODP identify event %s is not dispatched (ODP not integrated).",ODP_SEND_EVENT_IDENTIFIER_CONVERSION_FAILED:"%s: sendOdpEvent failed to parse through and convert fs_user_id aliases",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",UNRECOGNIZED_DECIDE_OPTION:"%s: Unrecognized decide option %s provided.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned bucket %s to user with bucketing ID %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Got variable value "%s" for variable "%s" of feature flag "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for %s "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for %s %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},De={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent",FORCED_DECISION_NULL_RULE_KEY:"$opt_null_rule_key"},yr="javascript-sdk",zi="node-sdk",ls="react-sdk",cs="react-native-sdk",fs="react-native-js-sdk",Rr="5.3.5",je={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable",ALL_FEATURE_VARIABLES:"all-feature-variables",FLAG:"flag"},re={FEATURE_TEST:"feature-test",ROLLOUT:"rollout",EXPERIMENT:"experiment"},er={RULE:"rule",EXPERIMENT:"experiment"},pe={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string",JSON:"json"},Nt={V2:"2",V3:"3",V4:"4"},tr={SDK_NOT_READY:"Optimizely SDK not configured properly yet.",FLAG_KEY_INVALID:'No flag was found for key "%s".',VARIABLE_VALUE_INVALID:'Variable value for key "%s" is invalid or wrong type.'},se;(function(t){t.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",t.DECISION="DECISION:type, userId, attributes, decisionInfo",t.LOG_EVENT="LOG_EVENT:logEvent",t.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",t.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"})(se||(se={}));var ji=60*1e3,Ki=10*1e3,Yi=10*1e3,ye;(function(t){t.VUID="vuid",t.FS_USER_ID="fs_user_id"})(ye||(ye={}));var Xi="fs-user-id",St="fullstack",lt;(function(t){t.IDENTIFIED="identified",t.INITIALIZED="client_initialized"})(lt||(lt={}));var ds=Object.freeze({__proto__:null,LOG_LEVEL:h,ERROR_MESSAGES:I,LOG_MESSAGES:v,CONTROL_ATTRIBUTES:De,JAVASCRIPT_CLIENT_ENGINE:yr,NODE_CLIENT_ENGINE:zi,REACT_CLIENT_ENGINE:ls,REACT_NATIVE_CLIENT_ENGINE:cs,REACT_NATIVE_JS_CLIENT_ENGINE:fs,CLIENT_VERSION:Rr,DECISION_NOTIFICATION_TYPES:je,DECISION_SOURCES:re,AUDIENCE_EVALUATION_TYPES:er,FEATURE_VARIABLE_TYPES:pe,DATAFILE_VERSIONS:Nt,DECISION_MESSAGES:tr,get NOTIFICATION_TYPES(){return se},REQUEST_TIMEOUT_MS:ji,REQUEST_TIMEOUT_ODP_SEGMENTS_MS:Ki,REQUEST_TIMEOUT_ODP_EVENTS_MS:Yi,get ODP_USER_KEY(){return ye},FS_USER_ID_ALIAS:Xi,ODP_DEFAULT_EVENT_TYPE:St,get ODP_EVENT_ACTION(){return lt}}),rr=3e4,ir=10,$i=Q("EventProcessor");function gs(t){return t<=0&&($i.warn("Invalid flushInterval ".concat(t,", defaulting to ").concat(rr)),t=rr),t}function ps(t){return t=Math.floor(t),t<1&&($i.warn("Invalid batchSize ".concat(t,", defaulting to ").concat(ir)),t=ir),t=Math.max(1,t),t}function Es(t,e,r,i,n){var a;return t>1?a=new us({flushInterval:e,maxQueueSize:t,sink:i,closingSink:n,batchComparator:r}):a=new ss({sink:i}),a}function hs(t,e){t&&t.sendNotifications(se.LOG_EVENT,e)}var Hr=Q("EventProcessor"),vs=function(){function t(e){var r=e.key,i=e.maxValues,n=i===void 0?1e3:i;this.LS_KEY=r,this.maxValues=n}return t.prototype.get=function(e){return this.getMap()[e]||null},t.prototype.set=function(e,r){var i=this.getMap();i[e]=r,this.replace(i)},t.prototype.remove=function(e){var r=this.getMap();delete r[e],this.replace(r)},t.prototype.values=function(){return we(this.getMap())},t.prototype.clear=function(){this.replace({})},t.prototype.replace=function(e){try{typeof window<"u"?window&&window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(e)):localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(r){Hr.error(String(r))}},t.prototype.clean=function(){var e=this.getMap(),r=Object.keys(e),i=r.length-this.maxValues;if(!(i<1)){var n=r.map(function(o){return{key:o,value:e[o]}});n.sort(function(o,s){return o.value.timestamp-s.value.timestamp});for(var a=0;a<i;a++)delete e[n[a].key];this.replace(e)}},t.prototype.getMap=function(){try{var e=typeof window<"u"?window&&window.localStorage&&localStorage.getItem(this.LS_KEY):localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(r){Hr.error(r)}return{}},t}(),zr=Q("EventProcessor"),_s=function(){function t(e){var r=e.eventDispatcher,i=e.store;this.dispatcher=r,this.store=i}return t.prototype.dispatchEvent=function(e,r){this.send({uuid:Ct(),timestamp:ki(),request:e},r)},t.prototype.sendPendingEvents=function(){var e=this,r=this.store.values();zr.debug("Sending %s pending events from previous page",r.length),r.forEach(function(i){try{e.send(i,function(){})}catch(n){zr.debug(String(n))}})},t.prototype.send=function(e,r){var i=this;this.store.set(e.uuid,e),this.dispatcher.dispatchEvent(e.request,function(n){i.store.remove(e.uuid),r(n)})},t}(),Wi=function(t){Xe(e,t);function e(r){var i=r.eventDispatcher;return t.call(this,{eventDispatcher:i,store:new vs({maxValues:100,key:"fs_optly_pending_events"})})||this}return e}(_s),ms="campaign_activated",Is="custom",jr="$opt_bot_filtering";function ys(t){var e=[],r=t[0];return t.forEach(function(i){if(i.type==="conversion"||i.type==="impression"){var n=Ns(i);i.type==="impression"?n.snapshots.push(Os(i)):i.type==="conversion"&&n.snapshots.push(Rs(i)),e.push(n)}}),{client_name:r.context.clientName,client_version:r.context.clientVersion,account_id:r.context.accountId,project_id:r.context.projectId,revision:r.context.revision,anonymize_ip:r.context.anonymizeIP,enrich_decisions:!0,visitors:e}}function Rs(t){var e=Ee({},t.tags);delete e.revenue,delete e.value;var r={entity_id:t.event.id,key:t.event.key,timestamp:t.timestamp,uuid:t.uuid};return t.tags&&(r.tags=t.tags),t.value!=null&&(r.value=t.value),t.revenue!=null&&(r.revenue=t.revenue),{events:[r]}}function Os(t){var e,r,i=t.layer,n=t.experiment,a=t.variation,o=t.ruleKey,s=t.flagKey,l=t.ruleType,f=t.enabled,d=i?i.id:null,E=(e=n==null?void 0:n.id)!==null&&e!==void 0?e:"",u=(r=a==null?void 0:a.id)!==null&&r!==void 0?r:"",c=a?a.key:"";return{decisions:[{campaign_id:d,experiment_id:E,variation_id:u,metadata:{flag_key:s,rule_key:o,rule_type:l,variation_key:c,enabled:f}}],events:[{entity_id:d,timestamp:t.timestamp,key:ms,uuid:t.uuid}]}}function Ns(t){var e={snapshots:[],visitor_id:t.user.id,attributes:[]},r="custom";return t.user.attributes.forEach(function(i){e.attributes.push({entity_id:i.entityId,key:i.key,type:r,value:i.value})}),typeof t.context.botFiltering=="boolean"&&e.attributes.push({entity_id:jr,key:jr,type:Is,value:t.context.botFiltering}),e}function Ts(t){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:ys(t)}}var As=function(){function t(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return t.prototype.trackRequest=function(e){var r=this;this.reqsInFlightCount++;var i=function(){r.reqsInFlightCount--,r.reqsInFlightCount===0&&(r.reqsCompleteResolvers.forEach(function(n){return n()}),r.reqsCompleteResolvers=[])};e.then(i,i)},t.prototype.onRequestsComplete=function(){var e=this;return new Promise(function(r){e.reqsInFlightCount===0?r():e.reqsCompleteResolvers.push(r)})},t}(),Kr=Q("LogTierV1EventProcessor"),Yr=function(){function t(e){var r=e.dispatcher,i=e.closingDispatcher,n=e.flushInterval,a=n===void 0?rr:n,o=e.batchSize,s=o===void 0?ir:o,l=e.notificationCenter;this.dispatcher=r,this.closingDispatcher=i,this.notificationCenter=l,this.requestTracker=new As,a=gs(a),s=ps(s),this.queue=Es(s,a,ns,this.drainQueue.bind(this,!1),this.drainQueue.bind(this,!0))}return t.prototype.drainQueue=function(e,r){var i=this,n=new Promise(function(a){if(Kr.debug("draining queue with %s events",r.length),r.length===0){a();return}var o=Ts(r),s=e&&i.closingDispatcher?i.closingDispatcher:i.dispatcher;s.dispatchEvent(o,function(){a()}),hs(i.notificationCenter,o)});return this.requestTracker.trackRequest(n),n},t.prototype.process=function(e){this.queue.enqueue(e)},t.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(e){Kr.error('Error stopping EventProcessor: "%s"',Object(e).message,String(e))}return Promise.resolve()},t.prototype.start=function(){return W(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return[4,this.queue.start()];case 1:return e.sent(),[2]}})})},t}(),Ke="CONFIG_VALIDATOR",bs=[Nt.V2,Nt.V3,Nt.V4],Ss=function(t){if(typeof t=="object"&&t!==null){var e=t,r=e.errorHandler,i=e.eventDispatcher,n=e.logger;if(r&&typeof r.handleError!="function")throw new Error(P(I.INVALID_ERROR_HANDLER,Ke));if(i&&typeof i.dispatchEvent!="function")throw new Error(P(I.INVALID_EVENT_DISPATCHER,Ke));if(n&&typeof n.log!="function")throw new Error(P(I.INVALID_LOGGER,Ke));return!0}throw new Error(P(I.INVALID_CONFIG,Ke))},Ds=function(t){if(!t)throw new Error(P(I.NO_DATAFILE_SPECIFIED,Ke));if(typeof t=="string")try{t=JSON.parse(t)}catch{throw new Error(P(I.INVALID_DATAFILE_MALFORMED,Ke))}if(typeof t=="object"&&!Array.isArray(t)&&t!==null&&bs.indexOf(t.version)===-1)throw new Error(P(I.INVALID_DATAFILE_VERSION,Ke,t.version));return t},Ji={validate:Ss,validateDatafile:Ds};function ws(){}var Ls={handleError:ws},Xr="POST",Cs="GET",$r=4,Us=function(t,e){var r=t.params,i=t.url,n;t.httpVerb===Xr?(n=new XMLHttpRequest,n.open(Xr,i,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(n.readyState===$r&&e&&typeof e=="function")try{e({statusCode:n.status})}catch{}},n.send(JSON.stringify(r))):(i+="?wxhr=true",r&&(i+="&"+Ms(r)),n=new XMLHttpRequest,n.open(Cs,i,!0),n.onreadystatechange=function(){if(n.readyState===$r&&e&&typeof e=="function")try{e({statusCode:n.status})}catch{}},n.send())},Ms=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},Qi={dispatchEvent:Us},Vs=function(t,e){var r=t.params,i=t.url,n=new Blob([JSON.stringify(r)],{type:"application/json"}),a=navigator.sendBeacon(i,n);e({statusCode:a?200:500})},Zi={dispatchEvent:Vs},en=function(){function t(){}return t.prototype.log=function(){},t}();function Or(t){return new ts(t)}function Ps(){return new en}var Fs=Object.freeze({__proto__:null,NoOpLogger:en,createLogger:Or,createNoOpLogger:Ps}),xs=function(t){return typeof t=="number"&&H.isSafeInteger(t)?t>=1:!1},ks=function(t){return typeof t=="number"&&H.isSafeInteger(t)?t>0:!1},Wr={validateEventBatchSize:xs,validateEventFlushInterval:ks},Gs="NOTIFICATION_CENTER",Bs=function(){function t(e){var r=this;this.logger=e.logger,this.errorHandler=e.errorHandler,this.notificationListeners={},we(se).forEach(function(i){r.notificationListeners[i]=[]}),this.listenerId=1}return t.prototype.addNotificationListener=function(e,r){try{var i=we(se),n=i.indexOf(e)>-1;if(!n)return-1;this.notificationListeners[e]||(this.notificationListeners[e]=[]);var a=!1;if((this.notificationListeners[e]||[]).forEach(function(s){if(s.callback===r){a=!0;return}}),a)return-1;this.notificationListeners[e].push({id:this.listenerId,callback:r});var o=this.listenerId;return this.listenerId+=1,o}catch(s){return this.logger.log(h.ERROR,s.message),this.errorHandler.handleError(s),-1}},t.prototype.removeNotificationListener=function(e){var r=this;try{var i,n;if(Object.keys(this.notificationListeners).some(function(a){var o=r.notificationListeners[a];return(o||[]).every(function(s,l){return s.id===e?(i=l,n=a,!1):!0}),i!==void 0&&n!==void 0}),i!==void 0&&n!==void 0)return this.notificationListeners[n].splice(i,1),!0}catch(a){this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a)}return!1},t.prototype.clearAllNotificationListeners=function(){var e=this;try{we(se).forEach(function(r){e.notificationListeners[r]=[]})}catch(r){this.logger.log(h.ERROR,r.message),this.errorHandler.handleError(r)}},t.prototype.clearNotificationListeners=function(e){try{this.notificationListeners[e]=[]}catch(r){this.logger.log(h.ERROR,r.message),this.errorHandler.handleError(r)}},t.prototype.sendNotifications=function(e,r){var i=this;try{(this.notificationListeners[e]||[]).forEach(function(n){var a=n.callback;try{a(r)}catch(o){i.logger.log(h.ERROR,v.NOTIFICATION_LISTENER_EXCEPTION,Gs,e,o.message)}})}catch(n){this.logger.log(h.ERROR,n.message),this.errorHandler.handleError(n)}},t}();function tn(t){return new Bs(t)}function qs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(Yr.bind.apply(Yr,et([void 0],t,!1)))}var Hs={createEventProcessor:qs,LocalStoragePendingEventsDispatcher:Wi},Dt;(function(t){t.IGNORE_CACHE="IGNORE_CACHE",t.RESET_CACHE="RESET_CACHE"})(Dt||(Dt={}));var Jr;(function(t){t.BOOLEAN="boolean",t.DOUBLE="double",t.INTEGER="integer",t.STRING="string",t.JSON="json"})(Jr||(Jr={}));var Se;(function(t){t.DISABLE_DECISION_EVENT="DISABLE_DECISION_EVENT",t.ENABLED_FLAGS_ONLY="ENABLED_FLAGS_ONLY",t.IGNORE_USER_PROFILE_SERVICE="IGNORE_USER_PROFILE_SERVICE",t.INCLUDE_REASONS="INCLUDE_REASONS",t.EXCLUDE_VARIABLES="EXCLUDE_VARIABLES"})(Se||(Se={}));var zs=5,js=zs*60*1e3,rn=30,Ks=rn*1e3,Ys="Polling intervals below ".concat(rn," seconds are not recommended."),Xs="https://cdn.optimizely.com/datafiles/%s.json",jt=[0,8,16,32,64,128,256,512],$s=60*1e3,Ws=Q("DatafileManager"),Js="GET",Qs=4;function Zs(t){var e=t.getAllResponseHeaders();if(e===null)return{};var r=e.split(`\r
`),i={};return r.forEach(function(n){var a=n.indexOf(": ");if(a>-1){var o=n.slice(0,a),s=n.slice(a+2);s.length>0&&(i[o]=s)}}),i}function eu(t,e){Object.keys(t).forEach(function(r){var i=t[r];e.setRequestHeader(r,i)})}function tu(t,e){var r=new XMLHttpRequest,i=new Promise(function(n,a){r.open(Js,t,!0),eu(e,r),r.onreadystatechange=function(){if(r.readyState===Qs){var o=r.status;if(o===0){a(new Error("Request error"));return}var s=Zs(r),l={statusCode:r.status,body:r.responseText,headers:s};n(l)}},r.timeout=$s,r.ontimeout=function(){Ws.error("Request timed out")},r.send()});return{responsePromise:i,abort:function(){r.abort()}}}var ru=function(){function t(){this.listeners={},this.listenerId=1}return t.prototype.on=function(e,r){var i=this;this.listeners[e]||(this.listeners[e]={});var n=String(this.listenerId);return this.listenerId++,this.listeners[e][n]=r,function(){i.listeners[e]&&delete i.listeners[e][n]}},t.prototype.emit=function(e,r){var i=this.listeners[e];i&&Object.keys(i).forEach(function(n){var a=i[n];a(r)})},t.prototype.removeAllListeners=function(){this.listeners={}},t}();function iu(){return Math.round(Math.random()*1e3)}var nu=function(){function t(){this.errorCount=0}return t.prototype.getDelay=function(){if(this.errorCount===0)return 0;var e=jt[Math.min(jt.length-1,this.errorCount)];return e*1e3+iu()},t.prototype.countError=function(){this.errorCount<jt.length-1&&this.errorCount++},t.prototype.reset=function(){this.errorCount=0},t}(),nn=function(){function t(){}return t.getNotificationCenter=function(e,r){if(r===void 0&&(r=Q()),!e){r.log(O.ERROR,"No SDK key provided to getNotificationCenter.");return}var i;return this._notificationCenters.has(e)?i=this._notificationCenters.get(e):(i=tn({logger:r,errorHandler:{handleError:function(){}}}),this._notificationCenters.set(e,i)),i},t.removeNotificationCenter=function(e){if(e){var r=this._notificationCenters.get(e);r&&(r.clearAllNotificationListeners(),this._notificationCenters.delete(e))}},t._notificationCenters=new Map,t}(),ce=Q("DatafileManager"),au="update";function Qr(t){return t>=200&&t<400}var ou={get:function(){return Promise.resolve(void 0)},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve(!1)}},su=function(){function t(e){var r=this,i=Ee(Ee({},this.getConfigDefaults()),e),n=i.datafile,a=i.autoUpdate,o=a===void 0?!1:a,s=i.sdkKey,l=i.updateInterval,f=l===void 0?js:l,d=i.urlTemplate,E=d===void 0?Xs:d,u=i.cache,c=u===void 0?ou:u;this.cache=c,this.cacheKey="opt-datafile-"+s,this.sdkKey=s,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(p,g){r.readyPromiseResolver=p,r.readyPromiseRejecter=g}),n?(this.currentDatafile=n,s||this.resolveReadyPromise()):this.currentDatafile="",this.isStarted=!1,this.datafileUrl=P(E,s),this.emitter=new ru,this.autoUpdate=o,this.updateInterval=f,this.updateInterval<Ks&&ce.warn(Ys),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new nu,this.syncOnCurrentRequestComplete=!1}return t.prototype.get=function(){return this.currentDatafile},t.prototype.start=function(){this.isStarted||(ce.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},t.prototype.stop=function(){return ce.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},t.prototype.onReady=function(){return this.readyPromise},t.prototype.on=function(e,r){return this.emitter.on(e,r)},t.prototype.onRequestRejected=function(e){this.isStarted&&(this.backoffController.countError(),e instanceof Error?ce.error("Error fetching datafile: %s",e.message,e):typeof e=="string"?ce.error("Error fetching datafile: %s",e):ce.error("Error fetching datafile"))},t.prototype.onRequestResolved=function(e){var r;if(this.isStarted){typeof e.statusCode<"u"&&Qr(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers);var i=this.getNextDatafileFromResponse(e);if(i!=="")if(ce.info("Updating datafile from response"),this.currentDatafile=i,this.cache.set(this.cacheKey,i),!this.isReadyPromiseSettled)this.resolveReadyPromise();else{var n={datafile:i};(r=nn.getNotificationCenter(this.sdkKey,ce))===null||r===void 0||r.sendNotifications(se.OPTIMIZELY_CONFIG_UPDATE),this.emitter.emit(au,n)}}},t.prototype.onRequestComplete=function(){this.isStarted&&(this.currentRequest=null,!this.isReadyPromiseSettled&&!this.autoUpdate&&this.rejectReadyPromise(new Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},t.prototype.syncDatafile=function(){var e=this,r={};this.lastResponseLastModified&&(r["if-modified-since"]=this.lastResponseLastModified),ce.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(r)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,r);var i=function(){e.onRequestComplete()},n=function(o){e.onRequestResolved(o)},a=function(o){e.onRequestRejected(o)};this.currentRequest.responsePromise.then(n,a).then(i,i),this.autoUpdate&&this.scheduleNextUpdate()},t.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},t.prototype.rejectReadyPromise=function(e){this.readyPromiseRejecter(e),this.isReadyPromiseSettled=!0},t.prototype.scheduleNextUpdate=function(){var e=this,r=this.backoffController.getDelay(),i=Math.max(r,this.updateInterval);ce.debug("Scheduling sync in %s ms",i),this.currentTimeout=setTimeout(function(){e.currentRequest?e.syncOnCurrentRequestComplete=!0:e.syncDatafile()},i)},t.prototype.getNextDatafileFromResponse=function(e){return ce.debug("Response status code: %s",e.statusCode),typeof e.statusCode>"u"||e.statusCode===304?"":Qr(e.statusCode)?e.body:(ce.error("Datafile fetch request failed with status: ".concat(e.statusCode)),"")},t.prototype.trySavingLastModified=function(e){var r=e["last-modified"]||e["Last-Modified"];typeof r<"u"&&(this.lastResponseLastModified=r,ce.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},t.prototype.setDatafileFromCacheIfAvailable=function(){var e=this;this.cache.get(this.cacheKey).then(function(r){e.isStarted&&!e.isReadyPromiseSettled&&r&&(ce.debug("Using datafile from cache"),e.currentDatafile=r,e.resolveReadyPromise())})},t}(),uu=function(t){Xe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.makeGetRequest=function(r,i){return tu(r,i)},e.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},e}(su),lu=function(){function t(e,r,i,n){this.apiKey=e,this.apiHost=r,this.pixelUrl=i,this.segmentsToCheck=n}return t.prototype.equals=function(e){return this.apiHost===e.apiHost&&this.apiKey===e.apiKey&&this.pixelUrl===e.pixelUrl&&qi(this.segmentsToCheck,e.segmentsToCheck)},t}(),cu=function(t,e){return t.integrated!==e.integrated?!1:t.integrated&&e.integrated?t.odpConfig.equals(e.odpConfig):!0},an="Running",Zr="$opt_",Z="PROJECT_CONFIG";function fu(t){var e,r,i=Ie({},t);return i.audiences=(t.audiences||[]).map(function(n){return Ie({},n)}),i.experiments=(t.experiments||[]).map(function(n){return Ie({},n)}),i.featureFlags=(t.featureFlags||[]).map(function(n){return Ie({},n)}),i.groups=(t.groups||[]).map(function(n){var a=Ie({},n);return a.experiments=(n.experiments||[]).map(function(o){return Ie({},o)}),a}),i.rollouts=(t.rollouts||[]).map(function(n){var a=Ie({},n);return a.experiments=(n.experiments||[]).map(function(o){return Ie({},o)}),a}),i.environmentKey=(e=t.environmentKey)!==null&&e!==void 0?e:"",i.sdkKey=(r=t.sdkKey)!==null&&r!==void 0?r:"",i}var du=function(t,e){e===void 0&&(e=null);var r=fu(t);r.__datafileStr=e===null?JSON.stringify(t):e,(r.audiences||[]).forEach(function(d){d.conditions=JSON.parse(d.conditions)}),r.audiencesById=oe(r.audiences,"id"),Ie(r.audiencesById,oe(r.typedAudiences,"id")),r.attributeKeyMap=oe(r.attributes,"key"),r.eventKeyMap=oe(r.events,"key"),r.groupIdMap=oe(r.groups,"id");var i;Object.keys(r.groupIdMap||{}).forEach(function(d){i=r.groupIdMap[d].experiments,(i||[]).forEach(function(E){r.experiments.push(Ie(E,{groupId:d}))})}),r.rolloutIdMap=oe(r.rollouts||[],"id"),we(r.rolloutIdMap||{}).forEach(function(d){(d.experiments||[]).forEach(function(E){E.isRollout=!0,r.experiments.push(E),E.variationKeyMap=oe(E.variations,"key")})});var n=new Set;Object.keys(r.audiencesById).map(function(d){return gu(r.audiencesById[d])}).forEach(function(d){d.forEach(function(E){n.add(E)})});var a=Array.from(n),o=!1,s="",l="",f="";return r.integrations&&(r.integrationKeyMap=oe(r.integrations,"key"),r.integrations.forEach(function(d){if(!("key"in d))throw new Error(P(I.MISSING_INTEGRATION_KEY,Z));d.key==="odp"&&(o=!0,l=l||d.publicKey||"",s=s||d.host||"",f=f||d.pixelUrl||"")})),o?r.odpIntegrationConfig={integrated:!0,odpConfig:new lu(l,s,f,a)}:r.odpIntegrationConfig={integrated:!1},r.experimentKeyMap=oe(r.experiments,"key"),r.experimentIdMap=oe(r.experiments,"id"),r.variationIdMap={},r.variationVariableUsageMap={},(r.experiments||[]).forEach(function(d){d.variationKeyMap=oe(d.variations,"key"),Ie(r.variationIdMap,oe(d.variations,"id")),we(d.variationKeyMap||{}).forEach(function(E){E.variables&&(r.variationVariableUsageMap[E.id]=oe(E.variables,"id"))})}),r.experimentFeatureMap={},r.featureKeyMap=oe(r.featureFlags||[],"key"),we(r.featureKeyMap||{}).forEach(function(d){d.variables.forEach(function(E){E.type===pe.STRING&&E.subType===pe.JSON&&(E.type=pe.JSON,delete E.subType)}),d.variableKeyMap=oe(d.variables,"key"),(d.experimentIds||[]).forEach(function(E){r.experimentFeatureMap[E]?r.experimentFeatureMap[E].push(d.id):r.experimentFeatureMap[E]=[d.id]})}),r.flagRulesMap={},(r.featureFlags||[]).forEach(function(d){var E=[];d.experimentIds.forEach(function(c){var p=r.experimentIdMap[c];p&&E.push(p)});var u=r.rolloutIdMap[d.rolloutId];u&&E.push.apply(E,u.experiments),r.flagRulesMap[d.key]=E}),r.flagVariationsMap={},Gi(r.flagRulesMap||{}).forEach(function(d){var E=d[0],u=d[1],c=[];u.forEach(function(p){p.variations.forEach(function(g){mr(c,function(_){return _.id===g.id})||c.push(g)})}),r.flagVariationsMap[E]=c}),r},gu=function(t){return t.conditions?on(t.conditions):[]},on=function(t){var e=[];return pu(t)?[]:(Array.isArray(t)?t.forEach(function(r){return e.push.apply(e,on(r))}):t.match==="qualified"&&e.push(t.value),e)};function pu(t){return["and","or","not"].includes(t)}var sn=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(P(I.INVALID_EXPERIMENT_ID,Z,e));return r.layerId},un=function(t,e,r){var i=t.attributeKeyMap[e],n=e.indexOf(Zr)===0;return i?(n&&r.log(h.WARNING,"Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",e,Zr),i.id):n?e:(r.log(h.DEBUG,I.UNRECOGNIZED_ATTRIBUTE,Z,e),null)},ln=function(t,e){var r=t.eventKeyMap[e];return r?r.id:null},cn=function(t,e){var r=t.experimentKeyMap[e];if(!r)throw new Error(P(I.INVALID_EXPERIMENT_KEY,Z,e));return r.status},Eu=function(t,e){return cn(t,e)===an},hu=function(t,e){return cn(t,e)===an},vu=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(P(I.INVALID_EXPERIMENT_ID,Z,e));return r.audienceConditions||r.audienceIds},fn=function(t,e){return t.variationIdMap.hasOwnProperty(e)?t.variationIdMap[e].key:null},_u=function(t,e){return t.variationIdMap.hasOwnProperty(e)?t.variationIdMap[e]:null},mu=function(t,e,r){var i=t.experimentKeyMap[e];return i.variationKeyMap.hasOwnProperty(r)?i.variationKeyMap[r].id:null},nr=function(t,e){if(t.experimentKeyMap.hasOwnProperty(e)){var r=t.experimentKeyMap[e];if(r)return r}throw new Error(P(I.EXPERIMENT_KEY_NOT_IN_DATAFILE,Z,e))},Iu=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(P(I.INVALID_EXPERIMENT_ID,Z,e));return r.trafficAllocation},yu=function(t,e,r){if(t.experimentIdMap.hasOwnProperty(e)){var i=t.experimentIdMap[e];if(i)return i}return r.log(h.ERROR,I.INVALID_EXPERIMENT_ID,Z,e),null},ei=function(t,e,r){if(!t)return null;var i=t.flagVariationsMap[e],n=mr(i,function(a){return a.key===r});return n||null},Kt=function(t,e,r){if(t.featureKeyMap.hasOwnProperty(e)){var i=t.featureKeyMap[e];if(i)return i}return r.log(h.ERROR,I.FEATURE_NOT_IN_DATAFILE,Z,e),null},Ru=function(t,e,r,i){var n=t.featureKeyMap[e];if(!n)return i.log(h.ERROR,I.FEATURE_NOT_IN_DATAFILE,Z,e),null;var a=n.variableKeyMap[r];return a||(i.log(h.ERROR,I.VARIABLE_KEY_NOT_IN_DATAFILE,Z,r,e),null)},Ou=function(t,e,r,i){if(!e||!r)return null;if(!t.variationVariableUsageMap.hasOwnProperty(r.id))return i.log(h.ERROR,I.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,Z,r.id),null;var n=t.variationVariableUsageMap[r.id],a=n[e.id];return a?a.value:null},Nu=function(t,e,r){var i;switch(e){case pe.BOOLEAN:t!=="true"&&t!=="false"?(r.log(h.ERROR,I.UNABLE_TO_CAST_VALUE,Z,t,e),i=null):i=t==="true";break;case pe.INTEGER:i=parseInt(t,10),isNaN(i)&&(r.log(h.ERROR,I.UNABLE_TO_CAST_VALUE,Z,t,e),i=null);break;case pe.DOUBLE:i=parseFloat(t),isNaN(i)&&(r.log(h.ERROR,I.UNABLE_TO_CAST_VALUE,Z,t,e),i=null);break;case pe.JSON:try{i=JSON.parse(t)}catch{r.log(h.ERROR,I.UNABLE_TO_CAST_VALUE,Z,t,e),i=null}break;default:i=t;break}return i},Tu=function(t){return t.audiencesById},Au=function(t,e){return t.eventKeyMap.hasOwnProperty(e)},bu=function(t,e){return t.experimentFeatureMap.hasOwnProperty(e)},dn=function(t){return t.__datafileStr},gn=function(t){var e;try{e=Ji.validateDatafile(t.datafile)}catch(n){return{configObj:null,error:n}}if(t.jsonSchemaValidator)try{t.jsonSchemaValidator.validate(e),t.logger.log(h.INFO,v.VALID_DATAFILE,Z)}catch(n){return{configObj:null,error:n}}else t.logger.log(h.INFO,v.SKIPPING_JSON_VALIDATION,Z);var r=[e];typeof t.datafile=="string"&&r.push(t.datafile);var i=du.apply(void 0,r);return{configObj:i,error:null}},ti=function(t){return!!t.sendFlagDecisions};function Su(t,e,r,i){var n={sdkKey:t};if((i===void 0||typeof i=="object"&&i!==null)&&H.assign(n,i),r){var a=gn({datafile:r,jsonSchemaValidator:void 0,logger:e}),o=a.configObj,s=a.error;s&&e.error(s),o&&(n.datafile=dn(o))}return new uu(n)}var ri=function(){function t(e,r){r===void 0&&(r=ji),this.logger=e,this.timeout=r}return t.prototype.makeRequest=function(e,r,i,n){var a=this,o=new XMLHttpRequest,s=new Promise(function(l,f){o.open(i,e,!0),a.setHeadersInXhr(r,o),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){var d=o.status;if(d===0){f(new Error("Request error"));return}var E=a.parseHeadersFromXhr(o),u={statusCode:o.status,body:o.responseText,headers:E};l(u)}},o.timeout=a.timeout,o.ontimeout=function(){a.logger.log(O.WARNING,"Request timed out")},o.send(n)});return{responsePromise:s,abort:function(){o.abort()}}},t.prototype.setHeadersInXhr=function(e,r){Object.keys(e).forEach(function(i){var n=e[i];typeof n=="string"&&r.setRequestHeader(i,n)})},t.prototype.parseHeadersFromXhr=function(e){var r=this,i=e.getAllResponseHeaders();if(i===null)return{};var n=i.split(`\r
`),a={};return n.forEach(function(o){try{var s=o.indexOf(": ");if(s>-1){var l=o.slice(0,s),f=o.slice(s+2);l&&f&&(a[l]=f)}}catch{r.logger.log(O.WARNING,"Unable to parse & skipped header item '".concat(o,"'"))}}),a},t}(),vt=function(t){var e=t.browserCallback,r=t.nonBrowserCallback;return typeof window<"u"?e(window==null?void 0:window.localStorage):r()},Du=function(){function t(){this.logger=Q()}return t.prototype.contains=function(e){return W(this,void 0,void 0,function(){var r=this;return J(this,function(i){return[2,vt({browserCallback:function(n){return(n==null?void 0:n.getItem(e))!==null},nonBrowserCallback:function(){return r.logger.error(I.LOCAL_STORAGE_DOES_NOT_EXIST),!1}})]})})},t.prototype.get=function(e){return W(this,void 0,void 0,function(){var r=this;return J(this,function(i){return[2,vt({browserCallback:function(n){return(n==null?void 0:n.getItem(e))||void 0},nonBrowserCallback:function(){r.logger.error(I.LOCAL_STORAGE_DOES_NOT_EXIST)}})]})})},t.prototype.remove=function(e){return W(this,void 0,void 0,function(){var r=this;return J(this,function(i){switch(i.label){case 0:return[4,this.contains(e)];case 1:return i.sent()?(vt({browserCallback:function(n){n==null||n.removeItem(e)},nonBrowserCallback:function(){r.logger.error(I.LOCAL_STORAGE_DOES_NOT_EXIST)}}),[2,!0]):[2,!1]}})})},t.prototype.set=function(e,r){return W(this,void 0,void 0,function(){var i=this;return J(this,function(n){return[2,vt({browserCallback:function(a){a==null||a.setItem(e,r)},nonBrowserCallback:function(){i.logger.error(I.LOCAL_STORAGE_DOES_NOT_EXIST)}})]})})},t}(),wu=function(){function t(e){e===void 0&&(e=null),this._value=e,this._time=Date.now()}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!1,configurable:!0}),t.prototype.is_stale=function(e){return e<=0?!1:Date.now()-this._time>=e},t}(),pn=function(){function t(e){var r=e.maxSize,i=e.timeout;this._map=new Map;var n=Q();n.debug("Provisioning cache with maxSize of ".concat(r)),n.debug("Provisioning cache with timeout of ".concat(i)),this._maxSize=r,this._timeout=i}return Object.defineProperty(t.prototype,"map",{get:function(){return this._map},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timeout",{get:function(){return this._timeout},enumerable:!1,configurable:!0}),t.prototype.lookup=function(e){if(this._maxSize<=0)return null;var r=this._map.get(e);return r?r.is_stale(this._timeout)?(this._map.delete(e),null):(this._map.delete(e),this._map.set(e,r),r.value):null},t.prototype.save=function(e){var r=e.key,i=e.value;if(!(this._maxSize<=0)){var n=this._map.get(r);if(n&&this._map.delete(r),this._map.set(r,new wu(i)),this._map.size>this._maxSize){var a=this._map.keys().next().value;this._map.delete(a)}}},t.prototype.reset=function(){this._maxSize<=0||this._map.clear()},t.prototype.peek=function(e){var r;if(this._maxSize<=0)return null;var i=this._map.get(e);return(r=i==null?void 0:i.value)!==null&&r!==void 0?r:null},t}(),ii={DEFAULT_CAPACITY:100,DEFAULT_TIMEOUT_SECS:600},Lu=function(t){Xe(e,t);function e(r){var i,n;return t.call(this,{maxSize:(i=r==null?void 0:r.maxSize)!==null&&i!==void 0?i:ii.DEFAULT_CAPACITY,timeout:(n=r==null?void 0:r.timeout)!==null&&n!==void 0?n:ii.DEFAULT_TIMEOUT_SECS*1e3})||this}return e}(pn),ni={DEFAULT_CAPACITY:1e4,DEFAULT_TIMEOUT_SECS:600};(function(t){Xe(e,t);function e(r){var i,n;return t.call(this,{maxSize:(i=r==null?void 0:r.maxSize)!==null&&i!==void 0?i:ni.DEFAULT_CAPACITY,timeout:(n=r==null?void 0:r.timeout)!==null&&n!==void 0?n:ni.DEFAULT_TIMEOUT_SECS*1e3})||this}return e})(pn);var ut=function(){function t(){this._keyForVuid="optimizely-vuid",this._vuid=""}return Object.defineProperty(t.prototype,"vuid",{get:function(){return this._vuid},enumerable:!1,configurable:!0}),t.instance=function(e){return W(this,void 0,void 0,function(){return J(this,function(r){switch(r.label){case 0:return this._instance||(this._instance=new t),this._instance._vuid?[3,2]:[4,this._instance.load(e)];case 1:r.sent(),r.label=2;case 2:return[2,this._instance]}})})},t.prototype.load=function(e){return W(this,void 0,void 0,function(){var r;return J(this,function(i){switch(i.label){case 0:return[4,e.get(this._keyForVuid)];case 1:return r=i.sent(),r&&t.isVuid(r)?(this._vuid=r,[3,4]):[3,2];case 2:return this._vuid=this.makeVuid(),[4,this.save(this._vuid,e)];case 3:i.sent(),i.label=4;case 4:return[2,this._vuid]}})})},t.prototype.makeVuid=function(){var e=32,r=Ct(),i=r.replace(/-/g,"").toLowerCase(),n="".concat(t.vuid_prefix).concat(i);return n.length<=e?n:n.substring(0,e)},t.prototype.save=function(e,r){return W(this,void 0,void 0,function(){return J(this,function(i){switch(i.label){case 0:return[4,r.set(this._keyForVuid,e)];case 1:return i.sent(),[2]}})})},t._reset=function(){this._instance._vuid=""},t.vuid_prefix="vuid_",t.isVuid=function(e){return(e==null?void 0:e.startsWith(t.vuid_prefix))||!1},t}();function En(t){var e=["string","number","boolean"],r=!1;return t.forEach(function(i){!e.includes(typeof i)&&i!==null&&(r=!0)}),r}var wt=function(){function t(e,r,i,n){this.type=e,this.action=r,this.identifiers=i??new Map,this.data=n??new Map}return t}(),ai=function(){};function Cu(){var t=ai,e=ai,r=new Promise(function(i,n){t=i,e=n});return{promise:r,resolve:t,reject:e,then:r.then.bind(r)}}var Pe;(function(t){t[t.Running=0]="Running",t[t.Stopped=1]="Stopped"})(Pe||(Pe={}));var Uu=function(){function t(e){var r=e.odpIntegrationConfig,i=e.segmentManager,n=e.eventManager,a=e.logger,o=this;this.ready=!1,this.status=Pe.Stopped,this.segmentManager=i,this.eventManager=n,this.logger=a,this.configPromise=Cu();var s=[this.configPromise];this.isVuidEnabled()&&s.push(this.initializeVuid()),this.initPromise=Promise.all(s),this.onReady().then(function(){o.ready=!0,o.isVuidEnabled()&&o.status===Pe.Running&&o.registerVuid()}),r&&this.updateSettings(r)}return t.prototype.getStatus=function(){return this.status},t.prototype.start=function(){return W(this,void 0,void 0,function(){return J(this,function(e){return this.status===Pe.Running?[2]:this.odpIntegrationConfig?this.odpIntegrationConfig.integrated?(this.status=Pe.Running,this.segmentManager.updateSettings(this.odpIntegrationConfig.odpConfig),this.eventManager.updateSettings(this.odpIntegrationConfig.odpConfig),this.eventManager.start(),[2,Promise.resolve()]):[2,Promise.reject(new Error("start() called when ODP is not integrated"))]:[2,Promise.reject(new Error("cannot start without ODP config"))]})})},t.prototype.stop=function(){return W(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return this.status===Pe.Stopped?[2]:(this.status=Pe.Stopped,[4,this.eventManager.stop()]);case 1:return e.sent(),[2]}})})},t.prototype.onReady=function(){return this.initPromise},t.prototype.isReady=function(){return this.ready},t.prototype.updateSettings=function(e){return this.configPromise.resolve(),this.odpIntegrationConfig&&cu(this.odpIntegrationConfig,e)?!1:(this.odpIntegrationConfig=e,e.integrated?this.status===Pe.Running?(this.segmentManager.updateSettings(e.odpConfig),this.eventManager.updateSettings(e.odpConfig)):this.start():this.stop(),!0)},t.prototype.fetchQualifiedSegments=function(e,r){return r===void 0&&(r=[]),W(this,void 0,void 0,function(){return J(this,function(i){return this.odpIntegrationConfig?this.odpIntegrationConfig.integrated?ut.isVuid(e)?[2,this.segmentManager.fetchQualifiedSegments(ye.VUID,e,r)]:[2,this.segmentManager.fetchQualifiedSegments(ye.FS_USER_ID,e,r)]:(this.logger.log(O.ERROR,I.ODP_NOT_INTEGRATED),[2,null]):(this.logger.log(O.ERROR,I.ODP_CONFIG_NOT_AVAILABLE),[2,null])})})},t.prototype.identifyUser=function(e,r){if(!this.odpIntegrationConfig){this.logger.log(O.ERROR,I.ODP_CONFIG_NOT_AVAILABLE);return}if(!this.odpIntegrationConfig.integrated){this.logger.log(O.INFO,I.ODP_NOT_INTEGRATED);return}if(e&&ut.isVuid(e)){this.eventManager.identifyUser(void 0,e);return}this.eventManager.identifyUser(e,r)},t.prototype.sendEvent=function(e){var r=e.type,i=e.action,n=e.identifiers,a=e.data,o=r;if((typeof o!="string"||o==="")&&(o="fullstack"),!this.odpIntegrationConfig){this.logger.log(O.ERROR,I.ODP_CONFIG_NOT_AVAILABLE);return}if(!this.odpIntegrationConfig.integrated){this.logger.log(O.ERROR,I.ODP_NOT_INTEGRATED);return}if(En(a))throw new Error(I.ODP_INVALID_DATA);if(typeof i!="string"||i==="")throw new Error("ODP action is not valid (cannot be empty).");this.eventManager.sendEvent(new wt(o,i,n,a))},t.prototype.initializeVuid=function(){return Promise.resolve()},t.prototype.registerVuid=function(){if(!this.odpIntegrationConfig){this.logger.log(O.ERROR,I.ODP_CONFIG_NOT_AVAILABLE);return}if(!this.odpIntegrationConfig.integrated){this.logger.log(O.INFO,I.ODP_NOT_INTEGRATED);return}var e=this.getVuid();if(e)try{this.eventManager.registerVuid(e)}catch{this.logger.log(O.ERROR,I.ODP_VUID_REGISTRATION_FAILED)}},t}(),Yt="ODP event send failed",Mu=function(){function t(e,r){this.requestHandler=e,this.logger=r}return t.prototype.getLogger=function(){return this.logger},t.prototype.sendEvents=function(e,r){var i;return W(this,void 0,void 0,function(){var n,a,o,s,l,f,d,E,u,c,p;return J(this,function(g){switch(g.label){case 0:if(n=!1,r.length===0)return this.logger.log(O.ERROR,"".concat(Yt," (no events)")),[2,n];if(!this.shouldSendEvents(r))return[2,n];a=this.generateRequestData(e,r),o=a.method,s=a.endpoint,l=a.headers,f=a.data,d=0,g.label=1;case 1:return g.trys.push([1,3,,4]),E=this.requestHandler.makeRequest(s,l,o,f),[4,E.responsePromise];case 2:return u=g.sent(),d=(i=u.statusCode)!==null&&i!==void 0?i:d,[3,4];case 3:return c=g.sent(),p="network error",c instanceof Error&&(p=c.message),this.logger.log(O.ERROR,"".concat(Yt," (").concat(p,")")),n=!0,[3,4];case 4:return d>=400&&this.logger.log(O.ERROR,"".concat(Yt," (").concat(d,")")),d>=500&&(n=!0),[2,n]}})})},t}(),Vu="ODP event send failed",Pu="v2/zaius.gif",Fu=function(t){Xe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.shouldSendEvents=function(r){return r.length<=1?!0:(this.getLogger().log(O.ERROR,"".concat(Vu," (browser only supports batch size 1)")),!1)},e.prototype.getPixelApiEndpoint=function(r){var i=r.pixelUrl,n=new URL(Pu,i).href;return n},e.prototype.generateRequestData=function(r,i){var n=this.getPixelApiEndpoint(r),a=r.apiKey,o="GET",s=i[0],l=new URL(n);s.identifiers.forEach(function(d,E){l.searchParams.append(E,d)}),s.data.forEach(function(d,E){l.searchParams.append(E,d)}),l.searchParams.append("tracker_id",a),l.searchParams.append("event_type",s.type),l.searchParams.append("vdl_action",s.action);var f=l.toString();return{method:o,endpoint:f,headers:{},data:""}},e}(Mu),hn=function(t){typeof queueMicrotask=="function"?queueMicrotask(t):setTimeout(t)},xu=3,ke;(function(t){t[t.Stopped=0]="Stopped",t[t.Running=1]="Running"})(ke||(ke={}));var ku=function(){function t(e){var r=e.odpConfig,i=e.apiManager,n=e.logger,a=e.clientEngine,o=e.clientVersion,s=e.queueSize,l=e.batchSize,f=e.flushInterval,d=e.userAgentParser,E=e.retries;if(this.status=ke.Stopped,this.queue=new Array,this.apiManager=i,this.logger=n,this.clientEngine=a,this.clientVersion=o,this.initParams(l,s,f),this.status=ke.Stopped,this.userAgentParser=d,this.retries=E||xu,d){var u=d.parseUserAgentInfo(),c=u.os,p=u.device,g={os:c.name,os_version:c.version,device_type:p.type,model:p.model};this.userAgentData=new Map(Object.entries(g).filter(function(_){_[0];var N=_[1];return N!=null&&N!=null}))}r&&this.updateSettings(r)}return t.prototype.updateSettings=function(e){this.odpConfig&&this.odpConfig.equals(e)||(this.flush(),this.odpConfig=e)},t.prototype.flush=function(){this.processQueue(!0)},t.prototype.start=function(){if(!this.odpConfig){this.logger.log(O.ERROR,I.ODP_CONFIG_NOT_AVAILABLE);return}this.status=ke.Running,this.batchSize>1&&this.setNewTimeout()},t.prototype.stop=function(){return W(this,void 0,void 0,function(){return J(this,function(e){return this.logger.log(O.DEBUG,"Stop requested."),this.flush(),this.clearCurrentTimeout(),this.status=ke.Stopped,this.logger.log(O.DEBUG,"Stopped. Queue Count: %s",this.queue.length),[2]})})},t.prototype.registerVuid=function(e){var r=new Map;r.set(ye.VUID,e);var i=new wt(St,lt.INITIALIZED,r);this.sendEvent(i)},t.prototype.identifyUser=function(e,r){var i=new Map;if(!e&&!r){this.logger.log(O.ERROR,I.ODP_SEND_EVENT_FAILED_UID_MISSING);return}r&&i.set(ye.VUID,r),e&&i.set(ye.FS_USER_ID,e);var n=new wt(St,lt.IDENTIFIED,i);this.sendEvent(n)},t.prototype.sendEvent=function(e){En(e.data)?this.logger.log(O.ERROR,"Event data found to be invalid."):(e.data=this.augmentCommonData(e.data),this.enqueue(e))},t.prototype.enqueue=function(e){if(this.status===ke.Stopped){this.logger.log(O.WARNING,"Failed to Process ODP Event. ODPEventManager is not running.");return}if(!this.hasNecessaryIdentifiers(e)){this.logger.log(O.ERROR,"ODP events should have at least one key-value pair in identifiers.");return}if(this.queue.length>=this.queueSize){this.logger.log(O.WARNING,"Failed to Process ODP Event. Event Queue full. queueSize = %s.",this.queue.length);return}this.queue.push(e),this.processQueue()},t.prototype.processQueue=function(e){if(e===void 0&&(e=!1),this.status===ke.Running){if(e)for(this.clearCurrentTimeout();this.queueContainsItems();)this.makeAndSend1Batch();else if(this.queueHasBatches())for(this.clearCurrentTimeout();this.queueHasBatches();)this.makeAndSend1Batch();this.batchSize>1&&this.setNewTimeout()}},t.prototype.clearCurrentTimeout=function(){clearTimeout(this.timeoutId),this.timeoutId=void 0},t.prototype.setNewTimeout=function(){var e=this;this.timeoutId===void 0&&(this.timeoutId=setTimeout(function(){return e.processQueue(!0)},this.flushInterval))},t.prototype.makeAndSend1Batch=function(){var e=this;if(this.odpConfig){var r=this.queue.splice(0,this.batchSize),i=this.odpConfig;r.length>0&&hn(function(){return W(e,void 0,void 0,function(){var n,a;return J(this,function(o){switch(o.label){case 0:a=0,o.label=1;case 1:return[4,this.apiManager.sendEvents(i,r)];case 2:n=o.sent(),a+=1,o.label=3;case 3:if(n&&a<this.retries)return[3,1];o.label=4;case 4:return[2]}})})})}},t.prototype.queueHasBatches=function(){return this.queueContainsItems()&&this.queue.length%this.batchSize===0},t.prototype.queueContainsItems=function(){return this.queue.length>0},t.prototype.augmentCommonData=function(e){var r=new Map(this.userAgentData);return r.set("idempotence_id",Ct()),r.set("data_source_type","sdk"),r.set("data_source",this.clientEngine),r.set("data_source_version",this.clientVersion),e.forEach(function(i,n){return r.set(n,i)}),r},t.prototype.getLogger=function(){return this.logger},t.prototype.getQueue=function(){return this.queue},t}(),Gu=100,Bu=function(t){Xe(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.hasNecessaryIdentifiers=function(i){return i.identifiers.size>=0},r}return e.prototype.initParams=function(r,i,n){this.queueSize=i||Gu,this.batchSize=1,this.flushInterval=0,typeof r<"u"&&r!==1&&this.getLogger().log(O.WARNING,"ODP event batch size must be 1 in the browser."),typeof n<"u"&&n!==0&&this.getLogger().log(O.WARNING,"ODP event flush interval must be 0 in the browser.")},e.prototype.discardEventsIfNeeded=function(){this.getLogger().log(O.DEBUG,"ODPConfig not ready. Leaving events in queue.")},e}(ku),qu=function(){function t(e,r,i,n){this.odpConfig=n,this._segmentsCache=e,this.odpSegmentApiManager=r,this.logger=i||Q("OdpSegmentManager")}return Object.defineProperty(t.prototype,"segmentsCache",{get:function(){return this._segmentsCache},enumerable:!1,configurable:!0}),t.prototype.fetchQualifiedSegments=function(e,r,i){return W(this,void 0,void 0,function(){var n,a,o,s,l,f;return J(this,function(d){switch(d.label){case 0:if(!this.odpConfig)return this.logger.log(O.WARNING,I.ODP_CONFIG_NOT_AVAILABLE),[2,null];if(n=this.odpConfig.segmentsToCheck,!n||n.length<=0)return this.logger.log(O.DEBUG,"No segments are used in the project. Returning an empty list."),[2,[]];if(a=this.makeCacheKey(e,r),o=i.includes(Dt.IGNORE_CACHE),s=i.includes(Dt.RESET_CACHE),s&&this.reset(),!o&&!s){if(l=this._segmentsCache.lookup(a),l)return this.logger.log(O.DEBUG,'ODP cache hit. Returning segments from cache "%s".',a),[2,l];this.logger.log(O.DEBUG,"ODP cache miss.")}return this.logger.log(O.DEBUG,"Making a call to ODP server."),[4,this.odpSegmentApiManager.fetchSegments(this.odpConfig.apiKey,this.odpConfig.apiHost,e,r,n)];case 1:return f=d.sent(),f&&!o&&this._segmentsCache.save({key:a,value:f}),[2,f]}})})},t.prototype.reset=function(){this._segmentsCache.reset()},t.prototype.makeCacheKey=function(e,r){return"".concat(e,"-$-").concat(r)},t.prototype.updateSettings=function(e){this.odpConfig=e,this.reset()},t}(),Hu={$schema:"http://json-schema.org/draft-04/schema#",title:"Project Config JSON Schema",type:"object",properties:{projectId:{type:"string",required:!0},accountId:{type:"string",required:!0},groups:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},policy:{type:"string",required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},experiments:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0},status:{type:"string",required:!0},layerId:{type:"string",required:!0},variations:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},audienceIds:{type:"array",items:{type:"string"},required:!0},forcedVariations:{type:"object",required:!0}}},required:!0}}},required:!0},experiments:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0},status:{type:"string",required:!0},layerId:{type:"string",required:!0},variations:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},audienceIds:{type:"array",items:{type:"string"},required:!0},forcedVariations:{type:"object",required:!0}}},required:!0},events:{type:"array",items:{type:"object",properties:{key:{type:"string",required:!0},experimentIds:{type:"array",items:{type:"string",required:!0}},id:{type:"string",required:!0}}},required:!0},audiences:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},name:{type:"string",required:!0},conditions:{type:"string",required:!0}}},required:!0},attributes:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},version:{type:"string",required:!0},revision:{type:"string",required:!0},integrations:{type:"array",items:{type:"object",properties:{key:{type:"string",required:!0},host:{type:"string"},publicKey:{type:"string"},pixelUrl:{type:"string"}}}}}},zu=Hu,ju="JSON_SCHEMA_VALIDATOR";function Ku(t,e,r){e===void 0&&(e=zu);var i="".concat(ju," (").concat(e.title,")");if(typeof t!="object"||t===null)throw new Error(P(I.NO_JSON_PROVIDED,i));var n=Go.validate(t,e);return!!n.valid}var Yu={$schema:"https://json-schema.org/draft/2019-09/schema",$id:"https://example.com/example.json",title:"ODP Response Schema",type:"object",required:["data"],properties:{data:{title:"The data Schema",type:"object",required:["customer"],properties:{customer:{title:"The customer Schema",type:"object",required:[],properties:{audiences:{title:"The audiences Schema",type:"object",required:["edges"],properties:{edges:{title:"The edges Schema",type:"array",items:{title:"A Schema",type:"object",required:["node"],properties:{node:{title:"The node Schema",type:"object",required:["name","state"],properties:{name:{title:"The name Schema",type:"string",examples:["has_email","has_email_opted_in"]},state:{title:"The state Schema",type:"string",examples:["qualified"]}},examples:[]}},examples:[]},examples:[]}},examples:[]}},examples:[]}},examples:[]},errors:{title:"The errors Schema",type:"array",default:[],items:{title:"A Schema",type:"object",required:["message","locations","extensions"],properties:{message:{title:"The message Schema",type:"string",examples:["Exception while fetching data (/customer) : java.lang.RuntimeException: could not resolve _fs_user_id = asdsdaddddd"]},locations:{title:"The locations Schema",type:"array",items:{title:"A Schema",type:"object",required:["line","column"],properties:{line:{title:"The line Schema",type:"integer",examples:[2]},column:{title:"The column Schema",type:"integer",examples:[3]}},examples:[]},examples:[]},path:{title:"The path Schema",type:"array",items:{title:"A Schema",type:"string",examples:["customer"]},examples:[]},extensions:{title:"The extensions Schema",type:"object",required:["classification"],properties:{classification:{title:"The classification Schema",type:"string",examples:["InvalidIdentifierException"]}},examples:[]}},examples:[]},examples:[]}},examples:[]},Xu="qualified",$u=[],oi=null,Je="Audience segments fetch failed",Wu=function(){function t(e,r){this.toGraphQLJson=function(i,n,a){return et(et(['{"query" : "query {customer',"(".concat(i,' : \\"').concat(n,'\\") '),"{audiences","(subset: ["],(a==null?void 0:a.map(function(o,s){return'\\"'.concat(o,'\\"').concat(s<a.length-1?",":"")}))||"",!0),[']) {edges {node {name state}}}}}"}'],!1).join("")},this.requestHandler=e,this.logger=r}return t.prototype.fetchSegments=function(e,r,i,n,a){var o,s,l,f;return W(this,void 0,void 0,function(){var d,E,u,c,p,g,_,N;return J(this,function(k){switch(k.label){case 0:return!e||!r?(this.logger.log(O.ERROR,"".concat(Je," (Parameters apiKey or apiHost invalid)")),[2,null]):(a==null?void 0:a.length)===0?[2,$u]:(d="".concat(r,"/v3/graphql"),E=this.toGraphQLJson(i,n,a),[4,this.querySegments(e,d,i,n,E)]);case 1:return u=k.sent(),u?(c=this.parseSegmentsResponseJson(u),c?((o=c.errors)===null||o===void 0?void 0:o.length)>0?(p=c.errors[0].extensions,g=p.code,_=p.classification,g=="INVALID_IDENTIFIER_EXCEPTION"?this.logger.log(O.ERROR,"".concat(Je," (invalid identifier)")):this.logger.log(O.ERROR,"".concat(Je," (").concat(_,")")),[2,null]):(N=(f=(l=(s=c==null?void 0:c.data)===null||s===void 0?void 0:s.customer)===null||l===void 0?void 0:l.audiences)===null||f===void 0?void 0:f.edges,N?[2,N.filter(function(R){return R.node.state==Xu}).map(function(R){return R.node.name})]:(this.logger.log(O.ERROR,"".concat(Je," (decode error)")),[2,null])):(this.logger.log(O.ERROR,"".concat(Je," (decode error)")),[2,null])):(this.logger.log(O.ERROR,"".concat(Je," (network error)")),[2,null])}})})},t.prototype.querySegments=function(e,r,i,n,a){return W(this,void 0,void 0,function(){var o,s,l,f,d;return J(this,function(E){switch(E.label){case 0:o="POST",s=r,l={"Content-Type":"application/json","x-api-key":e},E.label=1;case 1:return E.trys.push([1,3,,4]),d=this.requestHandler.makeRequest(s,l,o,a),[4,d.responsePromise];case 2:return f=E.sent(),[3,4];case 3:return E.sent(),[2,null];case 4:return[2,f.body]}})})},t.prototype.parseSegmentsResponseJson=function(e){var r={};try{r=JSON.parse(e)}catch{return oi}return Ku(r,Yu)?r:oi},t}(),Ju=function(t){Xe(e,t);function e(r){return t.call(this,r)||this}return e.createInstance=function(r){var i=r.logger,n=r.odpOptions,a=r.odpIntegrationConfig,o=r.clientEngine,s=r.clientVersion;i=i||Q(),o=o||yr,s=s||Rr;var l=void 0;a!=null&&a.integrated&&(l=a.odpConfig);var f;n!=null&&n.segmentsRequestHandler?f=n.segmentsRequestHandler:f=new ri(i,(n==null?void 0:n.segmentsApiTimeout)||Ki);var d;n!=null&&n.segmentManager?d=n.segmentManager:d=new qu((n==null?void 0:n.segmentsCache)||new Lu({maxSize:n==null?void 0:n.segmentsCacheSize,timeout:n==null?void 0:n.segmentsCacheTimeout}),new Wu(f,i),i,l);var E;n!=null&&n.eventRequestHandler?E=n.eventRequestHandler:E=new ri(i,(n==null?void 0:n.eventApiTimeout)||Yi);var u;return n!=null&&n.eventManager?u=n.eventManager:u=new Bu({odpConfig:l,apiManager:new Fu(E,i),logger:i,clientEngine:o,clientVersion:s,flushInterval:n==null?void 0:n.eventFlushInterval,batchSize:n==null?void 0:n.eventBatchSize,queueSize:n==null?void 0:n.eventQueueSize,userAgentParser:n==null?void 0:n.userAgentParser}),new e({odpIntegrationConfig:a,segmentManager:d,eventManager:u,logger:i})},e.prototype.initializeVuid=function(){return W(this,void 0,void 0,function(){var r;return J(this,function(i){switch(i.label){case 0:return[4,ut.instance(e.cache)];case 1:return r=i.sent(),this.vuid=r.vuid,[2]}})})},e.prototype.identifyUser=function(r,i){if(r&&ut.isVuid(r)){t.prototype.identifyUser.call(this,void 0,r);return}if(r&&i&&ut.isVuid(i)){t.prototype.identifyUser.call(this,r,i);return}t.prototype.identifyUser.call(this,r,i||this.vuid)},e.prototype.sendEvent=function(r){var i=r.type,n=r.action,a=r.identifiers,o=r.data,s=new Map(a);if(!a.has(ye.VUID))if(this.vuid)s.set(ye.VUID,this.vuid);else throw new Error(I.ODP_SEND_EVENT_FAILED_VUID_MISSING);t.prototype.sendEvent.call(this,{type:i,action:n,identifiers:s,data:o})},e.prototype.isVuidEnabled=function(){return!0},e.prototype.getVuid=function(){return this.vuid},e.cache=new Du,e}(Uu);function si(t,e,r){return{variationKey:null,enabled:!1,variables:{},ruleKey:null,flagKey:t,userContext:e,reasons:r}}var ui=function(){function t(e){var r=e.optimizely,i=e.userId,n=e.attributes,a=e.shouldIdentifyUser,o=a===void 0?!0:a,s=this,l;this._qualifiedSegments=null,this.optimizely=r,this.userId=i,this.attributes=(l=Ee({},n))!==null&&l!==void 0?l:{},this.forcedDecisionsMap={},o&&r.readyPromise.then(function(f){var d=f.success;d&&r.isOdpIntegrated()&&s.identifyUser()})}return t.prototype.identifyUser=function(){this.optimizely.identifyUser(this.userId)},t.prototype.setAttribute=function(e,r){this.attributes[e]=r},t.prototype.getUserId=function(){return this.userId},t.prototype.getAttributes=function(){return Ee({},this.attributes)},t.prototype.getOptimizely=function(){return this.optimizely},Object.defineProperty(t.prototype,"qualifiedSegments",{get:function(){return this._qualifiedSegments},set:function(e){this._qualifiedSegments=e},enumerable:!1,configurable:!0}),t.prototype.decide=function(e,r){return r===void 0&&(r=[]),this.optimizely.decide(this.cloneUserContext(),e,r)},t.prototype.decideForKeys=function(e,r){return r===void 0&&(r=[]),this.optimizely.decideForKeys(this.cloneUserContext(),e,r)},t.prototype.decideAll=function(e){return e===void 0&&(e=[]),this.optimizely.decideAll(this.cloneUserContext(),e)},t.prototype.trackEvent=function(e,r){this.optimizely.track(e,this.userId,this.attributes,r)},t.prototype.setForcedDecision=function(e,r){var i,n=e.flagKey,a=(i=e.ruleKey)!==null&&i!==void 0?i:De.FORCED_DECISION_NULL_RULE_KEY,o=r.variationKey,s={variationKey:o};return this.forcedDecisionsMap[n]||(this.forcedDecisionsMap[n]={}),this.forcedDecisionsMap[n][a]=s,!0},t.prototype.getForcedDecision=function(e){return this.findForcedDecision(e)},t.prototype.removeForcedDecision=function(e){var r,i=(r=e.ruleKey)!==null&&r!==void 0?r:De.FORCED_DECISION_NULL_RULE_KEY,n=e.flagKey,a=!1;if(this.forcedDecisionsMap.hasOwnProperty(n)){var o=this.forcedDecisionsMap[n];o.hasOwnProperty(i)&&(delete this.forcedDecisionsMap[n][i],a=!0),Object.keys(this.forcedDecisionsMap[n]).length===0&&delete this.forcedDecisionsMap[n]}return a},t.prototype.removeAllForcedDecisions=function(){return this.forcedDecisionsMap={},!0},t.prototype.findForcedDecision=function(e){var r,i,n=(r=e.ruleKey)!==null&&r!==void 0?r:De.FORCED_DECISION_NULL_RULE_KEY,a=e.flagKey;if(this.forcedDecisionsMap.hasOwnProperty(e.flagKey)){var o=this.forcedDecisionsMap[a];if(o.hasOwnProperty(n))return i=o[n].variationKey,{variationKey:i}}return null},t.prototype.cloneUserContext=function(){var e=new t({shouldIdentifyUser:!1,optimizely:this.getOptimizely(),userId:this.getUserId(),attributes:this.getAttributes()});return Object.keys(this.forcedDecisionsMap).length>0&&(e.forcedDecisionsMap=Ee({},this.forcedDecisionsMap)),e._qualifiedSegments=this._qualifiedSegments,e},t.prototype.fetchQualifiedSegments=function(e){return W(this,void 0,void 0,function(){var r;return J(this,function(i){switch(i.label){case 0:return[4,this.optimizely.fetchQualifiedSegments(this.userId,e)];case 1:return r=i.sent(),this.qualifiedSegments=r,[2,r!==null]}})})},t.prototype.isQualifiedFor=function(e){return this._qualifiedSegments?this._qualifiedSegments.indexOf(e)>-1:!1},t}(),vn="and",_n="or",mn="not",In=[vn,_n,mn];function ct(t,e){if(Array.isArray(t)){var r=t[0],i=t.slice(1);switch(typeof r=="string"&&In.indexOf(r)===-1&&(r=_n,i=t),r){case vn:return Qu(i,e);case mn:return Zu(i,e);default:return el(i,e)}}var n=t;return e(n)}function Qu(t,e){var r=!1;if(Array.isArray(t)){for(var i=0;i<t.length;i++){var n=ct(t[i],e);if(n===!1)return!1;n===null&&(r=!0)}return r?null:!0}return null}function Zu(t,e){if(Array.isArray(t)&&t.length>0){var r=ct(t[0],e);return r===null?null:!r}return null}function el(t,e){var r=!1;if(Array.isArray(t)){for(var i=0;i<t.length;i++){var n=ct(t[i],e);if(n===!0)return!0;n===null&&(r=!0)}return r?null:!1}return null}var tl=function(){function t(e,r,i){var n,a;this.sdkKey=(n=e.sdkKey)!==null&&n!==void 0?n:"",this.environmentKey=(a=e.environmentKey)!==null&&a!==void 0?a:"",this.attributes=e.attributes,this.audiences=t.getAudiences(e),this.events=e.events,this.revision=e.revision;var o=(e.featureFlags||[]).reduce(function(E,u){return E[u.id]=u.variables,E},{}),s=t.getVariableIdMap(e),l=t.getExperimentsMap(e,o,s,i),f=l.experimentsMapById,d=l.experimentsMapByKey;this.experimentsMap=d,this.featuresMap=t.getFeaturesMap(e,o,f,s),this.datafile=r}return t.prototype.getDatafile=function(){return this.datafile},t.getAudiences=function(e){var r=[],i=[];return(e.typedAudiences||[]).forEach(function(n){r.push({id:n.id,conditions:JSON.stringify(n.conditions),name:n.name}),i.push(n.id)}),(e.audiences||[]).forEach(function(n){i.indexOf(n.id)===-1&&n.id!="$opt_dummy_audience"&&r.push({id:n.id,conditions:JSON.stringify(n.conditions),name:n.name})}),r},t.getSerializedAudiences=function(e,r){var i="";if(e){var n="";e.forEach(function(a){var o="";if(a instanceof Array)o=t.getSerializedAudiences(a,r),o="(".concat(o,")");else if(In.indexOf(a)>-1)n=a.toUpperCase();else{var s=r[a]?r[a].name:a;i||n==="NOT"?(n=n===""?"OR":n,i===""?i="".concat(n,' "').concat(r[a].name,'"'):i=i.concat(" ".concat(n,' "').concat(s,'"'))):i='"'.concat(s,'"')}o!==""&&(i!==""||n==="NOT"?(n=n===""?"OR":n,i===""?i="".concat(n," ").concat(o):i=i.concat(" ".concat(n," ").concat(o))):i=i.concat(o))})}return i},t.getExperimentAudiences=function(e,r){return e.audienceConditions?t.getSerializedAudiences(e.audienceConditions,r.audiencesById):""},t.mergeFeatureVariables=function(e,r,i,n,a){var o=(e[i]||[]).reduce(function(s,l){return s[l.key]={id:l.id,key:l.key,type:l.type,value:l.defaultValue},s},{});return(n||[]).forEach(function(s){var l=r[s.id],f={id:s.id,key:l.key,type:l.type,value:a?s.value:l.defaultValue};o[l.key]=f}),o},t.getVariationsMap=function(e,r,i,n){var a={};return a=e.reduce(function(o,s){var l=t.mergeFeatureVariables(r,i,n,s.variables,s.featureEnabled);return o[s.key]={id:s.id,key:s.key,featureEnabled:s.featureEnabled,variablesMap:l},o},{}),a},t.getVariableIdMap=function(e){var r={};return r=(e.featureFlags||[]).reduce(function(i,n){return n.variables.forEach(function(a){i[a.id]=a}),i},{}),r},t.getDeliveryRules=function(e,r,i,n,a){return n.map(function(o){return{id:o.id,key:o.key,audiences:t.getExperimentAudiences(o,e),variationsMap:t.getVariationsMap(o.variations,r,a,i)}})},t.getRolloutExperimentIds=function(e){var r=[];return(e||[]).forEach(function(i){i.experiments.forEach(function(n){r.push(n.id)})}),r},t.getExperimentsMap=function(e,r,i,n){var a=this.getRolloutExperimentIds(e.rollouts),o={},s={},l=e.experiments||[];return l.forEach(function(f){if(a.indexOf(f.id)===-1){var d=e.experimentFeatureMap[f.id],E="";d&&d.length>0&&(E=d[0]);var u=t.getVariationsMap(f.variations,r,i,E.toString()),c={id:f.id,key:f.key,audiences:t.getExperimentAudiences(f,e),variationsMap:u};o[f.id]=c,s[f.key]&&n&&n.warn("Duplicate experiment keys found in datafile: ".concat(f.key)),s[f.key]=c}}),{experimentsMapById:o,experimentsMapByKey:s}},t.getExperimentsKeyMap=function(e){var r={};for(var i in e){var n=e[i];r[n.key]=n}return r},t.getFeaturesMap=function(e,r,i,n){var a={};return e.featureFlags.forEach(function(o){var s={},l=[];o.experimentIds.forEach(function(u){var c=i[u];c&&(s[c.key]=c),l.push(i[u])});var f=(o.variables||[]).reduce(function(u,c){return u[c.key]={id:c.id,key:c.key,type:c.type,value:c.defaultValue},u},{}),d=[],E=e.rolloutIdMap[o.rolloutId];E&&(d=t.getDeliveryRules(e,r,o.id,E.experiments,n)),a[o.key]={id:o.id,key:o.key,experimentRules:l,deliveryRules:d,experimentsMap:s,variablesMap:f}}),a},t}();function rl(t,e,r){return new tl(t,e,r)}var nt=Q(),il="PROJECT_CONFIG_MANAGER";function Qe(t,e){return t instanceof Error?t.message:e||"Unknown error"}var nl=function(){function t(e){this.updateListeners=[],this.configObj=null,this.optimizelyConfigObj=null,this.datafileManager=null;try{if(this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){var r=new Error(P(I.DATAFILE_AND_SDK_KEY_MISSING,il));this.readyPromise=Promise.resolve({success:!1,reason:Qe(r)}),nt.error(r);return}var i=null;e.datafile&&(i=this.handleNewDatafile(e.datafile)),e.sdkKey&&e.datafileManager?(this.datafileManager=e.datafileManager,this.datafileManager.start(),this.readyPromise=this.datafileManager.onReady().then(this.onDatafileManagerReadyFulfill.bind(this),this.onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.onDatafileManagerUpdate.bind(this))):this.configObj?this.readyPromise=Promise.resolve({success:!0}):this.readyPromise=Promise.resolve({success:!1,reason:Qe(i,"Invalid datafile")})}catch(n){nt.error(n),this.readyPromise=Promise.resolve({success:!1,reason:Qe(n,"Error in initialize")})}}return t.prototype.onDatafileManagerReadyFulfill=function(){if(this.datafileManager){var e=this.handleNewDatafile(this.datafileManager.get());return e?{success:!1,reason:Qe(e)}:{success:!0}}return{success:!1,reason:Qe(null,"Datafile manager is not provided")}},t.prototype.onDatafileManagerReadyReject=function(e){return{success:!1,reason:Qe(e,"Failed to become ready")}},t.prototype.onDatafileManagerUpdate=function(){this.datafileManager&&this.handleNewDatafile(this.datafileManager.get())},t.prototype.handleNewDatafile=function(e){var r=this,i=gn({datafile:e,jsonSchemaValidator:this.jsonSchemaValidator,logger:nt}),n=i.configObj,a=i.error;if(a)nt.error(a);else{var o=this.configObj?this.configObj.revision:"null";n&&o!==n.revision&&(this.configObj=n,this.optimizelyConfigObj=null,hn(function(){r.updateListeners.forEach(function(s){return s(n)})}))}return a},t.prototype.getConfig=function(){return this.configObj},t.prototype.getOptimizelyConfig=function(){return!this.optimizelyConfigObj&&this.configObj&&(this.optimizelyConfigObj=rl(this.configObj,dn(this.configObj),nt)),this.optimizelyConfigObj},t.prototype.onReady=function(){return this.readyPromise},t.prototype.onUpdate=function(e){var r=this;return this.updateListeners.push(e),function(){var i=r.updateListeners.indexOf(e);i>-1&&r.updateListeners.splice(i,1)}},t.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.updateListeners=[]},t}();function al(t){return new nl(t)}var ol=1,sl=Math.pow(2,32),ul=1e4,ge="BUCKETER",ll="random",li=function(t){var e=[],r=t.experimentIdMap[t.experimentId],i=r.groupId;if(i){var n=t.groupIdMap[i];if(!n)throw new Error(P(I.INVALID_GROUP_ID,ge,i));if(n.policy===ll){var a=cl(n,t.bucketingId,t.userId,t.logger);if(a===null)return t.logger.log(h.INFO,v.USER_NOT_IN_ANY_EXPERIMENT,ge,t.userId,i),e.push([v.USER_NOT_IN_ANY_EXPERIMENT,ge,t.userId,i]),{result:null,reasons:e};if(a!==t.experimentId)return t.logger.log(h.INFO,v.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,ge,t.userId,t.experimentKey,i),e.push([v.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,ge,t.userId,t.experimentKey,i]),{result:null,reasons:e};t.logger.log(h.INFO,v.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,ge,t.userId,t.experimentKey,i),e.push([v.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,ge,t.userId,t.experimentKey,i])}}var o="".concat(t.bucketingId).concat(t.experimentId),s=Rn(o);t.logger.log(h.DEBUG,v.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,ge,s,t.userId),e.push([v.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,ge,s,t.userId]);var l=yn(s,t.trafficAllocationConfig);return l!==null&&!t.variationIdMap[l]?(l&&(t.logger.log(h.WARNING,v.INVALID_VARIATION_ID,ge),e.push([v.INVALID_VARIATION_ID,ge])),{result:null,reasons:e}):{result:l,reasons:e}},cl=function(t,e,r,i){var n="".concat(e).concat(t.id),a=Rn(n);i.log(h.DEBUG,v.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,ge,a,r);var o=t.trafficAllocation,s=yn(a,o);return s},yn=function(t,e){for(var r=0;r<e.length;r++)if(t<e[r].endOfRange)return e[r].entityId;return null},Rn=function(t){try{var e=Ho.v3(t,ol),r=e/sl;return Math.floor(r*ul)}catch(i){throw new Error(P(I.INVALID_BUCKETING_ID,ge,t,i.message))}},_t="SEMANTIC VERSION",mt=Q();function On(t){return/^\d+$/.test(t)}function xe(t){var e=t.indexOf("-"),r=t.indexOf("+");return e<0?!1:r<0?!0:e<r}function Nn(t){var e=t.indexOf("-"),r=t.indexOf("+");return r<0?!1:e<0?!0:r<e}function fl(t){return/\s/.test(t)}function ci(t){var e=t,r="";if(fl(t))return mt.warn(v.UNKNOWN_MATCH_TYPE,_t,t),null;if(xe(t)?(e=t.substring(0,t.indexOf("-")),r=t.substring(t.indexOf("-")+1)):Nn(t)&&(e=t.substring(0,t.indexOf("+")),r=t.substring(t.indexOf("+")+1)),typeof e!="string"||typeof r!="string")return null;var i=e.split(".").length-1;if(i>2)return mt.warn(v.UNKNOWN_MATCH_TYPE,_t,t),null;var n=e.split(".");if(n.length!=i+1)return mt.warn(v.UNKNOWN_MATCH_TYPE,_t,t),null;for(var a=0,o=n;a<o.length;a++){var s=o[a];if(!On(s))return mt.warn(v.UNKNOWN_MATCH_TYPE,_t,t),null}return r&&n.push(r),n}function dl(t,e){var r=ci(e),i=ci(t);if(!r||!i)return null;for(var n=r.length,a=0;a<i.length;a++){if(n<=a)return xe(t)||Nn(t)?1:-1;if(On(r[a])){var o=parseInt(r[a]),s=parseInt(i[a]);if(o>s)return 1;if(o<s)return-1}else{if(r[a]<i[a])return xe(t)&&!xe(e)?1:-1;if(r[a]>i[a])return!xe(t)&&xe(e)?-1:1}}return xe(e)&&!xe(t)?-1:0}var ue="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",le=Q(),Tn="exact",Nr="exists",An="ge",bn="gt",Sn="le",Dn="lt",wn="semver_eq",Ln="semver_ge",Cn="semver_gt",Un="semver_le",Mn="semver_lt",Vn="substring",gl=[Tn,Nr,bn,An,Dn,Sn,Vn,wn,Mn,Un,Cn,Ln],he={};he[Tn]=ar;he[Nr]=El;he[bn]=hl;he[An]=vl;he[Dn]=_l;he[Sn]=ml;he[Vn]=Il;he[wn]=yl;he[Cn]=Rl;he[Ln]=Nl;he[Mn]=Ol;he[Un]=Tl;function pl(t,e){var r=e.getAttributes(),i=t.match;if(typeof i<"u"&&gl.indexOf(i)===-1)return le.warn(v.UNKNOWN_MATCH_TYPE,ue,JSON.stringify(t)),null;var n=t.name;if(!r.hasOwnProperty(n)&&i!=Nr)return le.debug(v.MISSING_ATTRIBUTE_VALUE,ue,JSON.stringify(t),n),null;var a;return i?a=he[i]||ar:a=ar,a(t,e)}function fi(t){return typeof t=="string"||typeof t=="boolean"||H.isNumber(t)}function ar(t,e){var r=e.getAttributes(),i=t.value,n=typeof i,a=t.name,o=r[a],s=typeof o;return!fi(i)||H.isNumber(i)&&!H.isSafeInteger(i)?(le.warn(v.UNEXPECTED_CONDITION_VALUE,ue,JSON.stringify(t)),null):o===null?(le.debug(v.UNEXPECTED_TYPE_NULL,ue,JSON.stringify(t),a),null):!fi(o)||n!==s?(le.warn(v.UNEXPECTED_TYPE,ue,JSON.stringify(t),s,a),null):H.isNumber(o)&&!H.isSafeInteger(o)?(le.warn(v.OUT_OF_BOUNDS,ue,JSON.stringify(t),a),null):i===o}function El(t,e){var r=e.getAttributes(),i=r[t.name];return typeof i<"u"&&i!==null}function Ut(t,e){var r=e.getAttributes(),i=t.name,n=r[i],a=typeof n,o=t.value;return o===null||!H.isSafeInteger(o)?(le.warn(v.UNEXPECTED_CONDITION_VALUE,ue,JSON.stringify(t)),!1):n===null?(le.debug(v.UNEXPECTED_TYPE_NULL,ue,JSON.stringify(t),i),!1):H.isNumber(n)?H.isSafeInteger(n)?!0:(le.warn(v.OUT_OF_BOUNDS,ue,JSON.stringify(t),i),!1):(le.warn(v.UNEXPECTED_TYPE,ue,JSON.stringify(t),a,i),!1)}function hl(t,e){var r=e.getAttributes(),i=r[t.name],n=t.value;return!Ut(t,e)||n===null?null:i>n}function vl(t,e){var r=e.getAttributes(),i=r[t.name],n=t.value;return!Ut(t,e)||n===null?null:i>=n}function _l(t,e){var r=e.getAttributes(),i=r[t.name],n=t.value;return!Ut(t,e)||n===null?null:i<n}function ml(t,e){var r=e.getAttributes(),i=r[t.name],n=t.value;return!Ut(t,e)||n===null?null:i<=n}function Il(t,e){var r=e.getAttributes(),i=t.name,n=r[t.name],a=typeof n,o=t.value;return typeof o!="string"?(le.warn(v.UNEXPECTED_CONDITION_VALUE,ue,JSON.stringify(t)),null):n===null?(le.debug(v.UNEXPECTED_TYPE_NULL,ue,JSON.stringify(t),i),null):typeof n!="string"?(le.warn(v.UNEXPECTED_TYPE,ue,JSON.stringify(t),a,i),null):n.indexOf(o)!==-1}function dt(t,e){var r=e.getAttributes(),i=t.name,n=r[i],a=typeof n,o=t.value;return typeof o!="string"?(le.warn(v.UNEXPECTED_CONDITION_VALUE,ue,JSON.stringify(t)),null):n===null?(le.debug(v.UNEXPECTED_TYPE_NULL,ue,JSON.stringify(t),i),null):typeof n!="string"?(le.warn(v.UNEXPECTED_TYPE,ue,JSON.stringify(t),a,i),null):dl(o,n)}function yl(t,e){var r=dt(t,e);return r===null?null:r===0}function Rl(t,e){var r=dt(t,e);return r===null?null:r>0}function Ol(t,e){var r=dt(t,e);return r===null?null:r<0}function Nl(t,e){var r=dt(t,e);return r===null?null:r>=0}function Tl(t,e){var r=dt(t,e);return r===null?null:r<=0}var Al=Object.freeze({__proto__:null,evaluate:pl}),bl="ODP_SEGMENT_CONDITION_EVALUATOR",Sl=Q(),Pn="qualified",Dl=[Pn],Fn={};Fn[Pn]=or;function wl(t,e){var r=t.match;if(typeof r<"u"&&Dl.indexOf(r)===-1)return Sl.warn(v.UNKNOWN_MATCH_TYPE,bl,JSON.stringify(t)),null;var i;return r?i=Fn[r]||or:i=or,i(t,e)}function or(t,e){return e.isQualifiedFor(t.value)}var Ll=Object.freeze({__proto__:null,evaluate:wl}),It=Q(),yt="AUDIENCE_EVALUATOR",Cl=function(){function t(e){this.typeToEvaluatorMap=H.assign({},e,{custom_attribute:Al,third_party_dimension:Ll})}return t.prototype.evaluate=function(e,r,i){var n=this;if(!e||e.length===0)return!0;var a=function(o){var s=r[o];if(s){It.log(h.DEBUG,v.EVALUATING_AUDIENCE,yt,o,JSON.stringify(s.conditions));var l=ct(s.conditions,n.evaluateConditionWithUserAttributes.bind(n,i)),f=l===null?"UNKNOWN":l.toString().toUpperCase();return It.log(h.DEBUG,v.AUDIENCE_EVALUATION_RESULT,yt,o,f),l}return null};return!!ct(e,a)},t.prototype.evaluateConditionWithUserAttributes=function(e,r){var i=this.typeToEvaluatorMap[r.type];if(!i)return It.log(h.WARNING,v.UNKNOWN_CONDITION_TYPE,yt,JSON.stringify(r)),null;try{return i.evaluate(r,e)}catch(n){It.log(h.ERROR,I.CONDITION_EVALUATOR_ERROR,yt,r.type,n.message)}return null},t}(),Ul=function(t){return new Cl(t)};function xn(t){return typeof t=="string"&&t!==""}var T="DECISION_SERVICE",Ml=function(){function t(e){this.audienceEvaluator=Ul(e.UNSTABLE_conditionEvaluators),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}return t.prototype.getVariation=function(e,r,i,n){n===void 0&&(n={});var a=i.getUserId(),o=i.getAttributes(),s=this.getBucketingId(a,o),l=[],f=r.key;if(!this.checkIfExperimentIsActive(e,f))return this.logger.log(h.INFO,v.EXPERIMENT_NOT_RUNNING,T,f),l.push([v.EXPERIMENT_NOT_RUNNING,T,f]),{result:null,reasons:l};var d=this.getForcedVariation(e,f,a);l.push.apply(l,d.reasons);var E=d.result;if(E)return{result:E,reasons:l};var u=this.getWhitelistedVariation(r,a);l.push.apply(l,u.reasons);var c=u.result;if(c)return{result:c.key,reasons:l};var p=n[Se.IGNORE_USER_PROFILE_SERVICE],g=this.resolveExperimentBucketMap(a,o);if(!p&&(c=this.getStoredVariation(e,r,a,g),c))return this.logger.log(h.INFO,v.RETURNING_STORED_VARIATION,T,c.key,f,a),l.push([v.RETURNING_STORED_VARIATION,T,c.key,f,a]),{result:c.key,reasons:l};var _=this.checkIfUserIsInAudience(e,r,er.EXPERIMENT,i,"");if(l.push.apply(l,_.reasons),!_.result)return this.logger.log(h.INFO,v.USER_NOT_IN_EXPERIMENT,T,a,f),l.push([v.USER_NOT_IN_EXPERIMENT,T,a,f]),{result:null,reasons:l};var N=this.buildBucketerParams(e,r,s,a),k=li(N);l.push.apply(l,k.reasons);var R=k.result;return R&&(c=e.variationIdMap[R]),c?(this.logger.log(h.INFO,v.USER_HAS_VARIATION,T,a,c.key,f),l.push([v.USER_HAS_VARIATION,T,a,c.key,f]),p||this.saveUserProfile(r,c,a,g),{result:c.key,reasons:l}):(this.logger.log(h.DEBUG,v.USER_HAS_NO_VARIATION,T,a,f),l.push([v.USER_HAS_NO_VARIATION,T,a,f]),{result:null,reasons:l})},t.prototype.resolveExperimentBucketMap=function(e,r){r=r||{};var i=this.getUserProfile(e)||{},n=r[De.STICKY_BUCKETING_KEY];return H.assign({},i.experiment_bucket_map,n)},t.prototype.checkIfExperimentIsActive=function(e,r){return Eu(e,r)},t.prototype.getWhitelistedVariation=function(e,r){var i=[];if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(r)){var n=e.forcedVariations[r];return e.variationKeyMap.hasOwnProperty(n)?(this.logger.log(h.INFO,v.USER_FORCED_IN_VARIATION,T,r,n),i.push([v.USER_FORCED_IN_VARIATION,T,r,n]),{result:e.variationKeyMap[n],reasons:i}):(this.logger.log(h.ERROR,v.FORCED_BUCKETING_FAILED,T,n,r),i.push([v.FORCED_BUCKETING_FAILED,T,n,r]),{result:null,reasons:i})}return{result:null,reasons:i}},t.prototype.checkIfUserIsInAudience=function(e,r,i,n,a){var o=[],s=vu(e,r.id),l=Tu(e);this.logger.log(h.DEBUG,v.EVALUATING_AUDIENCES_COMBINED,T,i,a||r.key,JSON.stringify(s)),o.push([v.EVALUATING_AUDIENCES_COMBINED,T,i,a||r.key,JSON.stringify(s)]);var f=this.audienceEvaluator.evaluate(s,l,n);return this.logger.log(h.INFO,v.AUDIENCE_EVALUATION_RESULT_COMBINED,T,i,a||r.key,f.toString().toUpperCase()),o.push([v.AUDIENCE_EVALUATION_RESULT_COMBINED,T,i,a||r.key,f.toString().toUpperCase()]),{result:f,reasons:o}},t.prototype.buildBucketerParams=function(e,r,i,n){return{bucketingId:i,experimentId:r.id,experimentKey:r.key,experimentIdMap:e.experimentIdMap,experimentKeyMap:e.experimentKeyMap,groupIdMap:e.groupIdMap,logger:this.logger,trafficAllocationConfig:Iu(e,r.id),userId:n,variationIdMap:e.variationIdMap}},t.prototype.getStoredVariation=function(e,r,i,n){if(n.hasOwnProperty(r.id)){var a=n[r.id],o=a.variation_id;if(e.variationIdMap.hasOwnProperty(o))return e.variationIdMap[a.variation_id];this.logger.log(h.INFO,v.SAVED_VARIATION_NOT_FOUND,T,i,o,r.key)}return null},t.prototype.getUserProfile=function(e){var r={user_id:e,experiment_bucket_map:{}};if(!this.userProfileService)return r;try{return this.userProfileService.lookup(e)}catch(i){this.logger.log(h.ERROR,I.USER_PROFILE_LOOKUP_ERROR,T,e,i.message)}return null},t.prototype.saveUserProfile=function(e,r,i,n){if(this.userProfileService)try{n[e.id]={variation_id:r.id},this.userProfileService.save({user_id:i,experiment_bucket_map:n}),this.logger.log(h.INFO,v.SAVED_VARIATION,T,r.key,e.key,i)}catch(a){this.logger.log(h.ERROR,I.USER_PROFILE_SAVE_ERROR,T,i,a.message)}},t.prototype.getVariationForFeature=function(e,r,i,n){n===void 0&&(n={});var a=[],o=this.getVariationForFeatureExperiment(e,r,i,n);a.push.apply(a,o.reasons);var s=o.result;if(s.variation!==null)return{result:s,reasons:a};var l=this.getVariationForRollout(e,r,i);a.push.apply(a,l.reasons);var f=l.result,d=i.getUserId();return f.variation?(this.logger.log(h.DEBUG,v.USER_IN_ROLLOUT,T,d,r.key),a.push([v.USER_IN_ROLLOUT,T,d,r.key]),{result:f,reasons:a}):(this.logger.log(h.DEBUG,v.USER_NOT_IN_ROLLOUT,T,d,r.key),a.push([v.USER_NOT_IN_ROLLOUT,T,d,r.key]),{result:f,reasons:a})},t.prototype.getVariationForFeatureExperiment=function(e,r,i,n){n===void 0&&(n={});var a=[],o=null,s,l,f;if(r.experimentIds.length>0)for(l=0;l<r.experimentIds.length;l++){var d=yu(e,r.experimentIds[l],this.logger);if(d&&(s=this.getVariationFromExperimentRule(e,r.key,d,i,n),a.push.apply(a,s.reasons),o=s.result,o)){var E=null;return E=d.variationKeyMap[o],E||(E=ei(e,r.key,o)),f={experiment:d,variation:E,decisionSource:re.FEATURE_TEST},{result:f,reasons:a}}}else this.logger.log(h.DEBUG,v.FEATURE_HAS_NO_EXPERIMENTS,T,r.key),a.push([v.FEATURE_HAS_NO_EXPERIMENTS,T,r.key]);return f={experiment:null,variation:null,decisionSource:re.FEATURE_TEST},{result:f,reasons:a}},t.prototype.getVariationForRollout=function(e,r,i){var n=[],a;if(!r.rolloutId)return this.logger.log(h.DEBUG,v.NO_ROLLOUT_EXISTS,T,r.key),n.push([v.NO_ROLLOUT_EXISTS,T,r.key]),a={experiment:null,variation:null,decisionSource:re.ROLLOUT},{result:a,reasons:n};var o=e.rolloutIdMap[r.rolloutId];if(!o)return this.logger.log(h.ERROR,I.INVALID_ROLLOUT_ID,T,r.rolloutId,r.key),n.push([I.INVALID_ROLLOUT_ID,T,r.rolloutId,r.key]),a={experiment:null,variation:null,decisionSource:re.ROLLOUT},{result:a,reasons:n};var s=o.experiments;if(s.length===0)return this.logger.log(h.ERROR,v.ROLLOUT_HAS_NO_EXPERIMENTS,T,r.rolloutId),n.push([v.ROLLOUT_HAS_NO_EXPERIMENTS,T,r.rolloutId]),a={experiment:null,variation:null,decisionSource:re.ROLLOUT},{result:a,reasons:n};for(var l,f,d,E,u=0;u<s.length;){if(l=this.getVariationFromDeliveryRule(e,r.key,s,u,i),n.push.apply(n,l.reasons),d=l.result,f=l.skipToEveryoneElse,d)return E=e.experimentIdMap[s[u].id],a={experiment:E,variation:d,decisionSource:re.ROLLOUT},{result:a,reasons:n};u=f?s.length-1:u+1}return a={experiment:null,variation:null,decisionSource:re.ROLLOUT},{result:a,reasons:n}},t.prototype.getBucketingId=function(e,r){var i=e;return r!=null&&typeof r=="object"&&r.hasOwnProperty(De.BUCKETING_ID)&&(typeof r[De.BUCKETING_ID]=="string"?(i=String(r[De.BUCKETING_ID]),this.logger.log(h.DEBUG,v.VALID_BUCKETING_ID,T,i)):this.logger.log(h.WARNING,v.BUCKETING_ID_NOT_STRING,T)),i},t.prototype.findValidatedForcedDecision=function(e,r,i,n){var a=[],o=r.getForcedDecision({flagKey:i,ruleKey:n}),s=null,l,f=r.getUserId();return e&&o&&(l=o.variationKey,s=ei(e,i,l),s?n?(this.logger.log(h.INFO,v.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,l,i,n,f),a.push([v.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,l,i,n,f])):(this.logger.log(h.INFO,v.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,l,i,f),a.push([v.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,l,i,f])):n?(this.logger.log(h.INFO,v.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,i,n,f),a.push([v.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,i,n,f])):(this.logger.log(h.INFO,v.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,i,f),a.push([v.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,i,f]))),{result:s,reasons:a}},t.prototype.removeForcedVariation=function(e,r,i){if(!e)throw new Error(P(I.INVALID_USER_ID,T));if(this.forcedVariationMap.hasOwnProperty(e))delete this.forcedVariationMap[e][r],this.logger.log(h.DEBUG,v.VARIATION_REMOVED_FOR_USER,T,i,e);else throw new Error(P(I.USER_NOT_IN_FORCED_VARIATION,T,e))},t.prototype.setInForcedVariationMap=function(e,r,i){this.forcedVariationMap.hasOwnProperty(e)?this.forcedVariationMap[e][r]=i:(this.forcedVariationMap[e]={},this.forcedVariationMap[e][r]=i),this.logger.log(h.DEBUG,v.USER_MAPPED_TO_FORCED_VARIATION,T,i,r,e)},t.prototype.getForcedVariation=function(e,r,i){var n=[],a=this.forcedVariationMap[i];if(!a)return this.logger.log(h.DEBUG,v.USER_HAS_NO_FORCED_VARIATION,T,i),{result:null,reasons:n};var o;try{var s=nr(e,r);if(s.hasOwnProperty("id"))o=s.id;else return this.logger.log(h.ERROR,I.IMPROPERLY_FORMATTED_EXPERIMENT,T,r),n.push([I.IMPROPERLY_FORMATTED_EXPERIMENT,T,r]),{result:null,reasons:n}}catch(d){return this.logger.log(h.ERROR,d.message),n.push(d.message),{result:null,reasons:n}}var l=a[o];if(!l)return this.logger.log(h.DEBUG,v.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,T,r,i),{result:null,reasons:n};var f=fn(e,l);return f?(this.logger.log(h.DEBUG,v.USER_HAS_FORCED_VARIATION,T,f,r,i),n.push([v.USER_HAS_FORCED_VARIATION,T,f,r,i])):this.logger.log(h.DEBUG,v.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,T,r,i),{result:f,reasons:n}},t.prototype.setForcedVariation=function(e,r,i,n){if(n!=null&&!xn(n))return this.logger.log(h.ERROR,I.INVALID_VARIATION_KEY,T),!1;var a;try{var o=nr(e,r);if(o.hasOwnProperty("id"))a=o.id;else return this.logger.log(h.ERROR,I.IMPROPERLY_FORMATTED_EXPERIMENT,T,r),!1}catch(l){return this.logger.log(h.ERROR,l.message),!1}if(n==null)try{return this.removeForcedVariation(i,a,r),!0}catch(l){return this.logger.log(h.ERROR,l.message),!1}var s=mu(e,r,n);if(!s)return this.logger.log(h.ERROR,I.NO_VARIATION_FOR_EXPERIMENT_KEY,T,n,r),!1;try{return this.setInForcedVariationMap(i,a,s),!0}catch(l){return this.logger.log(h.ERROR,l.message),!1}},t.prototype.getVariationFromExperimentRule=function(e,r,i,n,a){a===void 0&&(a={});var o=[],s=this.findValidatedForcedDecision(e,n,r,i.key);o.push.apply(o,s.reasons);var l=s.result;if(l)return{result:l.key,reasons:o};var f=this.getVariation(e,i,n,a);o.push.apply(o,f.reasons);var d=f.result;return{result:d,reasons:o}},t.prototype.getVariationFromDeliveryRule=function(e,r,i,n,a){var o=[],s=!1,l=i[n],f=this.findValidatedForcedDecision(e,a,r,l.key);o.push.apply(o,f.reasons);var d=f.result;if(d)return{result:d,reasons:o,skipToEveryoneElse:s};var E=a.getUserId(),u=a.getAttributes(),c=this.getBucketingId(E,u),p=n===i.length-1,g=p?"Everyone Else":n+1,_=null,N,k,R,b=this.checkIfUserIsInAudience(e,l,er.RULE,a,g);return o.push.apply(o,b.reasons),b.result?(this.logger.log(h.DEBUG,v.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,T,E,g),o.push([v.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,T,E,g]),k=this.buildBucketerParams(e,l,c,E),R=li(k),o.push.apply(o,R.reasons),N=R.result,N&&(_=_u(e,N)),_?(this.logger.log(h.DEBUG,v.USER_BUCKETED_INTO_TARGETING_RULE,T,E,g),o.push([v.USER_BUCKETED_INTO_TARGETING_RULE,T,E,g])):p||(this.logger.log(h.DEBUG,v.USER_NOT_BUCKETED_INTO_TARGETING_RULE,T,E,g),o.push([v.USER_NOT_BUCKETED_INTO_TARGETING_RULE,T,E,g]),s=!0)):(this.logger.log(h.DEBUG,v.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,T,E,g),o.push([v.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,T,E,g])),{result:_,reasons:o,skipToEveryoneElse:s}},t}();function Vl(t){return new Ml(t)}var Lt="EVENT_TAG_UTILS",Pl="revenue",Fl="value";function kn(t,e){var r=t[Pl];if(r==null)return null;var i=typeof r=="string"?parseInt(r):r;return isFinite(i)?(e.log(h.INFO,v.PARSED_REVENUE_VALUE,Lt,i),i):(e.log(h.INFO,v.FAILED_TO_PARSE_REVENUE,Lt,r),null)}function Gn(t,e){var r=t[Fl];if(r==null)return null;var i=typeof r=="string"?parseFloat(r):r;return isFinite(i)?(e.log(h.INFO,v.PARSED_NUMERIC_VALUE,Lt,i),i):(e.log(h.INFO,v.FAILED_TO_PARSE_VALUE,Lt,r),null)}var di="ATTRIBUTES_VALIDATOR";function xl(t){if(typeof t=="object"&&!Array.isArray(t)&&t!==null)return Object.keys(t).forEach(function(e){if(typeof t[e]>"u")throw new Error(P(I.UNDEFINED_ATTRIBUTE,di,e))}),!0;throw new Error(P(I.INVALID_ATTRIBUTES,di))}function Bn(t,e){return typeof t=="string"&&(typeof e=="string"||typeof e=="boolean"||H.isNumber(e)&&H.isSafeInteger(e))}var kl="campaign_activated",gi="custom",qn="https://logx.optimizely.com/v1/events",Hn="POST";function zn(t){var e=t.attributes,r=t.userId,i=t.clientEngine,n=t.clientVersion,a=t.configObj,o=t.logger,s=a.anonymizeIP?a.anonymizeIP:!1,l=a.botFiltering,f={snapshots:[],visitor_id:r,attributes:[]},d={account_id:a.accountId,project_id:a.projectId,visitors:[f],revision:a.revision,client_name:i,client_version:n,anonymize_ip:s,enrich_decisions:!0};return e&&Object.keys(e||{}).forEach(function(E){var u=e[E];if(Bn(E,u)){var c=un(a,E,o);c&&d.visitors[0].attributes.push({entity_id:c,key:E,type:gi,value:u})}}),typeof l=="boolean"&&d.visitors[0].attributes.push({entity_id:De.BOT_FILTERING,key:De.BOT_FILTERING,type:gi,value:l}),d}function Gl(t,e,r,i,n,a,o){var s=e?sn(t,e):null,l=r?fn(t,r):null;l=l||"";var f={decisions:[{campaign_id:s,experiment_id:e,variation_id:r,metadata:{flag_key:a,rule_key:i,rule_type:n,variation_key:l,enabled:o}}],events:[{entity_id:s,timestamp:H.currentTimestamp(),key:kl,uuid:H.uuid()}]};return f}function Bl(t,e,r,i){var n={events:[]},a={entity_id:ln(t,e),timestamp:H.currentTimestamp(),uuid:H.uuid(),key:e};if(i){var o=kn(i,r);o!==null&&(a.revenue=o);var s=Gn(i,r);s!==null&&(a.value=s),a.tags=i}return n.events.push(a),n}function ql(t){var e=zn(t),r=Gl(t.configObj,t.experimentId,t.variationId,t.ruleKey,t.ruleType,t.flagKey,t.enabled);e.visitors[0].snapshots.push(r);var i={httpVerb:Hn,url:qn,params:e};return i}function Hl(t){var e=zn(t),r=Bl(t.configObj,t.eventKey,t.logger,t.eventTags);e.visitors[0].snapshots=[r];var i={httpVerb:Hn,url:qn,params:e};return i}function sr(t){var e,r;return(r=(e=t.experiment)===null||e===void 0?void 0:e.key)!==null&&r!==void 0?r:""}function ur(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.key)!==null&&r!==void 0?r:""}function Rt(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.featureEnabled)!==null&&r!==void 0?r:!1}function jn(t){var e,r;return(r=(e=t.experiment)===null||e===void 0?void 0:e.id)!==null&&r!==void 0?r:null}function Kn(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.id)!==null&&r!==void 0?r:null}var lr=Q("EVENT_BUILDER"),zl=function(t){var e=t.configObj,r=t.decisionObj,i=t.userId,n=t.flagKey,a=t.enabled,o=t.userAttributes,s=t.clientEngine,l=t.clientVersion,f=r.decisionSource,d=sr(r),E=jn(r),u=ur(r),c=Kn(r),p=E!==null?sn(e,E):null;return{type:"impression",timestamp:H.currentTimestamp(),uuid:H.uuid(),user:{id:i,attributes:Yn(e,o)},context:{accountId:e.accountId,projectId:e.projectId,revision:e.revision,clientName:s,clientVersion:l,anonymizeIP:e.anonymizeIP||!1,botFiltering:e.botFiltering},layer:{id:p},experiment:{id:E,key:d},variation:{id:c,key:u},ruleKey:d,flagKey:n,ruleType:f,enabled:a}},jl=function(t){var e=t.configObj,r=t.userId,i=t.userAttributes,n=t.clientEngine,a=t.clientVersion,o=t.eventKey,s=t.eventTags,l=ln(e,o),f=s?kn(s,lr):null,d=s?Gn(s,lr):null;return{type:"conversion",timestamp:H.currentTimestamp(),uuid:H.uuid(),user:{id:r,attributes:Yn(e,i)},context:{accountId:e.accountId,projectId:e.projectId,revision:e.revision,clientName:n,clientVersion:a,anonymizeIP:e.anonymizeIP||!1,botFiltering:e.botFiltering},event:{id:l,key:o},revenue:f,value:d,tags:s}};function Yn(t,e){var r=[];return e&&Object.keys(e||{}).forEach(function(i){var n=e[i];if(Bn(i,n)){var a=un(t,i,lr);a&&r.push({entityId:a,key:i,value:n})}}),r}var Kl="EVENT_TAGS_VALIDATOR";function Yl(t){if(typeof t=="object"&&!Array.isArray(t)&&t!==null)return!0;throw new Error(P(I.INVALID_EVENT_TAGS,Kl))}var Xt="USER_PROFILE_SERVICE_VALIDATOR";function Xl(t){if(typeof t=="object"&&t!==null){if(typeof t.lookup!="function")throw new Error(P(I.INVALID_USER_PROFILE_SERVICE,Xt,"Missing function 'lookup'"));if(typeof t.save!="function")throw new Error(P(I.INVALID_USER_PROFILE_SERVICE,Xt,"Missing function 'save'"));return!0}throw new Error(P(I.INVALID_USER_PROFILE_SERVICE,Xt))}var w="OPTIMIZELY",$l=3e4,Wl=function(){function t(e){var r=this,i,n=e.clientEngine;n||(e.logger.log(h.INFO,v.INVALID_CLIENT_ENGINE,w,n),n=zi),this.clientEngine=n,this.clientVersion=e.clientVersion||Rr,this.errorHandler=e.errorHandler,this.isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger,this.odpManager=e.odpManager;var a=(i=e.defaultDecideOptions)!==null&&i!==void 0?i:[];Array.isArray(a)||(this.logger.log(h.DEBUG,v.INVALID_DEFAULT_DECIDE_OPTIONS,w),a=[]);var o={};a.forEach(function(d){Se[d]?o[d]=!0:r.logger.log(h.WARNING,v.UNRECOGNIZED_DECIDE_OPTION,w,d)}),this.defaultDecideOptions=o,this.projectConfigManager=al({datafile:e.datafile,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey,datafileManager:e.datafileManager}),this.disposeOnUpdate=this.projectConfigManager.onUpdate(function(d){r.logger.log(h.INFO,v.UPDATED_OPTIMIZELY_CONFIG,w,d.revision,d.projectId),r.notificationCenter.sendNotifications(se.OPTIMIZELY_CONFIG_UPDATE),r.updateOdpSettings()});var s=this.projectConfigManager.onReady(),l=null;if(e.userProfileService)try{Xl(e.userProfileService)&&(l=e.userProfileService,this.logger.log(h.INFO,v.VALID_USER_PROFILE_SERVICE,w))}catch(d){this.logger.log(h.WARNING,d.message)}this.decisionService=Vl({userProfileService:l,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators}),this.notificationCenter=e.notificationCenter,this.eventProcessor=e.eventProcessor;var f=this.eventProcessor.start();this.readyPromise=Promise.all([s,f,e.odpManager?e.odpManager.onReady():Promise.resolve()]).then(function(d){return d[0]}),this.readyTimeouts={},this.nextReadyTimeoutId=0}return t.prototype.getProjectConfig=function(){return this.projectConfigManager.getConfig()},t.prototype.isValidInstance=function(){return this.isOptimizelyConfigValid&&!!this.projectConfigManager.getConfig()},t.prototype.activate=function(e,r,i){try{if(!this.isValidInstance())return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"activate"),null;if(!this.validateInputs({experiment_key:e,user_id:r},i))return this.notActivatingExperiment(e,r);var n=this.projectConfigManager.getConfig();if(!n)return null;try{var a=this.getVariation(e,r,i);if(a===null)return this.notActivatingExperiment(e,r);if(!hu(n,e))return this.logger.log(h.DEBUG,v.SHOULD_NOT_DISPATCH_ACTIVATE,w,e),a;var o=nr(n,e),s=o.variationKeyMap[a],l={experiment:o,variation:s,decisionSource:re.EXPERIMENT};return this.sendImpressionEvent(l,"",r,!0,i),a}catch(f){return this.logger.log(h.ERROR,f.message),this.logger.log(h.INFO,v.NOT_ACTIVATING_USER,w,r,e),this.errorHandler.handleError(f),null}}catch(f){return this.logger.log(h.ERROR,f.message),this.errorHandler.handleError(f),null}},t.prototype.sendImpressionEvent=function(e,r,i,n,a){var o=this.projectConfigManager.getConfig();if(o){var s=zl({decisionObj:e,flagKey:r,enabled:n,userId:i,userAttributes:a,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o});this.eventProcessor.process(s),this.emitNotificationCenterActivate(e,r,i,n,a)}},t.prototype.emitNotificationCenterActivate=function(e,r,i,n,a){var o=this.projectConfigManager.getConfig();if(o){var s=e.decisionSource,l=sr(e),f=jn(e),d=ur(e),E=Kn(e),u;f!==null&&d!==""&&(u=o.experimentIdMap[f]);var c={attributes:a,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o,experimentId:f,ruleKey:l,flagKey:r,ruleType:s,userId:i,enabled:n,variationId:E,logger:this.logger},p=ql(c),g;u&&u.variationKeyMap&&d!==""&&(g=u.variationKeyMap[d]),this.notificationCenter.sendNotifications(se.ACTIVATE,{experiment:u,userId:i,attributes:a,variation:g,logEvent:p})}},t.prototype.track=function(e,r,i,n){try{if(!this.isValidInstance()){this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"track");return}if(!this.validateInputs({user_id:r,event_key:e},i,n))return;var a=this.projectConfigManager.getConfig();if(!a)return;if(!Au(a,e)){this.logger.log(h.WARNING,v.EVENT_KEY_NOT_FOUND,w,e),this.logger.log(h.WARNING,v.NOT_TRACKING_USER,w,r);return}n=this.filterEmptyValues(n);var o=jl({eventKey:e,eventTags:n,userId:r,userAttributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a});this.logger.log(h.INFO,v.TRACK_EVENT,w,e,r),this.eventProcessor.process(o),this.emitNotificationCenterTrack(e,r,i,n)}catch(s){this.logger.log(h.ERROR,s.message),this.errorHandler.handleError(s),this.logger.log(h.ERROR,v.NOT_TRACKING_USER,w,r)}},t.prototype.emitNotificationCenterTrack=function(e,r,i,n){try{var a=this.projectConfigManager.getConfig();if(!a)return;var o={attributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a,eventKey:e,eventTags:n,logger:this.logger,userId:r},s=Hl(o);this.notificationCenter.sendNotifications(se.TRACK,{eventKey:e,userId:r,attributes:i,eventTags:n,logEvent:s})}catch(l){this.logger.log(h.ERROR,l.message),this.errorHandler.handleError(l)}},t.prototype.getVariation=function(e,r,i){try{if(!this.isValidInstance())return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getVariation"),null;try{if(!this.validateInputs({experiment_key:e,user_id:r},i))return null;var n=this.projectConfigManager.getConfig();if(!n)return null;var a=n.experimentKeyMap[e];if(!a||a.isRollout)return this.logger.log(h.DEBUG,I.INVALID_EXPERIMENT_KEY,w,e),null;var o=this.decisionService.getVariation(n,a,this.createInternalUserContext(r,i)).result,s=bu(n,a.id)?je.FEATURE_TEST:je.AB_TEST;return this.notificationCenter.sendNotifications(se.DECISION,{type:s,userId:r,attributes:i||{},decisionInfo:{experimentKey:e,variationKey:o}}),o}catch(l){return this.logger.log(h.ERROR,l.message),this.errorHandler.handleError(l),null}}catch(l){return this.logger.log(h.ERROR,l.message),this.errorHandler.handleError(l),null}},t.prototype.setForcedVariation=function(e,r,i){if(!this.validateInputs({experiment_key:e,user_id:r}))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;try{return this.decisionService.setForcedVariation(n,e,r,i)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),!1}},t.prototype.getForcedVariation=function(e,r){if(!this.validateInputs({experiment_key:e,user_id:r}))return null;var i=this.projectConfigManager.getConfig();if(!i)return null;try{return this.decisionService.getForcedVariation(i,e,r).result}catch(n){return this.logger.log(h.ERROR,n.message),this.errorHandler.handleError(n),null}},t.prototype.validateInputs=function(e,r,i){try{if(e.hasOwnProperty("user_id")){var n=e.user_id;if(typeof n!="string"||n===null||n==="undefined")throw new Error(P(I.INVALID_INPUT_FORMAT,w,"user_id"));delete e.user_id}return Object.keys(e).forEach(function(a){if(!xn(e[a]))throw new Error(P(I.INVALID_INPUT_FORMAT,w,a))}),r&&xl(r),i&&Yl(i),!0}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),!1}},t.prototype.notActivatingExperiment=function(e,r){return this.logger.log(h.INFO,v.NOT_ACTIVATING_USER,w,r,e),null},t.prototype.filterEmptyValues=function(e){for(var r in e)e.hasOwnProperty(r)&&(e[r]===null||e[r]===void 0)&&delete e[r];return e},t.prototype.isFeatureEnabled=function(e,r,i){try{if(!this.isValidInstance())return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"isFeatureEnabled"),!1;if(!this.validateInputs({feature_key:e,user_id:r},i))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;var a=Kt(n,e,this.logger);if(!a)return!1;var o={},s=this.createInternalUserContext(r,i),l=this.decisionService.getVariationForFeature(n,a,s).result,f=l.decisionSource,d=sr(l),E=ur(l),u=Rt(l);f===re.FEATURE_TEST&&(o={experimentKey:d,variationKey:E}),(f===re.FEATURE_TEST||f===re.ROLLOUT&&ti(n))&&this.sendImpressionEvent(l,a.key,r,u,i),u===!0?this.logger.log(h.INFO,v.FEATURE_ENABLED_FOR_USER,w,e,r):(this.logger.log(h.INFO,v.FEATURE_NOT_ENABLED_FOR_USER,w,e,r),u=!1);var c={featureKey:e,featureEnabled:u,source:l.decisionSource,sourceInfo:o};return this.notificationCenter.sendNotifications(se.DECISION,{type:je.FEATURE,userId:r,attributes:i||{},decisionInfo:c}),u}catch(p){return this.logger.log(h.ERROR,p.message),this.errorHandler.handleError(p),!1}},t.prototype.getEnabledFeatures=function(e,r){var i=this;try{var n=[];if(!this.isValidInstance())return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getEnabledFeatures"),n;if(!this.validateInputs({user_id:e}))return n;var a=this.projectConfigManager.getConfig();return a&&we(a.featureKeyMap).forEach(function(o){i.isFeatureEnabled(o.key,e,r)&&n.push(o.key)}),n}catch(o){return this.logger.log(h.ERROR,o.message),this.errorHandler.handleError(o),[]}},t.prototype.getFeatureVariable=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,null,i,n):(this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getFeatureVariable"),null)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),null}},t.prototype.getFeatureVariableForType=function(e,r,i,n,a){if(!this.validateInputs({feature_key:e,variable_key:r,user_id:n},a))return null;var o=this.projectConfigManager.getConfig();if(!o)return null;var s=Kt(o,e,this.logger);if(!s)return null;var l=Ru(o,e,r,this.logger);if(!l)return null;if(i&&l.type!==i)return this.logger.log(h.WARNING,v.VARIABLE_REQUESTED_WITH_WRONG_TYPE,w,i,l.type),null;var f=this.createInternalUserContext(n,a),d=this.decisionService.getVariationForFeature(o,s,f).result,E=Rt(d),u=this.getFeatureVariableValueFromVariation(e,E,d.variation,l,n),c={};return d.decisionSource===re.FEATURE_TEST&&d.experiment!==null&&d.variation!==null&&(c={experimentKey:d.experiment.key,variationKey:d.variation.key}),this.notificationCenter.sendNotifications(se.DECISION,{type:je.FEATURE_VARIABLE,userId:n,attributes:a||{},decisionInfo:{featureKey:e,featureEnabled:E,source:d.decisionSource,variableKey:r,variableValue:u,variableType:l.type,sourceInfo:c}}),u},t.prototype.getFeatureVariableValueFromVariation=function(e,r,i,n,a){var o=this.projectConfigManager.getConfig();if(!o)return null;var s=n.defaultValue;if(i!==null){var l=Ou(o,n,i,this.logger);l!==null?r?(s=l,this.logger.log(h.INFO,v.USER_RECEIVED_VARIABLE_VALUE,w,s,n.key,e)):this.logger.log(h.INFO,v.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,w,e,a,s):this.logger.log(h.INFO,v.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,w,n.key,i.key)}else this.logger.log(h.INFO,v.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,w,a,n.key,e);return Nu(s,n.type,this.logger)},t.prototype.getFeatureVariableBoolean=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,pe.BOOLEAN,i,n):(this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getFeatureVariableBoolean"),null)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),null}},t.prototype.getFeatureVariableDouble=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,pe.DOUBLE,i,n):(this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getFeatureVariableDouble"),null)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),null}},t.prototype.getFeatureVariableInteger=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,pe.INTEGER,i,n):(this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getFeatureVariableInteger"),null)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),null}},t.prototype.getFeatureVariableString=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,pe.STRING,i,n):(this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getFeatureVariableString"),null)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),null}},t.prototype.getFeatureVariableJSON=function(e,r,i,n){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,pe.JSON,i,n):(this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getFeatureVariableJSON"),null)}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),null}},t.prototype.getAllFeatureVariables=function(e,r,i){var n=this;try{if(!this.isValidInstance())return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"getAllFeatureVariables"),null;if(!this.validateInputs({feature_key:e,user_id:r},i))return null;var a=this.projectConfigManager.getConfig();if(!a)return null;var o=Kt(a,e,this.logger);if(!o)return null;var s=this.createInternalUserContext(r,i),l=this.decisionService.getVariationForFeature(a,o,s).result,f=Rt(l),d={};o.variables.forEach(function(u){d[u.key]=n.getFeatureVariableValueFromVariation(e,f,l.variation,u,r)});var E={};return l.decisionSource===re.FEATURE_TEST&&l.experiment!==null&&l.variation!==null&&(E={experimentKey:l.experiment.key,variationKey:l.variation.key}),this.notificationCenter.sendNotifications(se.DECISION,{type:je.ALL_FEATURE_VARIABLES,userId:r,attributes:i||{},decisionInfo:{featureKey:e,featureEnabled:f,source:l.decisionSource,variableValues:d,sourceInfo:E}}),d}catch(u){return this.logger.log(h.ERROR,u.message),this.errorHandler.handleError(u),null}},t.prototype.getOptimizelyConfig=function(){try{var e=this.projectConfigManager.getConfig();return e?this.projectConfigManager.getOptimizelyConfig():null}catch(r){return this.logger.log(h.ERROR,r.message),this.errorHandler.handleError(r),null}},t.prototype.close=function(){var e=this,r;try{this.odpManager&&this.odpManager.stop(),this.notificationCenter.clearAllNotificationListeners();var i=(r=this.projectConfigManager.getConfig())===null||r===void 0?void 0:r.sdkKey;i&&nn.removeNotificationCenter(i);var n=this.eventProcessor.stop();return this.disposeOnUpdate&&(this.disposeOnUpdate(),this.disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.readyTimeouts).forEach(function(a){var o=e.readyTimeouts[a];clearTimeout(o.readyTimeout),o.onClose()}),this.readyTimeouts={},n.then(function(){return{success:!0}},function(a){return{success:!1,reason:String(a)}})}catch(a){return this.logger.log(h.ERROR,a.message),this.errorHandler.handleError(a),Promise.resolve({success:!1,reason:String(a)})}},t.prototype.onReady=function(e){var r=this,i;typeof e=="object"&&e!==null&&e.timeout!==void 0&&(i=e.timeout),H.isSafeInteger(i)||(i=$l);var n,a=new Promise(function(d){n=d}),o=this.nextReadyTimeoutId;this.nextReadyTimeoutId++;var s=function(){delete r.readyTimeouts[o],n({success:!1,reason:P("onReady timeout expired after %s ms",i)})},l=setTimeout(s,i),f=function(){n({success:!1,reason:"Instance closed"})};return this.readyTimeouts[o]={readyTimeout:l,onClose:f},this.readyPromise.then(function(){clearTimeout(l),delete r.readyTimeouts[o],n({success:!0})}),Promise.race([this.readyPromise,a])},t.prototype.createUserContext=function(e,r){var i,n=e??((i=this.odpManager)===null||i===void 0?void 0:i.getVuid());return n===void 0||!this.validateInputs({user_id:n},r)?null:new ui({optimizely:this,userId:n,attributes:r,shouldIdentifyUser:!0})},t.prototype.createInternalUserContext=function(e,r){return new ui({optimizely:this,userId:e,attributes:r,shouldIdentifyUser:!1})},t.prototype.decide=function(e,r,i){var n=this,a,o,s,l;i===void 0&&(i=[]);var f=e.getUserId(),d=e.getAttributes(),E=this.projectConfigManager.getConfig(),u=[],c;if(!this.isValidInstance()||!E)return this.logger.log(h.INFO,v.INVALID_OBJECT,w,"decide"),si(r,e,[tr.SDK_NOT_READY]);var p=E.featureKeyMap[r];if(!p)return this.logger.log(h.ERROR,I.FEATURE_NOT_IN_DATAFILE,w,r),si(r,e,[P(tr.FLAG_KEY_INVALID,r)]);var g=this.getAllDecideOptions(i),_=this.decisionService.findValidatedForcedDecision(E,e,r);u.push.apply(u,_.reasons);var N=_.result;if(N)c={experiment:null,variation:N,decisionSource:re.FEATURE_TEST};else{var k=this.decisionService.getVariationForFeature(E,p,e,g);u.push.apply(u,k.reasons),c=k.result}var R=c.decisionSource,b=(o=(a=c.experiment)===null||a===void 0?void 0:a.key)!==null&&o!==void 0?o:null,z=(l=(s=c.variation)===null||s===void 0?void 0:s.key)!==null&&l!==void 0?l:null,X=Rt(c);X===!0?this.logger.log(h.INFO,v.FEATURE_ENABLED_FOR_USER,w,r,f):this.logger.log(h.INFO,v.FEATURE_NOT_ENABLED_FOR_USER,w,r,f);var ie={},B=!1;g[Se.EXCLUDE_VARIABLES]||p.variables.forEach(function(ve){ie[ve.key]=n.getFeatureVariableValueFromVariation(r,X,c.variation,ve,f)}),!g[Se.DISABLE_DECISION_EVENT]&&(R===re.FEATURE_TEST||R===re.ROLLOUT&&ti(E))&&(this.sendImpressionEvent(c,r,f,X,d),B=!0);var j=g[Se.INCLUDE_REASONS],ne=[];j&&(ne=u.map(function(ve){return P.apply(void 0,et([ve[0]],ve.slice(1),!1))}));var Re={flagKey:r,enabled:X,variationKey:z,ruleKey:b,variables:ie,reasons:ne,decisionEventDispatched:B};return this.notificationCenter.sendNotifications(se.DECISION,{type:je.FLAG,userId:f,attributes:d,decisionInfo:Re}),{variationKey:z,enabled:X,variables:ie,ruleKey:b,flagKey:r,userContext:e,reasons:ne}},t.prototype.getAllDecideOptions=function(e){var r=this,i=Ee({},this.defaultDecideOptions);return Array.isArray(e)?e.forEach(function(n){Se[n]?i[n]=!0:r.logger.log(h.WARNING,v.UNRECOGNIZED_DECIDE_OPTION,w,n)}):this.logger.log(h.DEBUG,v.INVALID_DECIDE_OPTIONS,w),i},t.prototype.decideForKeys=function(e,r,i){var n=this;i===void 0&&(i=[]);var a={};if(!this.isValidInstance())return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"decideForKeys"),a;if(r.length===0)return a;var o=this.getAllDecideOptions(i);return r.forEach(function(s){var l=n.decide(e,s,i);(!o[Se.ENABLED_FLAGS_ONLY]||l.enabled)&&(a[s]=l)}),a},t.prototype.decideAll=function(e,r){r===void 0&&(r=[]);var i=this.projectConfigManager.getConfig(),n={};if(!this.isValidInstance()||!i)return this.logger.log(h.ERROR,v.INVALID_OBJECT,w,"decideAll"),n;var a=Object.keys(i.featureKeyMap);return this.decideForKeys(e,a,r)},t.prototype.updateOdpSettings=function(){var e=this.projectConfigManager.getConfig();e&&this.odpManager&&this.odpManager.updateSettings(e.odpIntegrationConfig)},t.prototype.sendOdpEvent=function(e,r,i,n){if(!this.odpManager){this.logger.error(I.ODP_EVENT_FAILED_ODP_MANAGER_MISSING);return}var a=r??St,o=new Map(i);if(i&&i.size>0)try{i.forEach(function(l,f){(Xi===f.toLowerCase()||ye.FS_USER_ID===f.toLowerCase())&&(o.delete(f),o.set(ye.FS_USER_ID,l))})}catch{this.logger.warn(v.ODP_SEND_EVENT_IDENTIFIER_CONVERSION_FAILED)}try{var s=new wt(a,e,o,n);this.odpManager.sendEvent(s)}catch(l){this.logger.error(I.ODP_EVENT_FAILED,l)}},t.prototype.isOdpIntegrated=function(){var e,r,i;return(i=(r=(e=this.projectConfigManager.getConfig())===null||e===void 0?void 0:e.odpIntegrationConfig)===null||r===void 0?void 0:r.integrated)!==null&&i!==void 0?i:!1},t.prototype.identifyUser=function(e){this.odpManager&&this.isOdpIntegrated()&&this.odpManager.identifyUser(e)},t.prototype.fetchQualifiedSegments=function(e,r){return W(this,void 0,void 0,function(){return J(this,function(i){switch(i.label){case 0:return this.odpManager?[4,this.odpManager.fetchQualifiedSegments(e,r)]:[2,null];case 1:return[2,i.sent()]}})})},t.prototype.getVuid=function(){var e;if(!this.odpManager){(e=this.logger)===null||e===void 0||e.error("Unable to get VUID - ODP Manager is not instantiated yet.");return}if(!this.odpManager.isVuidEnabled()){this.logger.log(h.WARNING,"getVuid() unavailable for this platform",w);return}return this.odpManager.getVuid()},t}(),Jl={parseUserAgentInfo:function(){var t=new Ko.UAParser,e=t.getResult(),r=e.os,i=e.device;return{os:r,device:i}}};function Ql(){return Jl}var Zl=Object.freeze({__proto__:null,get LogLevel(){return O},getLogger:Q,setLogHandler:Hi,LOG_LEVEL:h,createLogger:Or}),be=Q();Ye.setLogHandler(Or());Ye.setLogLevel(O.INFO);var ec="INDEX_BROWSER",pi=10,Ei=1e3,tc=1e4,cr=!1,rc=function(t){var e;try{var r=!1;t.errorHandler&&Xo(t.errorHandler),t.logger&&(Ye.setLogHandler(t.logger),Ye.setLogLevel(O.NOTSET)),t.logLevel!==void 0&&Ye.setLogLevel(t.logLevel);try{Ji.validate(t),r=!0}catch(_){be.error(_)}var i=void 0;t.eventDispatcher==null?(i=new Wi({eventDispatcher:Qi}),cr||(i.sendPendingEvents(),cr=!0)):i=t.eventDispatcher;var n=t.closingEventDispatcher;!t.eventDispatcher&&!n&&window.navigator&&"sendBeacon"in window.navigator&&(n=Zi);var a=t.eventBatchSize,o=t.eventFlushInterval;Wr.validateEventBatchSize(t.eventBatchSize)||(be.warn("Invalid eventBatchSize %s, defaulting to %s",t.eventBatchSize,pi),a=pi),Wr.validateEventFlushInterval(t.eventFlushInterval)||(be.warn("Invalid eventFlushInterval %s, defaulting to %s",t.eventFlushInterval,Ei),o=Ei);var s=xi(),l=tn({logger:be,errorHandler:s}),f={dispatcher:i,closingDispatcher:n,flushInterval:o,batchSize:a,maxQueueSize:t.eventMaxQueueSize||tc,notificationCenter:l},d=((e=t.odpOptions)===null||e===void 0?void 0:e.disabled)===!0;d&&be.info(v.ODP_DISABLED);var E=t.clientEngine,u=t.clientVersion,c=Ee(Ee({clientEngine:yr},t),{eventProcessor:Hs.createEventProcessor(f),logger:be,errorHandler:s,datafileManager:t.sdkKey?Su(t.sdkKey,be,t.datafile,t.datafileOptions):void 0,notificationCenter:l,isValidInstance:r,odpManager:d?void 0:Ju.createInstance({logger:be,odpOptions:t.odpOptions,clientEngine:E,clientVersion:u})}),p=new Wl(c);try{if(typeof window.addEventListener=="function"){var g="onpagehide"in window?"pagehide":"unload";window.addEventListener(g,function(){p.close()},!1)}}catch(_){be.error(v.UNABLE_TO_ATTACH_UNLOAD,ec,_.message)}return p}catch(_){return be.error(_),null}},ic=function(){cr=!1},nc=Ye.setLogHandler,ac=Ye.setLogLevel;Ee(Ee({},Zl),{logging:Fs,errorHandler:Ls,eventDispatcher:Qi,sendBeaconEventDispatcher:Zi,enums:ds,setLogger:nc,setLogLevel:ac,createInstance:rc,__internalResetRetryState:ic,OptimizelyDecideOption:Se,getUserAgentParser:Ql});const oc="[embossing-selection]",sc="__EMBOSSING_SELECTION_PROPS__";function uc(){var t;try{const e=(t=document.getElementById(sc))==null?void 0:t.textContent;return Lo(e)}catch(e){throw ft(`${oc} Failed to hydrate props`,e,{logLevel:"info"}),e}}var hi={};let vi=!1;const _i=t=>`${t}-data-env`,lc=({rootElementId:t})=>{var i;let e;typeof window<"u"?(e=JSON.parse(atob(((i=document.getElementById(_i(t)))==null?void 0:i.getAttribute("data-env"))||"")),vi||(Ba({service:e.service,env:e.env}),vi=!0)):e={service:hi.DD_SERVICE||"",env:hi.DD_ENV||""};const r=btoa(JSON.stringify(e));return C("div",{hidden:!0,id:_i(t),"data-env":r})},cc=uc(),$t="embossing-selection";na.hydrateRoot(document.getElementById($t),Ve(yi.StrictMode,{children:[C(lc,{rootElementId:$t}),C(yo,{...cc})]}),{identifierPrefix:$t});window.performance.measure("embossing-selection-loaded");export{Pt as A,xt as a,Ft as b,at as c,Ti as d,hc as e,vc as f,La as g,Ec as h,gr as i,Aa as n,Ta as t,Na as u};
//# sourceMappingURL=index-BhxTh5Er.js.map
